!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.PUBNUB=t():e.PUBNUB=t()}(this,function(){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={exports:{},id:i,loaded:!1};return e[i].call(r.exports,r,r.exports,n),r.loaded=!0,r.exports}return n.m=e,n.c=t,n.p="",n(0)}([function(e,t,n){n(1);var i=n(2),r=n(3),s=n(4),o=n(8);window.console||(window.console=window.console||{}),console.log||(console.log=console.error=(window.opera||{}).postError||function(){});var a=function(){var e={},t=!1;try{t=window.localStorage}catch(e){return}var n=function(e){return-1===document.cookie.indexOf(e)?null:((document.cookie||"").match(RegExp(e+"=([^;]+)"))||[])[1]||null},i=function(e,t){document.cookie=e+"="+t+"; expires=Thu, 1 Aug "+((new Date).getFullYear()+1)+" 20:00:00 UTC; path=/"},r=function(){try{return i("pnctest","1"),"1"===n("pnctest")}catch(e){return!1}}();return{get:function(i){try{return t?t.getItem(i):r?n(i):e[i]}catch(t){return e[i]}},set:function(n,s){try{if(t)return t.setItem(n,s)&&0;r&&i(n,s),e[n]=s}catch(t){e[n]=s}}}}();function c(e,t){return r.HmacSHA256(e,t).toString(r.enc.Base64)}function u(e){return document.getElementById(e)}function h(e){console.error(e)}function l(e,t){var n=[];return s.each(e.split(/\s+/),function(e){s.each((t||document).getElementsByTagName(e),function(e){n.push(e)})}),n}function f(e,t,n){s.each(e.split(","),function(e){var i=function(e){e||(e=window.event),n(e)||(e.cancelBubble=!0,e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation())};t.addEventListener?t.addEventListener(e,i,!1):t.attachEvent?t.attachEvent("on"+e,i):t["on"+e]=i})}function p(){return l("head")[0]}function d(e,t,n){if(!n)return e&&e.getAttribute&&e.getAttribute(t);e.setAttribute(t,n)}function g(e,t){for(var n in t)if(t.hasOwnProperty(n))try{e.style[n]=t[n]+("|width|height|top|left|".indexOf(n)>0&&"number"==typeof t[n]?"px":"")}catch(e){return}}function y(e){return document.createElement(e)}var m={list:{},unbind:function(e){m.list[e]=[]},bind:function(e,t){(m.list[e]=m.list[e]||[]).push(t)},fire:function(e,t){s.each(m.list[e]||[],function(e){e(t)})}};function v(e){var t,n,i=0,r=0,o=e.timeout||s.DEF_TIMEOUT,a=e.data||{},c=e.fail||function(){},u=e.success||function(){},h=function(e,r){i||(i=1,clearTimeout(n),t&&(t.onerror=t.onload=null,t.abort&&t.abort(),t=null),e&&c(r))};n=s.timeout(function(){h(1)},o);try{(t="undefined"!=typeof XDomainRequest&&new XDomainRequest||new XMLHttpRequest).onerror=t.onabort=function(){h(1,t.responseText||{error:"Network Connection Error"})},t.onload=t.onloadend=function(){if(!r){var e;r=1,clearTimeout(n);try{e=JSON.parse(t.responseText)}catch(e){return h(1)}u(e)}};var l=s.build_url(e.url,a);t.open("GET",l,!0),t.timeout=o,t.send()}catch(e){h(1,{error:"XHR Failed",stacktrace:e})}return h}function b(){if(!("onLine"in navigator))return 1;try{return navigator.onLine}catch(e){return!0}}function w(e){return"sendBeacon"in navigator&&navigator.sendBeacon(e)}var S=function(e){var t=e.leave_on_unload||0;e.xdr=v,e.db=a,e.error=e.error||h,e._is_online=b,e.hmac_SHA256=c,e.crypto_obj=i(),e.sendBeacon=w,e.sdk_family="Web";var n=function(e){return S(e)},r=s.PN_API(e);for(var C in r)r.hasOwnProperty(C)&&(n[C]=r[C]);return n.css=g,n.$=u,n.create=y,n.bind=f,n.head=p,n.search=l,n.attr=d,n.events=m,n.init=n,n.secure=n,n.crypto_obj=i(),n.WS=o,n.PNmessage=s.PNmessage,n.supplant=s.supplant,f("beforeunload",window,function(){return t&&n["each-channel"](function(e){n.LEAVE(e.name,0)}),!0}),n.ready(),e.notest?n:(f("offline",window,n.offline),f("offline",document,n.offline),n)};S.init=S,S.secure=S,S.crypto_obj=i(),S.WS=o,S.db=a,S.PNmessage=s.PNmessage,S.uuid=s.uuid,S.css=g,S.$=u,S.create=u,S.bind=f,S.head=p,S.search=l,S.attr=d,S.events=m,S.map=s.map,S.each=s.each,S.grep=s.grep,S.supplant=s.supplant,S.now=s.now,S.unique=s.unique,S.updater=s.updater,window.jQuery&&(window.jQuery.PUBNUB=S),e.exports=S},function(module,exports){(function(){window.JSON&&window.JSON.stringify||function(){function toJSON(e){try{return this.valueOf()}catch(e){return null}}window.JSON||(window.JSON={});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,i,r,s,o,a=gap,c=t[e];switch(c&&"object"==typeof c&&(c=toJSON.call(c,e)),"function"==typeof rep&&(c=rep.call(t,e,c)),typeof c){case"string":return quote(c);case"number":return isFinite(c)?String(c):"null";case"boolean":case"null":return String(c);case"object":if(!c)return"null";if(gap+=indent,o=[],"[object Array]"===Object.prototype.toString.apply(c)){for(s=c.length,n=0;n<s;n+=1)o[n]=str(n,c)||"null";return r=0===o.length?"[]":gap?"[\n"+gap+o.join(",\n"+gap)+"\n"+a+"]":"["+o.join(",")+"]",gap=a,r}if(rep&&"object"==typeof rep)for(s=rep.length,n=0;n<s;n+=1)"string"==typeof(i=rep[n])&&(r=str(i,c))&&o.push(quote(i)+(gap?": ":":")+r);else for(i in c)Object.hasOwnProperty.call(c,i)&&(r=str(i,c))&&o.push(quote(i)+(gap?": ":":")+r);return r=0===o.length?"{}":gap?"{\n"+gap+o.join(",\n"+gap)+"\n"+a+"}":"{"+o.join(",")+"}",gap=a,r}}"function"!=typeof JSON.stringify&&(JSON.stringify=function(e,t,n){var i;if(gap="",indent="","number"==typeof n)for(i=0;i<n;i+=1)indent+=" ";else"string"==typeof n&&(indent=n);if(rep=t,t&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw new Error("JSON.stringify");return str("",{"":e})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text){return eval("("+text+")")})}()}).call(window)},function(e,t,n){var i=n(3);e.exports=function(){var e="0123456789012345",t=["hex","utf8","base64","binary"],n=[128,256],r=["ecb","cbc"],s={encryptKey:!0,keyEncoding:"utf8",keyLength:256,mode:"cbc"};function o(e){return(e=e||{}).hasOwnProperty("encryptKey")||(e.encryptKey=s.encryptKey),e.hasOwnProperty("keyEncoding")||(e.keyEncoding=s.keyEncoding),e.hasOwnProperty("keyLength")||(e.keyLength=s.keyLength),e.hasOwnProperty("mode")||(e.mode=s.mode),-1==t.indexOf(e.keyEncoding.toLowerCase())&&(e.keyEncoding=s.keyEncoding),-1==n.indexOf(parseInt(e.keyLength,10))&&(e.keyLength=s.keyLength),-1==r.indexOf(e.mode.toLowerCase())&&(e.mode=s.mode),e}function a(e,t){var n,r,s;return n=e,e="base64"===(r=t).keyEncoding?i.enc.Base64.parse(n):"hex"===r.keyEncoding?i.enc.Hex.parse(n):n,t.encryptKey?i.enc.Utf8.parse((s=e,i.SHA256(s).toString(i.enc.Hex)).slice(0,32)):e}function c(e){return"ecb"===e.mode?i.mode.ECB:i.mode.CBC}function u(t){return"cbc"===t.mode?i.enc.Utf8.parse(e):null}return{encrypt:function(e,t,n){if(!t)return e;var r=u(n=o(n)),s=c(n),h=a(t,n),l=JSON.stringify(e);return i.AES.encrypt(l,h,{iv:r,mode:s}).ciphertext.toString(i.enc.Base64)||e},decrypt:function(e,t,n){if(!t)return e;var r=u(n=o(n)),s=c(n),h=a(t,n);try{var l=i.enc.Base64.parse(e),f=i.AES.decrypt({ciphertext:l},h,{iv:r,mode:s}).toString(i.enc.Utf8);return JSON.parse(f)}catch(e){return}}}}},function(e,t){var n,i,r,s,o,a,c,u,h,l,f=f||function(e,t){var n={},i=n.lib={},r=function(){},s=i.Base={extend:function(e){r.prototype=this;var t=new r;return e&&t.mixIn(e),t.hasOwnProperty("init")||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},o=i.WordArray=s.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=void 0!=t?t:4*e.length},toString:function(e){return(e||c).stringify(this)},concat:function(e){var t=this.words,n=e.words,i=this.sigBytes;if(e=e.sigBytes,this.clamp(),i%4)for(var r=0;r<e;r++)t[i+r>>>2]|=(n[r>>>2]>>>24-r%4*8&255)<<24-(i+r)%4*8;else if(65535<n.length)for(r=0;r<e;r+=4)t[i+r>>>2]=n[r>>>2];else t.push.apply(t,n);return this.sigBytes+=e,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-n%4*8,t.length=e.ceil(n/4)},clone:function(){var e=s.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var n=[],i=0;i<t;i+=4)n.push(4294967296*e.random()|0);return new o.init(n,t)}}),a=n.enc={},c=a.Hex={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],i=0;i<e;i++){var r=t[i>>>2]>>>24-i%4*8&255;n.push((r>>>4).toString(16)),n.push((15&r).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,n=[],i=0;i<t;i+=2)n[i>>>3]|=parseInt(e.substr(i,2),16)<<24-i%8*4;return new o.init(n,t/2)}},u=a.Latin1={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],i=0;i<e;i++)n.push(String.fromCharCode(t[i>>>2]>>>24-i%4*8&255));return n.join("")},parse:function(e){for(var t=e.length,n=[],i=0;i<t;i++)n[i>>>2]|=(255&e.charCodeAt(i))<<24-i%4*8;return new o.init(n,t)}},h=a.Utf8={stringify:function(e){try{return decodeURIComponent(escape(u.stringify(e)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(e){return u.parse(unescape(encodeURIComponent(e)))}},l=i.BufferedBlockAlgorithm=s.extend({reset:function(){this._data=new o.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=h.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n=this._data,i=n.words,r=n.sigBytes,s=this.blockSize,a=r/(4*s);if(t=(a=t?e.ceil(a):e.max((0|a)-this._minBufferSize,0))*s,r=e.min(4*t,r),t){for(var c=0;c<t;c+=s)this._doProcessBlock(i,c);c=i.splice(0,t),n.sigBytes-=r}return new o.init(c,r)},clone:function(){var e=s.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});i.Hasher=l.extend({cfg:s.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){l.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new f.HMAC.init(e,n).finalize(t)}}});var f=n.algo={};return n}(Math);!function(e){for(var t=f,n=(r=t.lib).WordArray,i=r.Hasher,r=t.algo,s=[],o=[],a=function(e){return 4294967296*(e-(0|e))|0},c=2,u=0;64>u;){var h;e:{h=c;for(var l=e.sqrt(h),p=2;p<=l;p++)if(!(h%p)){h=!1;break e}h=!0}h&&(8>u&&(s[u]=a(e.pow(c,.5))),o[u]=a(e.pow(c,1/3)),u++),c++}var d=[];r=r.SHA256=i.extend({_doReset:function(){this._hash=new n.init(s.slice(0))},_doProcessBlock:function(e,t){for(var n=this._hash.words,i=n[0],r=n[1],s=n[2],a=n[3],c=n[4],u=n[5],h=n[6],l=n[7],f=0;64>f;f++){if(16>f)d[f]=0|e[t+f];else{var p=d[f-15],g=d[f-2];d[f]=((p<<25|p>>>7)^(p<<14|p>>>18)^p>>>3)+d[f-7]+((g<<15|g>>>17)^(g<<13|g>>>19)^g>>>10)+d[f-16]}p=l+((c<<26|c>>>6)^(c<<21|c>>>11)^(c<<7|c>>>25))+(c&u^~c&h)+o[f]+d[f],g=((i<<30|i>>>2)^(i<<19|i>>>13)^(i<<10|i>>>22))+(i&r^i&s^r&s),l=h,h=u,u=c,c=a+p|0,a=s,s=r,r=i,i=p+g|0}n[0]=n[0]+i|0,n[1]=n[1]+r|0,n[2]=n[2]+s|0,n[3]=n[3]+a|0,n[4]=n[4]+c|0,n[5]=n[5]+u|0,n[6]=n[6]+h|0,n[7]=n[7]+l|0},_doFinalize:function(){var t=this._data,n=t.words,i=8*this._nDataBytes,r=8*t.sigBytes;return n[r>>>5]|=128<<24-r%32,n[14+(r+64>>>9<<4)]=e.floor(i/4294967296),n[15+(r+64>>>9<<4)]=i,t.sigBytes=4*n.length,this._process(),this._hash},clone:function(){var e=i.clone.call(this);return e._hash=this._hash.clone(),e}});t.SHA256=i._createHelper(r),t.HmacSHA256=i._createHmacHelper(r)}(Math),i=(n=f).enc.Utf8,n.algo.HMAC=n.lib.Base.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=i.parse(t));var n=e.blockSize,r=4*n;t.sigBytes>r&&(t=e.finalize(t)),t.clamp();for(var s=this._oKey=t.clone(),o=this._iKey=t.clone(),a=s.words,c=o.words,u=0;u<n;u++)a[u]^=1549556828,c[u]^=909522486;s.sigBytes=o.sigBytes=r,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher;return e=t.finalize(e),t.reset(),t.finalize(this._oKey.clone().concat(e))}}),s=(r=f).lib.WordArray,r.enc.Base64={stringify:function(e){var t=e.words,n=e.sigBytes,i=this._map;e.clamp(),e=[];for(var r=0;r<n;r+=3)for(var s=(t[r>>>2]>>>24-r%4*8&255)<<16|(t[r+1>>>2]>>>24-(r+1)%4*8&255)<<8|t[r+2>>>2]>>>24-(r+2)%4*8&255,o=0;4>o&&r+.75*o<n;o++)e.push(i.charAt(s>>>6*(3-o)&63));if(t=i.charAt(64))for(;e.length%4;)e.push(t);return e.join("")},parse:function(e){var t=e.length,n=this._map;(i=n.charAt(64))&&-1!=(i=e.indexOf(i))&&(t=i);for(var i=[],r=0,o=0;o<t;o++)if(o%4){var a=n.indexOf(e.charAt(o-1))<<o%4*2,c=n.indexOf(e.charAt(o))>>>6-o%4*2;i[r>>>2]|=(a|c)<<24-r%4*8,r++}return s.create(i,r)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},function(e){function t(e,t,n,i,r,s,o){return((e=e+(t&n|~t&i)+r+o)<<s|e>>>32-s)+t}function n(e,t,n,i,r,s,o){return((e=e+(t&i|n&~i)+r+o)<<s|e>>>32-s)+t}function i(e,t,n,i,r,s,o){return((e=e+(t^n^i)+r+o)<<s|e>>>32-s)+t}function r(e,t,n,i,r,s,o){return((e=e+(n^(t|~i))+r+o)<<s|e>>>32-s)+t}for(var s=f,o=(c=s.lib).WordArray,a=c.Hasher,c=s.algo,u=[],h=0;64>h;h++)u[h]=4294967296*e.abs(e.sin(h+1))|0;c=c.MD5=a.extend({_doReset:function(){this._hash=new o.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,s){for(var o=0;16>o;o++){var a=e[l=s+o];e[l]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8)}o=this._hash.words;var c,h,l=e[s+0],f=(a=e[s+1],e[s+2]),p=e[s+3],d=e[s+4],g=e[s+5],y=e[s+6],m=e[s+7],v=e[s+8],b=e[s+9],w=e[s+10],S=e[s+11],C=e[s+12],I=e[s+13],_=e[s+14],x=e[s+15],E=o[0],k=r(k=r(k=r(k=r(k=i(k=i(k=i(k=i(k=n(k=n(k=n(k=n(k=t(k=t(k=t(k=t(k=o[1],h=t(h=o[2],c=t(c=o[3],E=t(E,k,h,c,l,7,u[0]),k,h,a,12,u[1]),E,k,f,17,u[2]),c,E,p,22,u[3]),h=t(h,c=t(c,E=t(E,k,h,c,d,7,u[4]),k,h,g,12,u[5]),E,k,y,17,u[6]),c,E,m,22,u[7]),h=t(h,c=t(c,E=t(E,k,h,c,v,7,u[8]),k,h,b,12,u[9]),E,k,w,17,u[10]),c,E,S,22,u[11]),h=t(h,c=t(c,E=t(E,k,h,c,C,7,u[12]),k,h,I,12,u[13]),E,k,_,17,u[14]),c,E,x,22,u[15]),h=n(h,c=n(c,E=n(E,k,h,c,a,5,u[16]),k,h,y,9,u[17]),E,k,S,14,u[18]),c,E,l,20,u[19]),h=n(h,c=n(c,E=n(E,k,h,c,g,5,u[20]),k,h,w,9,u[21]),E,k,x,14,u[22]),c,E,d,20,u[23]),h=n(h,c=n(c,E=n(E,k,h,c,b,5,u[24]),k,h,_,9,u[25]),E,k,p,14,u[26]),c,E,v,20,u[27]),h=n(h,c=n(c,E=n(E,k,h,c,I,5,u[28]),k,h,f,9,u[29]),E,k,m,14,u[30]),c,E,C,20,u[31]),h=i(h,c=i(c,E=i(E,k,h,c,g,4,u[32]),k,h,v,11,u[33]),E,k,S,16,u[34]),c,E,_,23,u[35]),h=i(h,c=i(c,E=i(E,k,h,c,a,4,u[36]),k,h,d,11,u[37]),E,k,m,16,u[38]),c,E,w,23,u[39]),h=i(h,c=i(c,E=i(E,k,h,c,I,4,u[40]),k,h,l,11,u[41]),E,k,p,16,u[42]),c,E,y,23,u[43]),h=i(h,c=i(c,E=i(E,k,h,c,b,4,u[44]),k,h,C,11,u[45]),E,k,x,16,u[46]),c,E,f,23,u[47]),h=r(h,c=r(c,E=r(E,k,h,c,l,6,u[48]),k,h,m,10,u[49]),E,k,_,15,u[50]),c,E,g,21,u[51]),h=r(h,c=r(c,E=r(E,k,h,c,C,6,u[52]),k,h,p,10,u[53]),E,k,w,15,u[54]),c,E,a,21,u[55]),h=r(h,c=r(c,E=r(E,k,h,c,v,6,u[56]),k,h,x,10,u[57]),E,k,y,15,u[58]),c,E,I,21,u[59]),h=r(h,c=r(c,E=r(E,k,h,c,d,6,u[60]),k,h,S,10,u[61]),E,k,f,15,u[62]),c,E,b,21,u[63]);o[0]=o[0]+E|0,o[1]=o[1]+k|0,o[2]=o[2]+h|0,o[3]=o[3]+c|0},_doFinalize:function(){var t=this._data,n=t.words,i=8*this._nDataBytes,r=8*t.sigBytes;n[r>>>5]|=128<<24-r%32;var s=e.floor(i/4294967296);for(n[15+(r+64>>>9<<4)]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),n[14+(r+64>>>9<<4)]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8),t.sigBytes=4*(n.length+1),this._process(),n=(t=this._hash).words,i=0;4>i;i++)r=n[i],n[i]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8);return t},clone:function(){var e=a.clone.call(this);return e._hash=this._hash.clone(),e}}),s.MD5=a._createHelper(c),s.HmacMD5=a._createHmacHelper(c)}(Math),c=(o=(a=f).lib).Base,u=o.WordArray,h=(o=a.algo).EvpKDF=c.extend({cfg:c.extend({keySize:4,hasher:o.MD5,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var n=(o=this.cfg).hasher.create(),i=u.create(),r=i.words,s=o.keySize,o=o.iterations;r.length<s;){a&&n.update(a);var a=n.update(e).finalize(t);n.reset();for(var c=1;c<o;c++)a=n.finalize(a),n.reset();i.concat(a)}return i.sigBytes=4*s,i}}),a.EvpKDF=function(e,t,n){return h.create(n).compute(e,t)},f.lib.Cipher||function(e){var t=(d=f).lib,n=t.Base,i=t.WordArray,r=t.BufferedBlockAlgorithm,s=d.enc.Base64,o=d.algo.EvpKDF,a=t.Cipher=r.extend({cfg:n.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,n){this.cfg=this.cfg.extend(n),this._xformMode=e,this._key=t,this.reset()},reset:function(){r.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){return e&&this._append(e),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(e){return{encrypt:function(t,n,i){return("string"==typeof n?g:p).encrypt(e,t,n,i)},decrypt:function(t,n,i){return("string"==typeof n?g:p).decrypt(e,t,n,i)}}}});t.StreamCipher=a.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var c=d.mode={},u=function(e,t,n){var i=this._iv;i?this._iv=void 0:i=this._prevBlock;for(var r=0;r<n;r++)e[t+r]^=i[r]},h=(t.BlockCipherMode=n.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}})).extend();h.Encryptor=h.extend({processBlock:function(e,t){var n=this._cipher,i=n.blockSize;u.call(this,e,t,i),n.encryptBlock(e,t),this._prevBlock=e.slice(t,t+i)}}),h.Decryptor=h.extend({processBlock:function(e,t){var n=this._cipher,i=n.blockSize,r=e.slice(t,t+i);n.decryptBlock(e,t),u.call(this,e,t,i),this._prevBlock=r}}),c=c.CBC=h,h=(d.pad={}).Pkcs7={pad:function(e,t){for(var n,r=(n=(n=4*t)-e.sigBytes%n)<<24|n<<16|n<<8|n,s=[],o=0;o<n;o+=4)s.push(r);n=i.create(s,n),e.concat(n)},unpad:function(e){e.sigBytes-=255&e.words[e.sigBytes-1>>>2]}},t.BlockCipher=a.extend({cfg:a.cfg.extend({mode:c,padding:h}),reset:function(){a.reset.call(this);var e=(t=this.cfg).iv,t=t.mode;if(this._xformMode==this._ENC_XFORM_MODE)var n=t.createEncryptor;else n=t.createDecryptor,this._minBufferSize=1;this._mode=n.call(t,this,e&&e.words)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){e.pad(this._data,this.blockSize);var t=this._process(!0)}else t=this._process(!0),e.unpad(t);return t},blockSize:4});var l=t.CipherParams=n.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}}),p=(c=(d.format={}).OpenSSL={stringify:function(e){var t=e.ciphertext;return((e=e.salt)?i.create([1398893684,1701076831]).concat(e).concat(t):t).toString(s)},parse:function(e){var t=(e=s.parse(e)).words;if(1398893684==t[0]&&1701076831==t[1]){var n=i.create(t.slice(2,4));t.splice(0,4),e.sigBytes-=16}return l.create({ciphertext:e,salt:n})}},t.SerializableCipher=n.extend({cfg:n.extend({format:c}),encrypt:function(e,t,n,i){i=this.cfg.extend(i);var r=e.createEncryptor(n,i);return t=r.finalize(t),r=r.cfg,l.create({ciphertext:t,key:n,iv:r.iv,algorithm:e,mode:r.mode,padding:r.padding,blockSize:e.blockSize,formatter:i.format})},decrypt:function(e,t,n,i){return i=this.cfg.extend(i),t=this._parse(t,i.format),e.createDecryptor(n,i).finalize(t.ciphertext)},_parse:function(e,t){return"string"==typeof e?t.parse(e,this):e}})),d=(d.kdf={}).OpenSSL={execute:function(e,t,n,r){return r||(r=i.random(8)),e=o.create({keySize:t+n}).compute(e,r),n=i.create(e.words.slice(t),4*n),e.sigBytes=4*t,l.create({key:e,iv:n,salt:r})}},g=t.PasswordBasedCipher=p.extend({cfg:p.cfg.extend({kdf:d}),encrypt:function(e,t,n,i){return n=(i=this.cfg.extend(i)).kdf.execute(n,e.keySize,e.ivSize),i.iv=n.iv,(e=p.encrypt.call(this,e,t,n.key,i)).mixIn(n),e},decrypt:function(e,t,n,i){return i=this.cfg.extend(i),t=this._parse(t,i.format),n=i.kdf.execute(n,e.keySize,e.ivSize,t.salt),i.iv=n.iv,p.decrypt.call(this,e,t,n.key,i)}})}(),function(){for(var e=f,t=e.lib.BlockCipher,n=e.algo,i=[],r=[],s=[],o=[],a=[],c=[],u=[],h=[],l=[],p=[],d=[],g=0;256>g;g++)d[g]=128>g?g<<1:g<<1^283;var y=0,m=0;for(g=0;256>g;g++){var v=(v=m^m<<1^m<<2^m<<3^m<<4)>>>8^255&v^99;i[y]=v,r[v]=y;var b=d[y],w=d[b],S=d[w],C=257*d[v]^16843008*v;s[y]=C<<24|C>>>8,o[y]=C<<16|C>>>16,a[y]=C<<8|C>>>24,c[y]=C,C=16843009*S^65537*w^257*b^16843008*y,u[v]=C<<24|C>>>8,h[v]=C<<16|C>>>16,l[v]=C<<8|C>>>24,p[v]=C,y?(y=b^d[d[d[S^b]]],m^=d[d[m]]):y=m=1}var I=[0,1,2,4,8,16,32,64,128,27,54];n=n.AES=t.extend({_doReset:function(){for(var e=(n=this._key).words,t=n.sigBytes/4,n=4*((this._nRounds=t+6)+1),r=this._keySchedule=[],s=0;s<n;s++)if(s<t)r[s]=e[s];else{var o=r[s-1];s%t?6<t&&4==s%t&&(o=i[o>>>24]<<24|i[o>>>16&255]<<16|i[o>>>8&255]<<8|i[255&o]):(o=i[(o=o<<8|o>>>24)>>>24]<<24|i[o>>>16&255]<<16|i[o>>>8&255]<<8|i[255&o],o^=I[s/t|0]<<24),r[s]=r[s-t]^o}for(e=this._invKeySchedule=[],t=0;t<n;t++)s=n-t,o=t%4?r[s]:r[s-4],e[t]=4>t||4>=s?o:u[i[o>>>24]]^h[i[o>>>16&255]]^l[i[o>>>8&255]]^p[i[255&o]]},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._keySchedule,s,o,a,c,i)},decryptBlock:function(e,t){var n=e[t+1];e[t+1]=e[t+3],e[t+3]=n,this._doCryptBlock(e,t,this._invKeySchedule,u,h,l,p,r),n=e[t+1],e[t+1]=e[t+3],e[t+3]=n},_doCryptBlock:function(e,t,n,i,r,s,o,a){for(var c=this._nRounds,u=e[t]^n[0],h=e[t+1]^n[1],l=e[t+2]^n[2],f=e[t+3]^n[3],p=4,d=1;d<c;d++){var g=i[u>>>24]^r[h>>>16&255]^s[l>>>8&255]^o[255&f]^n[p++],y=i[h>>>24]^r[l>>>16&255]^s[f>>>8&255]^o[255&u]^n[p++],m=i[l>>>24]^r[f>>>16&255]^s[u>>>8&255]^o[255&h]^n[p++];f=i[f>>>24]^r[u>>>16&255]^s[h>>>8&255]^o[255&l]^n[p++],u=g,h=y,l=m}g=(a[u>>>24]<<24|a[h>>>16&255]<<16|a[l>>>8&255]<<8|a[255&f])^n[p++],y=(a[h>>>24]<<24|a[l>>>16&255]<<16|a[f>>>8&255]<<8|a[255&u])^n[p++],m=(a[l>>>24]<<24|a[f>>>16&255]<<16|a[u>>>8&255]<<8|a[255&h])^n[p++],f=(a[f>>>24]<<24|a[u>>>16&255]<<16|a[h>>>8&255]<<8|a[255&l])^n[p++],e[t]=g,e[t+1]=y,e[t+2]=m,e[t+3]=f},keySize:8});e.AES=t._createHelper(n)}(),f.mode.ECB=((l=f.lib.BlockCipherMode.extend()).Encryptor=l.extend({processBlock:function(e,t){this._cipher.encryptBlock(e,t)}}),l.Decryptor=l.extend({processBlock:function(e,t){this._cipher.decryptBlock(e,t)}}),l),e.exports=f},function(e,t,n){var i=n(5),r=n(6),s=n(7),o=1,a=!1,c=[],u="-pnpres",h=10,l=310,f=60,p=1e3,d=5,g=30,y=i.version;function m(){return"x"+ ++o+ +new Date}var v,b=(v=Math.floor(20*Math.random()),function(e){var t=e.split("://")[0],n=e.split("://")[1];return n.match("^ps")?t+"://"+n.replace("ps","ps"+(++v<20?v:v=1)):n.match("^pubsub")?t+"://"+n.replace("pubsub","ps"+(++v<20?v:v=1)):e});function w(e,t){var n=[];return s.each(e,function(e,i){t?e.search("-pnpres")<0&&i.subscribed&&n.push(e):i.subscribed&&n.push(e)}),n.sort()}function S(e,t){var n=[];return s.each(e,function(e,i){t?e.search("-pnpres")<0&&i.subscribed&&n.push(e):i.subscribed&&n.push(e)}),n.sort()}function C(){a||(a=1,s.each(c,function(e){e()}))}e.exports={PN_API:function(e){var t,n,i=+e.windowing||h,r=(+e.timeout||l)*p,o=(+e.keepalive||f)*p,v=e.timecheck||0,I=e.noleave||0,_=e.publish_key,x=e.subscribe_key,E=e.auth_key||"",k=e.secret_key||"",D=e.hmac_SHA256,O=e.ssl?"s":"",B="http"+O+"://"+(e.origin||"pubsub.pubnub.com"),T=b(B),A=b(B),M=function(){},P=[],N=!0,R=0,j=0,U=0,L=0,K=e.restore||0,H=0,z=!1,F={},G={},V={},J=null,W=ge(e.heartbeat||e.pnexpires||0,e.error),X=e.heartbeat_interval||W/2-1,q=!1,Q=e.no_wait_for_pending,Y=e["compatible_3.5"]||!1,$=e.xdr,Z=e.params||{},ee=e.error||function(){},te=e._is_online||function(){return 1},ne=e.jsonp_cb||function(){return 0},ie=e.db||{get:function(){},set:function(){}},re=e.cipher_key,se=e.uuid||!e.unique_uuid&&ie&&ie.get(x+"uuid")||"",oe=e.instance_id||!1,ae=e.partner_id,ce=e.sdk_family,ue="",he=e.shutdown,le=void 0===e.use_send_beacon||e.use_send_beacon?e.sendBeacon:null;2===W&&(X=1);var fe=e.crypto_obj||{encrypt:function(e,t){return e},decrypt:function(e,t){return e}};function pe(e){var t;return e||(e={}),s.each(Z,function(t,n){t in e||(e[t]=n)}),e.pnsdk=(t="PubNub-JS-"+ce,ae&&(t+="-"+ae),t+="/"+y),e}function de(e){return(t=e,n=[],s.each(t,function(e,t){n.push(e)}),n).sort();var t,n}function ge(e,t,n){var i=!1;if(void 0===e)return t;if("number"==typeof e)i=!(e>d||0==e);else{if("boolean"==typeof e)return e?g:0;i=!0}return i?(n&&n("Presence Heartbeat value invalid. Valid range ( x > "+d+" or x = 0). Current Value : "+(t||d)),t||d):e}function ye(e,t){return fe.encrypt(e,t||re)||e}function me(e,t){return fe.decrypt(e,t||re)||fe.decrypt(e,re)||e}function ve(){clearTimeout(J),!X||X>=500||X<1||!w(F,!0).length&&!S(G,!0).length?q=!1:(q=!0,ke.presence_heartbeat({callback:function(e){J=s.timeout(ve,X*p)},error:function(e){ee&&ee("Presence Heartbeat unable to reach Pubnub servers."+JSON.stringify(e)),J=s.timeout(ve,X*p)}}))}function be(){!q&&ve()}function we(e){if(Q){if(!P.length)return}else{if(e&&(P.sending=0),P.sending||!P.length)return;P.sending=1}xe(P.shift())}function Se(e){var t=0;return s.each(S(G),function(n){var i=G[n];i&&(t++,(e||function(){})(i))}),t}function Ce(e){var t=0;return s.each(w(F),function(n){var i=F[n];i&&(t++,(e||function(){})(i))}),t}function Ie(e,t,n){if("object"==typeof e){if(e.error){var i={};return e.message&&(i.message=e.message),e.payload&&(i.payload=e.payload),void(n&&n(i))}if(e.payload)return void(e.next_page?t&&t(e.payload,e.next_page):t&&t(e.payload))}t&&t(e)}function _e(e,t){if("object"==typeof e&&e.error){var n={};return e.message&&(n.message=e.message),e.payload&&(n.payload=e.payload),void(t&&t(n))}t&&t(e)}function xe(e){var t=e.operation,n=Math.floor((new Date).getTime()/1e3),i=e.data||{};if(k){i.auth||delete i.auth,i.timestamp=n;var r=x+"\n"+_+"\n";if("PNAccessManagerGrant"===t)r+="grant\n";else if("PNAccessManagerAudit"===t)r+="audit\n";else{var o=e.url.slice();o.shift(),r+="/"+o.join("/")+"\n"}r+=function(e){var t="",n=de(e);for(var i in n){var r=n[i];t+=r+"="+s.pamEncode(e[r]),i!=n.length-1&&(t+="&")}return t}(i);var a=D(r,k);a=(a=a.replace(/\+/g,"-")).replace(/\//g,"_"),i.signature=a,e.data=i}return $(e)}function Ee(e,t,n,i){t=e.callback||t;var r=e.error||ee,s=ne();(i=i||{}).auth||(i.auth=e.auth_key||E);var o=[T,"v1","channel-registration","sub-key",x];o.push.apply(o,n),s&&(i.callback=s),xe({callback:s,data:pe(i),success:function(e){Ie(e,t,r)},fail:function(e){_e(e,r)},url:o})}var ke={LEAVE:function(e,t,n,i,r){var o,a,c={uuid:se,auth:n||E},h=b(B),l=(i=i||function(){},r||function(){}),f=ne();if(e.indexOf(u)>0)return!0;if(Y){if(!O)return!1;if("0"==f)return!1}if(I)return!1;if("0"!=f&&(c.callback=f),oe&&(c.instanceid=ue),o=[h,"v2","presence","sub_key",x,"channel",s.encode(e),"leave"],a=pe(c),le){var p=s.buildURL(o,a);if(le(p))return i&&i({status:200,action:"leave",message:"OK",service:"Presence"}),!0}return xe({blocking:t||O,callback:f,data:a,success:function(e){Ie(e,i,l)},fail:function(e){_e(e,l)},url:o}),!0},LEAVE_GROUP:function(e,t,n,i,r){var o,a,c={uuid:se,auth:n||E},h=b(B),l=(i=i||function(){},r||function(){}),f=ne();if(e.indexOf(u)>0)return!0;if(Y){if(!O)return!1;if("0"==f)return!1}if(I)return!1;if("0"!=f&&(c.callback=f),e&&e.length>0&&(c["channel-group"]=e),oe&&(c.instanceid=ue),o=[h,"v2","presence","sub_key",x,"channel",s.encode(","),"leave"],a=pe(c),le){var p=s.buildURL(o,a);if(le(p))return i&&i({status:200,action:"leave",message:"OK",service:"Presence"}),!0}return xe({blocking:t||O,callback:f,data:a,success:function(e){Ie(e,i,l)},fail:function(e){_e(e,l)},url:o}),!0},set_resumed:function(e){z=e},get_cipher_key:function(){return re},set_cipher_key:function(e){re=e},raw_encrypt:function(e,t){return ye(e,t)},raw_decrypt:function(e,t){return me(e,t)},get_heartbeat:function(){return W},set_heartbeat:function(e,t){W=ge(e,W,ee),X=t||W/2-1,2==W&&(X=1),M(),ve()},get_heartbeat_interval:function(){return X},set_heartbeat_interval:function(e){X=e,ve()},get_version:function(){return y},getGcmMessageObject:function(e){return{data:e}},getApnsMessageObject:function(e){var t={aps:{badge:1,alert:""}};for(var n in e)n[t]=e[n];return t},_add_param:function(e,t){Z[e]=t},channel_group:function(e,t){var n,i,r=e.channel_group,o=(t=t||e.callback,e.channels||e.channel),a=e.cloak,c=[],u={},h=e.mode||"add";if(r){var l=r.split(":");l.length>1?(n="*"===l[0]?null:l[0],i=l[1]):i=l[0]}n&&c.push("namespace")&&c.push(s.encode(n)),c.push("channel-group"),i&&"*"!==i&&c.push(i),o?(s.isArray(o)&&(o=o.join(",")),u[h]=o,u.cloak=N?"true":"false"):"remove"===h&&c.push("remove"),void 0!==a&&(u.cloak=a?"true":"false"),Ee(e,t,c,u)},channel_group_list_groups:function(e,t){var n;(n=e.namespace||e.ns||e.channel_group||null)&&(e.channel_group=n+":*"),ke.channel_group(e,t)},channel_group_list_channels:function(e,t){if(!e.channel_group)return ee("Missing Channel Group");ke.channel_group(e,t)},channel_group_remove_channel:function(e,t){return e.channel_group?e.channel||e.channels?(e.mode="remove",void ke.channel_group(e,t)):ee("Missing Channel"):ee("Missing Channel Group")},channel_group_remove_group:function(e,t){return e.channel_group?e.channel?ee("Use channel_group_remove_channel if you want to remove a channel from a group."):(e.mode="remove",void ke.channel_group(e,t)):ee("Missing Channel Group")},channel_group_add_channel:function(e,t){return e.channel_group?e.channel||e.channels?void ke.channel_group(e,t):ee("Missing Channel"):ee("Missing Channel Group")},channel_group_cloak:function(e,t){void 0!==e.cloak?(N=e.cloak,ke.channel_group(e,t)):t(N)},channel_group_list_namespaces:function(e,t){Ee(e,t,["namespace"])},channel_group_remove_namespace:function(e,t){Ee(e,t,["namespace",e.namespace,"remove"])},history:function(e,t){t=e.callback||t;var n=e.count||e.limit||100,i=e.reverse||"false",r=e.error||function(){},o=e.auth_key||E,a=e.cipher_key,c=e.channel,u=e.channel_group,h=e.start,l=e.end,f=e.include_token,p=e.string_message_token||!1,d={},g=ne();return c||u?t?x?(d.stringtoken="true",d.count=n,d.reverse=i,d.auth=o,u&&(d["channel-group"]=u,c||(c=",")),g&&(d.callback=g),h&&(d.start=h),l&&(d.end=l),f&&(d.include_token="true"),p&&(d.string_message_token="true"),void xe({callback:g,data:pe(d),success:function(e){if("object"==typeof e&&e.error)r({message:e.message,payload:e.payload});else{for(var n=e[0],i=[],s=0;s<n.length;s++)if(f){var o=me(n[s].message,a),c=n[s].timetoken;try{i.push({message:JSON.parse(o),timetoken:c})}catch(e){i.push({message:o,timetoken:c})}}else{o=me(n[s],a);try{i.push(JSON.parse(o))}catch(e){i.push(o)}}t([i,e[1],e[2]])}},fail:function(e){_e(e,r)},url:[T,"v2","history","sub-key",x,"channel",s.encode(c)]})):ee("Missing Subscribe Key"):ee("Missing Callback"):ee("Missing Channel")},replay:function(e,t){t=t||e.callback||function(){};var n=e.auth_key||E,i=e.source,r=e.destination,s=e.error||e.error||function(){},o=e.stop,a=e.start,c=e.end,u=e.reverse,h=e.limit,l=ne(),f={};return i?r?_?x?("0"!=l&&(f.callback=l),o&&(f.stop="all"),u&&(f.reverse="true"),a&&(f.start=a),c&&(f.end=c),h&&(f.count=h),f.auth=n,void xe({callback:l,success:function(e){Ie(e,t,s)},fail:function(){t([0,"Disconnected"])},url:[T,"v1","replay",_,x,i,r],data:pe(f)})):ee("Missing Subscribe Key"):ee("Missing Publish Key"):ee("Missing Destination Channel"):ee("Missing Source Channel")},auth:function(e){E=e,M()},time:function(e){var t=ne(),n={uuid:se,auth:E};oe&&(n.instanceid=ue),xe({callback:t,data:pe(n),url:[T,"time",t],success:function(t){e(t[0])},fail:function(){e(0)}})},publish:function(e,t){var n=e.message;if(!n)return ee("Missing Message");t=t||e.callback||n.callback||e.success||function(){};var i,r,o=e.channel||n.channel,a=e.meta||e.metadata,c=e.auth_key||E,u=e.cipher_key,h=e.error||n.error||function(){},l=e.post||!1,f=!("store_in_history"in e)||e.store_in_history,p=!("replicate"in e)||e.replicate,d=ne(),g="push";return e.prepend&&(g="unshift"),o?_?x?(n.getPubnubMessage&&(n=n.getPubnubMessage()),n=JSON.stringify(ye(n,u)),r=[T,"publish",_,x,0,s.encode(o),d,s.encode(n)],i={uuid:se,auth:c},a&&"object"==typeof a&&(i.meta=JSON.stringify(a)),f||(i.store="0"),p||(i.norep="true"),oe&&(i.instanceid=ue),P[g]({callback:d,url:r,data:pe(i),fail:function(e){_e(e,h),we(1)},success:function(e){Ie(e,t,h),we(1)},mode:l?"POST":"GET"}),void we()):ee("Missing Subscribe Key"):ee("Missing Publish Key"):ee("Missing Channel")},fire:function(e,t){e.store_in_history=!1,e.replicate=!1,ke.publish(e,t)},unsubscribe:function(e,t){var n=e.channel,i=e.channel_group,r=e.auth_key||E,o=(t=t||e.callback||function(){},e.error||function(){});if(!n&&!i)return ee("Missing Channel or Channel Group");if(!x)return ee("Missing Subscribe Key");if(n){var c=s.isArray(n)?n:(""+n).split(","),h=[],l=[];if(s.each(c,function(e){F[e]&&h.push(e)}),0==h.length)return void t({action:"leave"});s.each(h,function(e){l.push(e+u)}),s.each(h.concat(l),function(e){e in F&&delete F[e],e in V&&delete V[e]}),0===F.length&&0===G.length&&(H=0);var f=!0;a&&(f=ke.LEAVE(h.join(","),0,r,t,o)),f||t({action:"leave"})}if(i){var p=s.isArray(i)?i:(""+i).split(","),d=[],g=[];if(s.each(p,function(e){G[e]&&d.push(e)}),0==d.length)return void t({action:"leave"});s.each(d,function(e){g.push(e+u)}),s.each(d.concat(g),function(e){e in G&&delete G[e],e in V&&delete V[e]}),0===F.length&&0===G.length&&(H=0),f=!0,a&&(f=ke.LEAVE_GROUP(d.join(","),0,r,t,o)),f||t({action:"leave"})}M()},subscribe:function(e,t){var n=e.channel,o=e.channel_group,h=(t=(t=t||e.callback)||e.message,e.connect||function(){}),l=e.reconnect||function(){},f=e.disconnect||function(){},d=e.error||d||function(){},g=e.idle||function(){},y=e.presence||0,m=e.noheresync||0,v=e.backfill||0,C=e.timetoken||0,I=e.timeout||r,_=e.windowing||i,k=e.state,D=e.heartbeat||e.pnexpires,O=e.heartbeat_interval,P=e.restore||K;if(E=e.auth_key||E,K=P,H=C,!n&&!o)return ee("Missing Channel");if(!t)return ee("Missing Callback");if(!x)return ee("Missing Subscribe Key");function N(e){e?s.timeout(M,_):(T=b(B),A=b(B),s.timeout(function(){ke.time(N)},p)),Ce(function(t){if(e&&t.disconnected)return t.disconnected=0,t.reconnect(t.name);e||t.disconnected||(t.disconnected=1,t.disconnect(t.name))}),Se(function(t){if(e&&t.disconnected)return t.disconnected=0,t.reconnect(t.name);e||t.disconnected||(t.disconnected=1,t.disconnect(t.name))})}function J(){var e=ne(),t=w(F).join(","),n=S(G).join(",");if(t||n){t||(t=","),De();var i=pe({uuid:se,auth:E});n&&(i["channel-group"]=n),JSON.stringify(V).length>2&&(i.state=JSON.stringify(V)),W&&(i.heartbeat=W),oe&&(i.instanceid=ue),be(),L=xe({timeout:I,callback:e,fail:function(e){e&&e.error&&e.service?(_e(e,d),N(!1)):ke.time(function(t){!t&&_e(e,d),N(t)})},data:pe(i),url:[A,"subscribe",x,s.encode(t),e,H],success:function(e){if(!e||"object"==typeof e&&"error"in e&&e.error)return d(e),s.timeout(M,p);if(g(e[1]),H=!H&&K&&ie.get(x)||e[1],Ce(function(e){e.connected||(e.connected=1,e.connect(e.name))}),Se(function(e){e.connected||(e.connected=1,e.connect(e.name))}),z&&!K)return H=0,z=!1,ie.set(x,0),void s.timeout(J,_);v&&(H=1e4,v=0),ie.set(x,e[1]);var t,n=function(){var t="",n="";e.length>3?(t=e[3],n=e[2]):t=e.length>2?e[2]:s.map(w(F),function(t){return s.map(Array(e[0].length).join(",").split(","),function(){return t})}).join(",");var i=t.split(","),r=n?n.split(","):[];return function(){var e=i.shift()||U,t=r.shift(),n={},s={callback:function(){}};t?(e&&e.indexOf("-pnpres")>=0&&t.indexOf("-pnpres")<0&&(t+="-pnpres"),n=G[t]||F[t]||s):n=F[e]||s;var o=[n.callback||j,e.split(u)[0]];return t&&o.push(t.split(u)[0]),o}}(),i=(t=+e[1],s.rnow()-R-t/1e4);s.each(e[0],function(t){var r=n(),s=me(t,F[r[1]]?F[r[1]].cipher_key:null);r[0]&&r[0](s,e,r[2]||r[1],i,r[1])}),s.timeout(J,_)}})}}if((D||0===D||O||0===O)&&ke.set_heartbeat(D,O),n&&s.each((n.join?n.join(","):""+n).split(","),function(n){var i=F[n]||{};F[U=n]={name:n,connected:i.connected,disconnected:i.disconnected,subscribed:1,callback:j=t,cipher_key:e.cipher_key,connect:h,disconnect:f,reconnect:l},k&&(V[n]=n in k?k[n]:k),y&&(ke.subscribe({channel:n+u,callback:y,restore:P}),i.subscribed||m||ke.here_now({channel:n,data:pe({uuid:se,auth:E}),callback:function(e){s.each("uuids"in e?e.uuids:[],function(t){y({action:"join",uuid:t,timestamp:Math.floor(s.rnow()/1e3),occupancy:e.occupancy||1},e,n)})}}))}),o&&s.each((o.join?o.join(","):""+o).split(","),function(n){var i=G[n]||{};G[n]={name:n,connected:i.connected,disconnected:i.disconnected,subscribed:1,callback:j=t,cipher_key:e.cipher_key,connect:h,disconnect:f,reconnect:l},y&&(ke.subscribe({channel_group:n+u,callback:y,restore:P,auth_key:E}),i.subscribed||m||ke.here_now({channel_group:n,data:pe({uuid:se,auth:E}),callback:function(e){s.each("uuids"in e?e.uuids:[],function(t){y({action:"join",uuid:t,timestamp:Math.floor(s.rnow()/1e3),occupancy:e.occupancy||1},e,n)})}}))}),M=function(){De(),s.timeout(J,_)},!a)return c.push(M);M()},here_now:function(e,t){t=e.callback||t;var n=e.debug,i=e.error||function(){},r=e.auth_key||E,o=e.channel,a=e.channel_group,c=ne(),u=!("uuids"in e)||e.uuids,h=e.state,l={uuid:se,auth:r};if(u||(l.disable_uuids=1),h&&(l.state=1),!t)return ee("Missing Callback");if(!x)return ee("Missing Subscribe Key");var f=[T,"v2","presence","sub_key",x];o&&f.push("channel")&&f.push(s.encode(o)),"0"!=c&&(l.callback=c),a&&(l["channel-group"]=a,!o&&f.push("channel")&&f.push(",")),oe&&(l.instanceid=ue),xe({callback:c,data:pe(l),success:function(e){Ie(e,t,i)},fail:function(e){_e(e,i)},debug:n,url:f})},where_now:function(e,t){t=e.callback||t;var n=e.error||function(){},i=e.auth_key||E,r=ne(),o=e.uuid||se,a={auth:i};return t?x?("0"!=r&&(a.callback=r),oe&&(a.instanceid=ue),void xe({callback:r,data:pe(a),success:function(e){Ie(e,t,n)},fail:function(e){_e(e,n)},url:[T,"v2","presence","sub_key",x,"uuid",s.encode(o)]})):ee("Missing Subscribe Key"):ee("Missing Callback")},state:function(e,t){t=e.callback||t||function(e){};var n,i=e.error||function(){},r=e.auth_key||E,o=ne(),a=e.state,c=e.uuid||se,u=e.channel,h=e.channel_group,l=pe({auth:r});return x?c?u||h?("0"!=o&&(l.callback=o),void 0!==u&&F[u]&&F[u].subscribed&&a&&(V[u]=a),void 0!==h&&G[h]&&G[h].subscribed&&(a&&(V[h]=a),l["channel-group"]=h,u||(u=",")),l.state=JSON.stringify(a),oe&&(l.instanceid=ue),n=a?[T,"v2","presence","sub-key",x,"channel",u,"uuid",c,"data"]:[T,"v2","presence","sub-key",x,"channel",u,"uuid",s.encode(c)],void xe({callback:o,data:pe(l),success:function(e){Ie(e,t,i)},fail:function(e){_e(e,i)},url:n})):ee("Missing Channel"):ee("Missing UUID"):ee("Missing Subscribe Key")},grant:function(e,t){t=e.callback||t;var n=e.error||function(){},i=e.channel||e.channels,r=e.channel_group,o=ne(),a=e.ttl,c=e.read?"1":"0",u=e.write?"1":"0",h=e.manage?"1":"0",l=e.auth_key||e.auth_keys;if(!t)return ee("Missing Callback");if(!x)return ee("Missing Subscribe Key");if(!_)return ee("Missing Publish Key");if(!k)return ee("Missing Secret Key");var f={w:u,r:c};e.manage&&(f.m=h),s.isArray(i)&&(i=i.join(",")),s.isArray(l)&&(l=l.join(",")),void 0!==i&&null!=i&&i.length>0&&(f.channel=i),void 0!==r&&null!=r&&r.length>0&&(f["channel-group"]=r),"0"!=o&&(f.callback=o),(a||0===a)&&(f.ttl=a),l&&(f.auth=l),f=pe(f),l||delete f.auth,xe({operation:"PNAccessManagerGrant",callback:o,data:f,success:function(e){Ie(e,t,n)},fail:function(e){_e(e,n)},url:[T,"v1","auth","grant","sub-key",x]})},mobile_gw_provision:function(e){var t,n,i=e.callback||function(){},r=e.auth_key||E,s=e.error||function(){},o=ne(),a=e.channel,c=e.op,u=e.gw_type,h=e.device_id;return h?u?c?a?x?(n=[T,"v1/push/sub-key",x,"devices",h],t={uuid:se,auth:r,type:u},"add"==c?t.add=a:"remove"==c&&(t.remove=a),oe&&(t.instanceid=ue),void xe({callback:o,data:t,success:function(e){Ie(e,i,s)},fail:function(e){_e(e,s)},url:n})):ee("Missing Subscribe Key"):ee("Missing gw destination Channel (channel)"):ee("Missing GW Operation (op: add or remove)"):ee("Missing GW Type (gw_type: gcm or apns)"):ee("Missing Device ID (device_id)")},audit:function(e,t){t=e.callback||t;var n=e.error||function(){},i=e.channel,r=e.channel_group,s=e.auth_key,o=ne();if(!t)return ee("Missing Callback");if(!x)return ee("Missing Subscribe Key");if(!_)return ee("Missing Publish Key");if(!k)return ee("Missing Secret Key");var a={};"0"!=o&&(a.callback=o),void 0!==i&&null!=i&&i.length>0&&(a.channel=i),void 0!==r&&null!=r&&r.length>0&&(a["channel-group"]=r),s&&(a.auth=s),a=pe(a),s||delete a.auth,xe({operation:"PNAccessManagerAudit",callback:o,data:a,success:function(e){Ie(e,t,n)},fail:function(e){_e(e,n)},url:[T,"v1","auth","audit","sub-key",x]})},revoke:function(e,t){e.read=!1,e.write=!1,ke.grant(e,t)},set_uuid:function(e){se=e,M()},get_uuid:function(){return se},isArray:function(e){return s.isArray(e)},get_subscribed_channels:function(){return w(F,!0)},presence_heartbeat:function(e){var t=e.callback||function(){},n=e.error||function(){},i=ne(),r={uuid:se,auth:E};JSON.stringify(V).length>2&&(r.state=JSON.stringify(V)),W>0&&W<320&&(r.heartbeat=W),"0"!=i&&(r.callback=i);var o=s.encode(w(F,!0).join(",")),a=S(G,!0).join(",");o||(o=","),a&&(r["channel-group"]=a),oe&&(r.instanceid=ue),xe({callback:i,data:pe(r),url:[T,"v2","presence","sub-key",x,"channel",o,"heartbeat"],success:function(e){Ie(e,t,n)},fail:function(e){_e(e,n)}})},stop_timers:function(){clearTimeout(t),clearTimeout(n),clearTimeout(J)},shutdown:function(){ke.stop_timers(),he&&he()},xdr:$,ready:C,db:ie,uuid:s.generateUUID,map:s.map,each:s.each,"each-channel":Ce,grep:s.grep,offline:function(){De(1,{message:"Offline. Please check your network settings."})},supplant:s.supplant,now:s.rnow,unique:m,updater:s.updater};function De(e,i){L&&L(e,i),L=null,clearTimeout(t),clearTimeout(n)}function Oe(e,t){var n=s.rnow();function i(t){if(t){var i=t/1e4,r=(s.rnow()-n)/2;R=s.rnow()-(i+r),e&&e(R)}}t&&i(t)||ke.time(i)}return se||(se=ke.uuid()),ue||(ue=ke.uuid()),ie.set(x+"uuid",se),t=s.timeout(function e(){te()||De(1,{error:"Offline. Please check your network settings."}),t&&clearTimeout(t),t=s.timeout(e,p)},p),n=s.timeout(function e(){v&&ke.time(function(t){Oe(function(){},t),t||De(1,{error:"Heartbeat failed to connect to Pubnub Servers.Please check your network settings."}),n&&clearTimeout(n),n=s.timeout(e,o)})},o),J=s.timeout(be,(X-3)*p),Oe(),ke},unique:m,PNmessage:function(e){var t=e||{apns:{}};return t.getPubnubMessage=function(){var e={};if(Object.keys(t.apns).length){e.pn_apns={aps:{alert:t.apns.alert,badge:t.apns.badge,sound:t.apns.sound}};for(var n in t.apns)e.pn_apns[n]=t.apns[n];var i=["badge","alert","sound"];for(var n in i)delete e.pn_apns[i[n]]}t.gcm&&(e.pn_gcm={data:t.gcm});for(var n in t)e[n]=t[n];var r=["apns","gcm","publish","channel","callback","error"];for(var n in r)delete e[r[n]];return e},t.publish=function(){var e=t.getPubnubMessage();t.pubnub&&t.channel&&t.pubnub.publish({message:e,channel:t.channel,callback:t.callback,error:t.error})},t},DEF_TIMEOUT:15e3,timeout:s.timeout,build_url:s.buildURL,each:s.each,uuid:s.generateUUID,URLBIT:r.URLBIT,grep:s.grep,supplant:s.supplant,now:s.rnow,updater:s.updater,map:s.map}},function(e,t){e.exports={name:"pubnub",preferGlobal:!1,version:"3.16.5",author:"PubNub <support@pubnub.com>",description:"Publish & Subscribe Real-time Messaging with PubNub",contributors:[{name:"Stephen Blum",email:"stephen@pubnub.com"}],bin:{},scripts:{test:"grunt test --force"},main:"./node.js/pubnub.js",browser:"./modern/dist/pubnub.js",repository:{type:"git",url:"git://github.com/pubnub/javascript.git"},keywords:["cloud","publish","subscribe","websockets","comet","bosh","xmpp","real-time","messaging"],dependencies:{agentkeepalive:"~0.2",lodash:"^4.1.0"},noAnalyze:!1,devDependencies:{chai:"^3.5.0",eslint:"2.4.0","eslint-config-airbnb":"^6.0.2","eslint-plugin-flowtype":"^2.1.0","eslint-plugin-mocha":"^2.0.0","eslint-plugin-react":"^4.1.0","flow-bin":"^0.22.0",grunt:"^0.4.5","grunt-contrib-clean":"^1.0.0","grunt-contrib-copy":"^0.8.2","grunt-contrib-uglify":"^0.11.1","grunt-env":"^0.4.4","grunt-eslint":"^18.0.0","grunt-flow":"^1.0.3","grunt-karma":"^0.12.1","grunt-mocha-istanbul":"^3.0.1","grunt-text-replace":"^0.4.0","grunt-webpack":"^1.0.11","imports-loader":"^0.6.5",isparta:"^4.0.0","json-loader":"^0.5.4",karma:"^0.13.21","karma-chai":"^0.1.0","karma-mocha":"^0.2.1","karma-phantomjs-launcher":"^1.0.0","karma-spec-reporter":"0.0.24","load-grunt-tasks":"^3.4.0",mocha:"^2.4.5",nock:"^1.1.0","node-uuid":"^1.4.7",nodeunit:"^0.9.0","phantomjs-prebuilt":"^2.1.4",proxyquire:"^1.7.4",sinon:"^1.17.2","uglify-js":"^2.6.1",underscore:"^1.7.0",webpack:"^1.12.13","webpack-dev-server":"^1.14.1"},bundleDependencies:[],license:"MIT",engine:{node:">=0.8"},files:["core","node.js","modern","CHANGELOG","FUTURE.md","LICENSE","README.md"]}},function(e,t){e.exports={PARAMSBIT:"&",URLBIT:"/"}},function(e,t,n){var i=n(6),r=/{([\w\-]+)}/g;function s(){return+new Date}function o(e){return!!e&&"string"!=typeof e&&(Array.isArray&&Array.isArray(e)||"number"==typeof e.length)}function a(e,t){if(e&&t)if(o(e))for(var n=0,i=e.length;n<i;)t.call(e[n],e[n],n++);else for(var n in e)e.hasOwnProperty&&e.hasOwnProperty(n)&&t.call(e[n],n,e[n])}function c(e){return encodeURIComponent(e)}e.exports={buildURL:function(e,t){var n=e.join(i.URLBIT),r=[];return t?(a(t,function(e,t){var n="object"==typeof t?JSON.stringify(t):t;void 0!==t&&null!==t&&c(n).length>0&&r.push(e+"="+c(n))}),n+="?"+r.join(i.PARAMSBIT)):n},encode:c,each:a,updater:function(e,t){var n,i=0,r=function(){i+t>s()?(clearTimeout(n),n=setTimeout(r,t)):(i=s(),e())};return r},rnow:s,isArray:o,map:function(e,t){var n=[];return a(e||[],function(e,i){n.push(t(e,i))}),n},pamEncode:function(e){return encodeURIComponent(e).replace(/[!'()*~]/g,function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()})},generateUUID:function(e){var t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)});return e&&e(t),t},timeout:function(e,t){if("undefined"!=typeof setTimeout)return setTimeout(e,t)},supplant:function(e,t){return e.replace(r,function(e,n){return t[n]||e})},grep:function(e,t){var n=[];return a(e||[],function(e){t(e)&&n.push(e)}),n}}},function(e,t){var n=function(e,t){if(!(this instanceof n))return new n(e,t);var i=this,r=(e=i.url=e||"",i.protocol=t||"Sec-WebSocket-Protocol",e.split("/")),s={ssl:"wss:"===r[0],origin:r[2],publish_key:r[3],subscribe_key:r[4],channel:r[5]};if(i.CONNECTING=0,i.OPEN=1,i.CLOSING=2,i.CLOSED=3,i.CLOSE_NORMAL=1e3,i.CLOSE_GOING_AWAY=1001,i.CLOSE_PROTOCOL_ERROR=1002,i.CLOSE_UNSUPPORTED=1003,i.CLOSE_TOO_LARGE=1004,i.CLOSE_NO_STATUS=1005,i.CLOSE_ABNORMAL=1006,i.onclose=i.onerror=i.onmessage=i.onopen=i.onsend=function(){},i.binaryType="",i.extensions="",i.bufferedAmount=0,i.trasnmitting=!1,i.buffer=[],i.readyState=i.CONNECTING,!e)return i.readyState=i.CLOSED,i.onclose({code:i.CLOSE_ABNORMAL,reason:"Missing URL",wasClean:!0}),i;i.pubnub=PUBNUB.init(s),i.pubnub.setup=s,i.setup=s,i.pubnub.subscribe({restore:!1,channel:s.channel,disconnect:i.onerror,reconnect:i.onopen,error:function(){i.onclose({code:i.CLOSE_ABNORMAL,reason:"Missing URL",wasClean:!1})},callback:function(e){i.onmessage({data:e})},connect:function(){i.readyState=i.OPEN,i.onopen()}})};n.prototype.send=function(e){var t=this;t.pubnub.publish({channel:t.pubnub.setup.channel,message:e,callback:function(e){t.onsend({data:e})}})},n.prototype.close=function(){this.pubnub.unsubscribe({channel:this.pubnub.setup.channel}),this.readyState=this.CLOSED,this.onclose({})},e.exports=n}])}),function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).SinchClient=e()}}(function(){return function e(t,n,i){function r(o,a){if(!n[o]){if(!t[o]){var c="function"==typeof require&&require;if(!a&&c)return c(o,!0);if(s)return s(o,!0);var u=new Error("Cannot find module '"+o+"'");throw u.code="MODULE_NOT_FOUND",u}var h=n[o]={exports:{}};t[o][0].call(h.exports,function(e){var n=t[o][1][e];return r(n||e)},h,h.exports,e,t,n,i)}return n[o].exports}for(var s="function"==typeof require&&require,o=0;o<i.length;o++)r(i[o]);return r}({1:[function(e,t,n){VERSION=["1.4.12-0-g4b470dd","1.4.12","0","4b470dd",null],n.version=VERSION},{}],2:[function(e,t,n){"use strict";n.byteLength=function(e){return 3*e.length/4-u(e)},n.toByteArray=function(e){var t,n,i,o,a,c=e.length;o=u(e),a=new s(3*c/4-o),n=o>0?c-4:c;var h=0;for(t=0;t<n;t+=4)i=r[e.charCodeAt(t)]<<18|r[e.charCodeAt(t+1)]<<12|r[e.charCodeAt(t+2)]<<6|r[e.charCodeAt(t+3)],a[h++]=i>>16&255,a[h++]=i>>8&255,a[h++]=255&i;2===o?(i=r[e.charCodeAt(t)]<<2|r[e.charCodeAt(t+1)]>>4,a[h++]=255&i):1===o&&(i=r[e.charCodeAt(t)]<<10|r[e.charCodeAt(t+1)]<<4|r[e.charCodeAt(t+2)]>>2,a[h++]=i>>8&255,a[h++]=255&i);return a},n.fromByteArray=function(e){for(var t,n=e.length,r=n%3,s="",o=[],a=0,c=n-r;a<c;a+=16383)o.push(h(e,a,a+16383>c?c:a+16383));1===r?(t=e[n-1],s+=i[t>>2],s+=i[t<<4&63],s+="=="):2===r&&(t=(e[n-2]<<8)+e[n-1],s+=i[t>>10],s+=i[t>>4&63],s+=i[t<<2&63],s+="=");return o.push(s),o.join("")};for(var i=[],r=[],s="undefined"!=typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,c=o.length;a<c;++a)i[a]=o[a],r[o.charCodeAt(a)]=a;function u(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");return"="===e[t-2]?2:"="===e[t-1]?1:0}function h(e,t,n){for(var r,s,o=[],a=t;a<n;a+=3)r=(e[a]<<16)+(e[a+1]<<8)+e[a+2],o.push(i[(s=r)>>18&63]+i[s>>12&63]+i[s>>6&63]+i[63&s]);return o.join("")}r["-".charCodeAt(0)]=62,r["_".charCodeAt(0)]=63},{}],3:[function(e,t,n){(function(e){!function(){"use strict";t.exports=function(t){return(t instanceof e?t:new e(t.toString(),"binary")).toString("base64")}}()}).call(this,e("buffer").Buffer)},{buffer:4}],4:[function(e,t,n){"use strict";var i=e("base64-js"),r=e("ieee754");n.Buffer=a,n.SlowBuffer=function(e){+e!=e&&(e=0);return a.alloc(+e)},n.INSPECT_MAX_BYTES=50;var s=2147483647;function o(e){if(e>s)throw new RangeError("Invalid typed array length");var t=new Uint8Array(e);return t.__proto__=a.prototype,t}function a(e,t,n){if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return h(e)}return c(e,t,n)}function c(e,t,n){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return R(e)?function(e,t,n){if(t<0||e.byteLength<t)throw new RangeError("'offset' is out of bounds");if(e.byteLength<t+(n||0))throw new RangeError("'length' is out of bounds");var i;i=void 0===t&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,t):new Uint8Array(e,t,n);return i.__proto__=a.prototype,i}(e,t,n):"string"==typeof e?function(e,t){"string"==typeof t&&""!==t||(t="utf8");if(!a.isEncoding(t))throw new TypeError('"encoding" must be a valid string encoding');var n=0|p(e,t),i=o(n),r=i.write(e,t);r!==n&&(i=i.slice(0,r));return i}(e,t):function(e){if(a.isBuffer(e)){var t=0|f(e.length),n=o(t);return 0===n.length?n:(e.copy(n,0,0,t),n)}if(e){if(j(e)||"length"in e)return"number"!=typeof e.length||U(e.length)?o(0):l(e);if("Buffer"===e.type&&Array.isArray(e.data))return l(e.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e)}function u(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function h(e){return u(e),o(e<0?0:0|f(e))}function l(e){for(var t=e.length<0?0:0|f(e.length),n=o(t),i=0;i<t;i+=1)n[i]=255&e[i];return n}function f(e){if(e>=s)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+s.toString(16)+" bytes");return 0|e}function p(e,t){if(a.isBuffer(e))return e.length;if(j(e)||R(e))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var i=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return M(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return P(e).length;default:if(i)return M(e).length;t=(""+t).toLowerCase(),i=!0}}function d(e,t,n){var i=e[t];e[t]=e[n],e[n]=i}function g(e,t,n,i,r){if(0===e.length)return-1;if("string"==typeof n?(i=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),U(n=+n)&&(n=r?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(r)return-1;n=e.length-1}else if(n<0){if(!r)return-1;n=0}if("string"==typeof t&&(t=a.from(t,i)),a.isBuffer(t))return 0===t.length?-1:y(e,t,n,i,r);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?r?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):y(e,[t],n,i,r);throw new TypeError("val must be string, number or Buffer")}function y(e,t,n,i,r){var s,o=1,a=e.length,c=t.length;if(void 0!==i&&("ucs2"===(i=String(i).toLowerCase())||"ucs-2"===i||"utf16le"===i||"utf-16le"===i)){if(e.length<2||t.length<2)return-1;o=2,a/=2,c/=2,n/=2}function u(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(r){var h=-1;for(s=n;s<a;s++)if(u(e,s)===u(t,-1===h?0:s-h)){if(-1===h&&(h=s),s-h+1===c)return h*o}else-1!==h&&(s-=s-h),h=-1}else for(n+c>a&&(n=a-c),s=n;s>=0;s--){for(var l=!0,f=0;f<c;f++)if(u(e,s+f)!==u(t,f)){l=!1;break}if(l)return s}return-1}function m(e,t,n,i){n=Number(n)||0;var r=e.length-n;i?(i=Number(i))>r&&(i=r):i=r;var s=t.length;if(s%2!=0)throw new TypeError("Invalid hex string");i>s/2&&(i=s/2);for(var o=0;o<i;++o){var a=parseInt(t.substr(2*o,2),16);if(U(a))return o;e[n+o]=a}return o}function v(e,t,n,i){return N(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,i)}function b(e,t,n){return 0===t&&n===e.length?i.fromByteArray(e):i.fromByteArray(e.slice(t,n))}function w(e,t,n){n=Math.min(e.length,n);for(var i=[],r=t;r<n;){var s,o,a,c,u=e[r],h=null,l=u>239?4:u>223?3:u>191?2:1;if(r+l<=n)switch(l){case 1:u<128&&(h=u);break;case 2:128==(192&(s=e[r+1]))&&(c=(31&u)<<6|63&s)>127&&(h=c);break;case 3:s=e[r+1],o=e[r+2],128==(192&s)&&128==(192&o)&&(c=(15&u)<<12|(63&s)<<6|63&o)>2047&&(c<55296||c>57343)&&(h=c);break;case 4:s=e[r+1],o=e[r+2],a=e[r+3],128==(192&s)&&128==(192&o)&&128==(192&a)&&(c=(15&u)<<18|(63&s)<<12|(63&o)<<6|63&a)>65535&&c<1114112&&(h=c)}null===h?(h=65533,l=1):h>65535&&(h-=65536,i.push(h>>>10&1023|55296),h=56320|1023&h),i.push(h),r+=l}return function(e){var t=e.length;if(t<=S)return String.fromCharCode.apply(String,e);var n="",i=0;for(;i<t;)n+=String.fromCharCode.apply(String,e.slice(i,i+=S));return n}(i)}n.kMaxLength=s,a.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()}catch(e){return!1}}(),a.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),"undefined"!=typeof Symbol&&Symbol.species&&a[Symbol.species]===a&&Object.defineProperty(a,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),a.poolSize=8192,a.from=function(e,t,n){return c(e,t,n)},a.prototype.__proto__=Uint8Array.prototype,a.__proto__=Uint8Array,a.alloc=function(e,t,n){return r=t,s=n,u(i=e),i<=0?o(i):void 0!==r?"string"==typeof s?o(i).fill(r,s):o(i).fill(r):o(i);var i,r,s},a.allocUnsafe=function(e){return h(e)},a.allocUnsafeSlow=function(e){return h(e)},a.isBuffer=function(e){return null!=e&&!0===e._isBuffer},a.compare=function(e,t){if(!a.isBuffer(e)||!a.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,i=t.length,r=0,s=Math.min(n,i);r<s;++r)if(e[r]!==t[r]){n=e[r],i=t[r];break}return n<i?-1:i<n?1:0},a.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},a.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return a.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var i=a.allocUnsafe(t),r=0;for(n=0;n<e.length;++n){var s=e[n];if(!a.isBuffer(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(i,r),r+=s.length}return i},a.byteLength=p,a.prototype._isBuffer=!0,a.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)d(this,t,t+1);return this},a.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)d(this,t,t+3),d(this,t+1,t+2);return this},a.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)d(this,t,t+7),d(this,t+1,t+6),d(this,t+2,t+5),d(this,t+3,t+4);return this},a.prototype.toString=function(){var e=this.length;return 0===e?"":0===arguments.length?w(this,0,e):function(e,t,n){var i=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return _(this,t,n);case"utf8":case"utf-8":return w(this,t,n);case"ascii":return C(this,t,n);case"latin1":case"binary":return I(this,t,n);case"base64":return b(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return x(this,t,n);default:if(i)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),i=!0}}.apply(this,arguments)},a.prototype.equals=function(e){if(!a.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===a.compare(this,e)},a.prototype.inspect=function(){var e="",t=n.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,t).match(/.{2}/g).join(" "),this.length>t&&(e+=" ... ")),"<Buffer "+e+">"},a.prototype.compare=function(e,t,n,i,r){if(!a.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===i&&(i=0),void 0===r&&(r=this.length),t<0||n>e.length||i<0||r>this.length)throw new RangeError("out of range index");if(i>=r&&t>=n)return 0;if(i>=r)return-1;if(t>=n)return 1;if(t>>>=0,n>>>=0,i>>>=0,r>>>=0,this===e)return 0;for(var s=r-i,o=n-t,c=Math.min(s,o),u=this.slice(i,r),h=e.slice(t,n),l=0;l<c;++l)if(u[l]!==h[l]){s=u[l],o=h[l];break}return s<o?-1:o<s?1:0},a.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},a.prototype.indexOf=function(e,t,n){return g(this,e,t,n,!0)},a.prototype.lastIndexOf=function(e,t,n){return g(this,e,t,n,!1)},a.prototype.write=function(e,t,n,i){if(void 0===t)i="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)i=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(n)?(n>>>=0,void 0===i&&(i="utf8")):(i=n,n=void 0)}var r=this.length-t;if((void 0===n||n>r)&&(n=r),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");i||(i="utf8");for(var s,o,a,c,u,h,l,f,p,d=!1;;)switch(i){case"hex":return m(this,e,t,n);case"utf8":case"utf-8":return f=t,p=n,N(M(e,(l=this).length-f),l,f,p);case"ascii":return v(this,e,t,n);case"latin1":case"binary":return v(this,e,t,n);case"base64":return c=this,u=t,h=n,N(P(e),c,u,h);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return o=t,a=n,N(function(e,t){for(var n,i,r,s=[],o=0;o<e.length&&!((t-=2)<0);++o)n=e.charCodeAt(o),i=n>>8,r=n%256,s.push(r),s.push(i);return s}(e,(s=this).length-o),s,o,a);default:if(d)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),d=!0}},a.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var S=4096;function C(e,t,n){var i="";n=Math.min(e.length,n);for(var r=t;r<n;++r)i+=String.fromCharCode(127&e[r]);return i}function I(e,t,n){var i="";n=Math.min(e.length,n);for(var r=t;r<n;++r)i+=String.fromCharCode(e[r]);return i}function _(e,t,n){var i=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>i)&&(n=i);for(var r="",s=t;s<n;++s)r+=A(e[s]);return r}function x(e,t,n){for(var i=e.slice(t,n),r="",s=0;s<i.length;s+=2)r+=String.fromCharCode(i[s]+256*i[s+1]);return r}function E(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function k(e,t,n,i,r,s){if(!a.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>r||t<s)throw new RangeError('"value" argument is out of bounds');if(n+i>e.length)throw new RangeError("Index out of range")}function D(e,t,n,i,r,s){if(n+i>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function O(e,t,n,i,s){return t=+t,n>>>=0,s||D(e,0,n,4),r.write(e,t,n,i,23,4),n+4}function B(e,t,n,i,s){return t=+t,n>>>=0,s||D(e,0,n,8),r.write(e,t,n,i,52,8),n+8}a.prototype.slice=function(e,t){var n=this.length;e=~~e,t=void 0===t?n:~~t,e<0?(e+=n)<0&&(e=0):e>n&&(e=n),t<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e);var i=this.subarray(e,t);return i.__proto__=a.prototype,i},a.prototype.readUIntLE=function(e,t,n){e>>>=0,t>>>=0,n||E(e,t,this.length);for(var i=this[e],r=1,s=0;++s<t&&(r*=256);)i+=this[e+s]*r;return i},a.prototype.readUIntBE=function(e,t,n){e>>>=0,t>>>=0,n||E(e,t,this.length);for(var i=this[e+--t],r=1;t>0&&(r*=256);)i+=this[e+--t]*r;return i},a.prototype.readUInt8=function(e,t){return e>>>=0,t||E(e,1,this.length),this[e]},a.prototype.readUInt16LE=function(e,t){return e>>>=0,t||E(e,2,this.length),this[e]|this[e+1]<<8},a.prototype.readUInt16BE=function(e,t){return e>>>=0,t||E(e,2,this.length),this[e]<<8|this[e+1]},a.prototype.readUInt32LE=function(e,t){return e>>>=0,t||E(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},a.prototype.readUInt32BE=function(e,t){return e>>>=0,t||E(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},a.prototype.readIntLE=function(e,t,n){e>>>=0,t>>>=0,n||E(e,t,this.length);for(var i=this[e],r=1,s=0;++s<t&&(r*=256);)i+=this[e+s]*r;return i>=(r*=128)&&(i-=Math.pow(2,8*t)),i},a.prototype.readIntBE=function(e,t,n){e>>>=0,t>>>=0,n||E(e,t,this.length);for(var i=t,r=1,s=this[e+--i];i>0&&(r*=256);)s+=this[e+--i]*r;return s>=(r*=128)&&(s-=Math.pow(2,8*t)),s},a.prototype.readInt8=function(e,t){return e>>>=0,t||E(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},a.prototype.readInt16LE=function(e,t){e>>>=0,t||E(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},a.prototype.readInt16BE=function(e,t){e>>>=0,t||E(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},a.prototype.readInt32LE=function(e,t){return e>>>=0,t||E(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},a.prototype.readInt32BE=function(e,t){return e>>>=0,t||E(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},a.prototype.readFloatLE=function(e,t){return e>>>=0,t||E(e,4,this.length),r.read(this,e,!0,23,4)},a.prototype.readFloatBE=function(e,t){return e>>>=0,t||E(e,4,this.length),r.read(this,e,!1,23,4)},a.prototype.readDoubleLE=function(e,t){return e>>>=0,t||E(e,8,this.length),r.read(this,e,!0,52,8)},a.prototype.readDoubleBE=function(e,t){return e>>>=0,t||E(e,8,this.length),r.read(this,e,!1,52,8)},a.prototype.writeUIntLE=function(e,t,n,i){(e=+e,t>>>=0,n>>>=0,i)||k(this,e,t,n,Math.pow(2,8*n)-1,0);var r=1,s=0;for(this[t]=255&e;++s<n&&(r*=256);)this[t+s]=e/r&255;return t+n},a.prototype.writeUIntBE=function(e,t,n,i){(e=+e,t>>>=0,n>>>=0,i)||k(this,e,t,n,Math.pow(2,8*n)-1,0);var r=n-1,s=1;for(this[t+r]=255&e;--r>=0&&(s*=256);)this[t+r]=e/s&255;return t+n},a.prototype.writeUInt8=function(e,t,n){return e=+e,t>>>=0,n||k(this,e,t,1,255,0),this[t]=255&e,t+1},a.prototype.writeUInt16LE=function(e,t,n){return e=+e,t>>>=0,n||k(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},a.prototype.writeUInt16BE=function(e,t,n){return e=+e,t>>>=0,n||k(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},a.prototype.writeUInt32LE=function(e,t,n){return e=+e,t>>>=0,n||k(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},a.prototype.writeUInt32BE=function(e,t,n){return e=+e,t>>>=0,n||k(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},a.prototype.writeIntLE=function(e,t,n,i){if(e=+e,t>>>=0,!i){var r=Math.pow(2,8*n-1);k(this,e,t,n,r-1,-r)}var s=0,o=1,a=0;for(this[t]=255&e;++s<n&&(o*=256);)e<0&&0===a&&0!==this[t+s-1]&&(a=1),this[t+s]=(e/o>>0)-a&255;return t+n},a.prototype.writeIntBE=function(e,t,n,i){if(e=+e,t>>>=0,!i){var r=Math.pow(2,8*n-1);k(this,e,t,n,r-1,-r)}var s=n-1,o=1,a=0;for(this[t+s]=255&e;--s>=0&&(o*=256);)e<0&&0===a&&0!==this[t+s+1]&&(a=1),this[t+s]=(e/o>>0)-a&255;return t+n},a.prototype.writeInt8=function(e,t,n){return e=+e,t>>>=0,n||k(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},a.prototype.writeInt16LE=function(e,t,n){return e=+e,t>>>=0,n||k(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},a.prototype.writeInt16BE=function(e,t,n){return e=+e,t>>>=0,n||k(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},a.prototype.writeInt32LE=function(e,t,n){return e=+e,t>>>=0,n||k(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},a.prototype.writeInt32BE=function(e,t,n){return e=+e,t>>>=0,n||k(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},a.prototype.writeFloatLE=function(e,t,n){return O(this,e,t,!0,n)},a.prototype.writeFloatBE=function(e,t,n){return O(this,e,t,!1,n)},a.prototype.writeDoubleLE=function(e,t,n){return B(this,e,t,!0,n)},a.prototype.writeDoubleBE=function(e,t,n){return B(this,e,t,!1,n)},a.prototype.copy=function(e,t,n,i){if(n||(n=0),i||0===i||(i=this.length),t>=e.length&&(t=e.length),t||(t=0),i>0&&i<n&&(i=n),i===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),e.length-t<i-n&&(i=e.length-t+n);var r,s=i-n;if(this===e&&n<t&&t<i)for(r=s-1;r>=0;--r)e[r+t]=this[r+n];else if(s<1e3)for(r=0;r<s;++r)e[r+t]=this[r+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+s),t);return s},a.prototype.fill=function(e,t,n,i){if("string"==typeof e){if("string"==typeof t?(i=t,t=0,n=this.length):"string"==typeof n&&(i=n,n=this.length),1===e.length){var r=e.charCodeAt(0);r<256&&(e=r)}if(void 0!==i&&"string"!=typeof i)throw new TypeError("encoding must be a string");if("string"==typeof i&&!a.isEncoding(i))throw new TypeError("Unknown encoding: "+i)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var s;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(s=t;s<n;++s)this[s]=e;else{var o=a.isBuffer(e)?e:new a(e,i),c=o.length;for(s=0;s<n-t;++s)this[s+t]=o[s%c]}return this};var T=/[^+/0-9A-Za-z-_]/g;function A(e){return e<16?"0"+e.toString(16):e.toString(16)}function M(e,t){var n;t=t||1/0;for(var i=e.length,r=null,s=[],o=0;o<i;++o){if((n=e.charCodeAt(o))>55295&&n<57344){if(!r){if(n>56319){(t-=3)>-1&&s.push(239,191,189);continue}if(o+1===i){(t-=3)>-1&&s.push(239,191,189);continue}r=n;continue}if(n<56320){(t-=3)>-1&&s.push(239,191,189),r=n;continue}n=65536+(r-55296<<10|n-56320)}else r&&(t-=3)>-1&&s.push(239,191,189);if(r=null,n<128){if((t-=1)<0)break;s.push(n)}else if(n<2048){if((t-=2)<0)break;s.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;s.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;s.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return s}function P(e){return i.toByteArray(function(e){if((e=e.trim().replace(T,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function N(e,t,n,i){for(var r=0;r<i&&!(r+n>=t.length||r>=e.length);++r)t[r+n]=e[r];return r}function R(e){return e instanceof ArrayBuffer||null!=e&&null!=e.constructor&&"ArrayBuffer"===e.constructor.name&&"number"==typeof e.byteLength}function j(e){return"function"==typeof ArrayBuffer.isView&&ArrayBuffer.isView(e)}function U(e){return e!=e}},{"base64-js":2,ieee754:11}],5:[function(e,t,n){var i,r;i=this,r=function(){var e,t,n,i,r,s,o,a,c,u,h,l,f=f||(e=Math,t=Object.create||function(){function e(){}return function(t){var n;return e.prototype=t,n=new e,e.prototype=null,n}}(),i=(n={}).lib={},r=i.Base={extend:function(e){var n=t(this);return e&&n.mixIn(e),n.hasOwnProperty("init")&&this.init!==n.init||(n.init=function(){n.$super.init.apply(this,arguments)}),n.init.prototype=n,n.$super=this,n},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},s=i.WordArray=r.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=void 0!=t?t:4*e.length},toString:function(e){return(e||a).stringify(this)},concat:function(e){var t=this.words,n=e.words,i=this.sigBytes,r=e.sigBytes;if(this.clamp(),i%4)for(var s=0;s<r;s++){var o=n[s>>>2]>>>24-s%4*8&255;t[i+s>>>2]|=o<<24-(i+s)%4*8}else for(s=0;s<r;s+=4)t[i+s>>>2]=n[s>>>2];return this.sigBytes+=r,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-n%4*8,t.length=e.ceil(n/4)},clone:function(){var e=r.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var n,i=[],r=function(t){t=t;var n=987654321;return function(){var i=((n=36969*(65535&n)+(n>>16)&4294967295)<<16)+(t=18e3*(65535&t)+(t>>16)&4294967295)&4294967295;return i/=4294967296,(i+=.5)*(e.random()>.5?1:-1)}},o=0;o<t;o+=4){var a=r(4294967296*(n||e.random()));n=987654071*a(),i.push(4294967296*a()|0)}return new s.init(i,t)}}),o=n.enc={},a=o.Hex={stringify:function(e){for(var t=e.words,n=e.sigBytes,i=[],r=0;r<n;r++){var s=t[r>>>2]>>>24-r%4*8&255;i.push((s>>>4).toString(16)),i.push((15&s).toString(16))}return i.join("")},parse:function(e){for(var t=e.length,n=[],i=0;i<t;i+=2)n[i>>>3]|=parseInt(e.substr(i,2),16)<<24-i%8*4;return new s.init(n,t/2)}},c=o.Latin1={stringify:function(e){for(var t=e.words,n=e.sigBytes,i=[],r=0;r<n;r++){var s=t[r>>>2]>>>24-r%4*8&255;i.push(String.fromCharCode(s))}return i.join("")},parse:function(e){for(var t=e.length,n=[],i=0;i<t;i++)n[i>>>2]|=(255&e.charCodeAt(i))<<24-i%4*8;return new s.init(n,t)}},u=o.Utf8={stringify:function(e){try{return decodeURIComponent(escape(c.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return c.parse(unescape(encodeURIComponent(e)))}},h=i.BufferedBlockAlgorithm=r.extend({reset:function(){this._data=new s.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=u.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n=this._data,i=n.words,r=n.sigBytes,o=this.blockSize,a=r/(4*o),c=(a=t?e.ceil(a):e.max((0|a)-this._minBufferSize,0))*o,u=e.min(4*c,r);if(c){for(var h=0;h<c;h+=o)this._doProcessBlock(i,h);var l=i.splice(0,c);n.sigBytes-=u}return new s.init(l,u)},clone:function(){var e=r.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),i.Hasher=h.extend({cfg:r.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){h.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new l.HMAC.init(e,n).finalize(t)}}}),l=n.algo={},n);return f},"object"==typeof n?t.exports=n=r():i.CryptoJS=r()},{}],6:[function(e,t,n){var i,r;i=this,r=function(e){return function(){var t=e,n=t.lib.WordArray;t.enc.Base64={stringify:function(e){var t=e.words,n=e.sigBytes,i=this._map;e.clamp();for(var r=[],s=0;s<n;s+=3)for(var o=(t[s>>>2]>>>24-s%4*8&255)<<16|(t[s+1>>>2]>>>24-(s+1)%4*8&255)<<8|t[s+2>>>2]>>>24-(s+2)%4*8&255,a=0;a<4&&s+.75*a<n;a++)r.push(i.charAt(o>>>6*(3-a)&63));var c=i.charAt(64);if(c)for(;r.length%4;)r.push(c);return r.join("")},parse:function(e){var t=e.length,i=this._map,r=this._reverseMap;if(!r){r=this._reverseMap=[];for(var s=0;s<i.length;s++)r[i.charCodeAt(s)]=s}var o=i.charAt(64);if(o){var a=e.indexOf(o);-1!==a&&(t=a)}return function(e,t,i){for(var r=[],s=0,o=0;o<t;o++)if(o%4){var a=i[e.charCodeAt(o-1)]<<o%4*2,c=i[e.charCodeAt(o)]>>>6-o%4*2;r[s>>>2]|=(a|c)<<24-s%4*8,s++}return n.create(r,s)}(e,t,r)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),e.enc.Base64},"object"==typeof n?t.exports=n=r(e("./core")):r(i.CryptoJS)},{"./core":5}],7:[function(e,t,n){var i,r;i=this,r=function(e){return e.enc.Utf8},"object"==typeof n?t.exports=n=r(e("./core")):r(i.CryptoJS)},{"./core":5}],8:[function(e,t,n){var i,r;i=this,r=function(e){return e.HmacSHA256},"object"==typeof n?t.exports=n=r(e("./core"),e("./sha256"),e("./hmac")):r(i.CryptoJS)},{"./core":5,"./hmac":9,"./sha256":10}],9:[function(e,t,n){var i,r;i=this,r=function(e){var t,n,i;n=(t=e).lib.Base,i=t.enc.Utf8,t.algo.HMAC=n.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=i.parse(t));var n=e.blockSize,r=4*n;t.sigBytes>r&&(t=e.finalize(t)),t.clamp();for(var s=this._oKey=t.clone(),o=this._iKey=t.clone(),a=s.words,c=o.words,u=0;u<n;u++)a[u]^=1549556828,c[u]^=909522486;s.sigBytes=o.sigBytes=r,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher,n=t.finalize(e);return t.reset(),t.finalize(this._oKey.clone().concat(n))}})},"object"==typeof n?t.exports=n=r(e("./core")):r(i.CryptoJS)},{"./core":5}],10:[function(e,t,n){var i,r;i=this,r=function(e){return function(t){var n=e,i=n.lib,r=i.WordArray,s=i.Hasher,o=n.algo,a=[],c=[];!function(){function e(e){for(var n=t.sqrt(e),i=2;i<=n;i++)if(!(e%i))return!1;return!0}function n(e){return 4294967296*(e-(0|e))|0}for(var i=2,r=0;r<64;)e(i)&&(r<8&&(a[r]=n(t.pow(i,.5))),c[r]=n(t.pow(i,1/3)),r++),i++}();var u=[],h=o.SHA256=s.extend({_doReset:function(){this._hash=new r.init(a.slice(0))},_doProcessBlock:function(e,t){for(var n=this._hash.words,i=n[0],r=n[1],s=n[2],o=n[3],a=n[4],h=n[5],l=n[6],f=n[7],p=0;p<64;p++){if(p<16)u[p]=0|e[t+p];else{var d=u[p-15],g=(d<<25|d>>>7)^(d<<14|d>>>18)^d>>>3,y=u[p-2],m=(y<<15|y>>>17)^(y<<13|y>>>19)^y>>>10;u[p]=g+u[p-7]+m+u[p-16]}var v=i&r^i&s^r&s,b=(i<<30|i>>>2)^(i<<19|i>>>13)^(i<<10|i>>>22),w=f+((a<<26|a>>>6)^(a<<21|a>>>11)^(a<<7|a>>>25))+(a&h^~a&l)+c[p]+u[p];f=l,l=h,h=a,a=o+w|0,o=s,s=r,r=i,i=w+(b+v)|0}n[0]=n[0]+i|0,n[1]=n[1]+r|0,n[2]=n[2]+s|0,n[3]=n[3]+o|0,n[4]=n[4]+a|0,n[5]=n[5]+h|0,n[6]=n[6]+l|0,n[7]=n[7]+f|0},_doFinalize:function(){var e=this._data,n=e.words,i=8*this._nDataBytes,r=8*e.sigBytes;return n[r>>>5]|=128<<24-r%32,n[14+(r+64>>>9<<4)]=t.floor(i/4294967296),n[15+(r+64>>>9<<4)]=i,e.sigBytes=4*n.length,this._process(),this._hash},clone:function(){var e=s.clone.call(this);return e._hash=this._hash.clone(),e}});n.SHA256=s._createHelper(h),n.HmacSHA256=s._createHmacHelper(h)}(Math),e.SHA256},"object"==typeof n?t.exports=n=r(e("./core")):r(i.CryptoJS)},{"./core":5}],11:[function(e,t,n){n.read=function(e,t,n,i,r){var s,o,a=8*r-i-1,c=(1<<a)-1,u=c>>1,h=-7,l=n?r-1:0,f=n?-1:1,p=e[t+l];for(l+=f,s=p&(1<<-h)-1,p>>=-h,h+=a;h>0;s=256*s+e[t+l],l+=f,h-=8);for(o=s&(1<<-h)-1,s>>=-h,h+=i;h>0;o=256*o+e[t+l],l+=f,h-=8);if(0===s)s=1-u;else{if(s===c)return o?NaN:1/0*(p?-1:1);o+=Math.pow(2,i),s-=u}return(p?-1:1)*o*Math.pow(2,s-i)},n.write=function(e,t,n,i,r,s){var o,a,c,u=8*s-r-1,h=(1<<u)-1,l=h>>1,f=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,p=i?0:s-1,d=i?1:-1,g=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,o=h):(o=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-o))<1&&(o--,c*=2),(t+=o+l>=1?f/c:f*Math.pow(2,1-l))*c>=2&&(o++,c/=2),o+l>=h?(a=0,o=h):o+l>=1?(a=(t*c-1)*Math.pow(2,r),o+=l):(a=t*Math.pow(2,l-1)*Math.pow(2,r),o=0));r>=8;e[n+p]=255&a,p+=d,a/=256,r-=8);for(o=o<<r|a,u+=r;u>0;e[n+p]=255&o,p+=d,o/=256,u-=8);e[n+p-d]|=128*g}},{}],12:[function(e,t,n){var i,r,s=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function c(e){if(i===setTimeout)return setTimeout(e,0);if((i===o||!i)&&setTimeout)return i=setTimeout,setTimeout(e,0);try{return i(e,0)}catch(t){try{return i.call(null,e,0)}catch(t){return i.call(this,e,0)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:o}catch(e){i=o}try{r="function"==typeof clearTimeout?clearTimeout:a}catch(e){r=a}}();var u,h=[],l=!1,f=-1;function p(){l&&u&&(l=!1,u.length?h=u.concat(h):f=-1,h.length&&d())}function d(){if(!l){var e=c(p);l=!0;for(var t=h.length;t;){for(u=h,h=[];++f<t;)u&&u[f].run();f=-1,t=h.length}u=null,l=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===a||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function g(e,t){this.fun=e,this.array=t}function y(){}s.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];h.push(new g(e,t)),1!==h.length||l||c(d)},g.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=y,s.addListener=y,s.once=y,s.off=y,s.removeListener=y,s.removeAllListeners=y,s.emit=y,s.prependListener=y,s.prependOnceListener=y,s.listeners=function(e){return[]},s.binding=function(e){throw new Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(e){throw new Error("process.chdir is not supported")},s.umask=function(){return 0}},{}],13:[function(e,t,n){(function(e){!function(e){"use strict";if("function"==typeof bootstrap)bootstrap("promise",e);else if("object"==typeof n&&"object"==typeof t)t.exports=e();else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makeQ=e}else{if("undefined"==typeof window&&"undefined"==typeof self)throw new Error("This environment was not anticipated by Q. Please file a bug.");var i="undefined"!=typeof window?window:self,r=i.Q;i.Q=e(),i.Q.noConflict=function(){return i.Q=r,this}}}(function(){"use strict";var t=!1;try{throw new Error}catch(e){t=!!e.stack}var n,i=C(),r=function(){},s=function(){var t={task:void 0,next:null},n=t,i=!1,r=void 0,o=!1,a=[];function c(){for(var e,n;t.next;)e=(t=t.next).task,t.task=void 0,(n=t.domain)&&(t.domain=void 0,n.enter()),u(e,n);for(;a.length;)u(e=a.pop());i=!1}function u(e,t){try{e()}catch(e){if(o)throw t&&t.exit(),setTimeout(c,0),t&&t.enter(),e;setTimeout(function(){throw e},0)}t&&t.exit()}if(s=function(t){n=n.next={task:t,domain:o&&e.domain,next:null},i||(i=!0,r())},"object"==typeof e&&"[object process]"===e.toString()&&e.nextTick)o=!0,r=function(){e.nextTick(c)};else if("function"==typeof setImmediate)r="undefined"!=typeof window?setImmediate.bind(window,c):function(){setImmediate(c)};else if("undefined"!=typeof MessageChannel){var h=new MessageChannel;h.port1.onmessage=function(){r=l,h.port1.onmessage=c,c()};var l=function(){h.port2.postMessage(0)};r=function(){setTimeout(c,0),l()}}else r=function(){setTimeout(c,0)};return s.runAfter=function(e){a.push(e),i||(i=!0,r())},s}(),o=Function.call;function a(e){return function(){return o.apply(e,arguments)}}var c,u=a(Array.prototype.slice),h=a(Array.prototype.reduce||function(e,t){var n=0,i=this.length;if(1===arguments.length)for(;;){if(n in this){t=this[n++];break}if(++n>=i)throw new TypeError}for(;n<i;n++)n in this&&(t=e(t,this[n],n));return t}),l=a(Array.prototype.indexOf||function(e){for(var t=0;t<this.length;t++)if(this[t]===e)return t;return-1}),f=a(Array.prototype.map||function(e,t){var n=this,i=[];return h(n,function(r,s,o){i.push(e.call(t,s,o,n))},void 0),i}),p=Object.create||function(e){function t(){}return t.prototype=e,new t},d=Object.defineProperty||function(e,t,n){return e[t]=n.value,e},g=a(Object.prototype.hasOwnProperty),y=Object.keys||function(e){var t=[];for(var n in e)g(e,n)&&t.push(n);return t},m=a(Object.prototype.toString);c="undefined"!=typeof ReturnValue?ReturnValue:function(e){this.value=e};var v="From previous event:";function b(e,n){if(t&&n.stack&&"object"==typeof e&&null!==e&&e.stack){for(var i=[],r=n;r;r=r.source)r.stack&&(!e.__minimumStackCounter__||e.__minimumStackCounter__>r.stackCounter)&&(d(e,"__minimumStackCounter__",{value:r.stackCounter,configurable:!0}),i.unshift(r.stack));i.unshift(e.stack);var s=function(e){for(var t=e.split("\n"),n=[],i=0;i<t.length;++i){var r=t[i];!S(r)&&(-1===(s=r).indexOf("(module.js:")&&-1===s.indexOf("(node.js:"))&&r&&n.push(r)}var s;return n.join("\n")}(i.join("\n"+v+"\n"));d(e,"stack",{value:s,configurable:!0})}}function w(e){var t=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(e);if(t)return[t[1],Number(t[2])];var n=/at ([^ ]+):(\d+):(?:\d+)$/.exec(e);if(n)return[n[1],Number(n[2])];var i=/.*@(.+):(\d+)$/.exec(e);return i?[i[1],Number(i[2])]:void 0}function S(e){var t=w(e);if(!t)return!1;var r=t[0],s=t[1];return r===n&&s>=i&&s<=X}function C(){if(t)try{throw new Error}catch(t){var e=t.stack.split("\n"),i=w(e[0].indexOf("@")>0?e[1]:e[2]);if(!i)return;return n=i[0],i[1]}}function I(e){return e instanceof D?e:A(e)?(t=e,n=x(),I.nextTick(function(){try{t.then(n.resolve,n.reject,n.notify)}catch(e){n.reject(e)}}),n.promise):z(e);var t,n}I.resolve=I,I.nextTick=s,I.longStackSupport=!1;var _=1;function x(){var e,n=[],i=[],r=p(x.prototype),s=p(D.prototype);if(s.promiseDispatch=function(t,r,s){var o=u(arguments);n?(n.push(o),"when"===r&&s[1]&&i.push(s[1])):I.nextTick(function(){e.promiseDispatch.apply(e,o)})},s.valueOf=function(){if(n)return s;var t=B(e);return T(t)&&(e=t),t},s.inspect=function(){return e?e.inspect():{state:"pending"}},I.longStackSupport&&t)try{throw new Error}catch(e){s.stack=e.stack.substring(e.stack.indexOf("\n")+1),s.stackCounter=_++}function o(r){e=r,I.longStackSupport&&t&&(s.source=r),h(n,function(e,t){I.nextTick(function(){r.promiseDispatch.apply(r,t)})},void 0),n=void 0,i=void 0}return r.promise=s,r.resolve=function(t){e||o(I(t))},r.fulfill=function(t){e||o(z(t))},r.reject=function(t){e||o(H(t))},r.notify=function(t){e||h(i,function(e,n){I.nextTick(function(){n(t)})},void 0)},r}function E(e){if("function"!=typeof e)throw new TypeError("resolver must be a function.");var t=x();try{e(t.resolve,t.reject,t.notify)}catch(e){t.reject(e)}return t.promise}function k(e){return E(function(t,n){for(var i=0,r=e.length;i<r;i++)I(e[i]).then(t,n)})}function D(e,t,n){void 0===t&&(t=function(e){return H(new Error("Promise does not support operation: "+e))}),void 0===n&&(n=function(){return{state:"unknown"}});var i=p(D.prototype);if(i.promiseDispatch=function(n,r,s){var o;try{o=e[r]?e[r].apply(i,s):t.call(i,r,s)}catch(e){o=H(e)}n&&n(o)},i.inspect=n,n){var r=n();"rejected"===r.state&&(i.exception=r.reason),i.valueOf=function(){var e=n();return"pending"===e.state||"rejected"===e.state?i:e.value}}return i}function O(e,t,n,i){return I(e).then(t,n,i)}function B(e){if(T(e)){var t=e.inspect();if("fulfilled"===t.state)return t.value}return e}function T(e){return e instanceof D}function A(e){return(t=e)===Object(t)&&"function"==typeof e.then;var t}"object"==typeof e&&e&&e.env&&e.env.Q_DEBUG&&(I.longStackSupport=!0),I.defer=x,x.prototype.makeNodeResolver=function(){var e=this;return function(t,n){t?e.reject(t):arguments.length>2?e.resolve(u(arguments,1)):e.resolve(n)}},I.Promise=E,I.promise=E,E.race=k,E.all=V,E.reject=H,E.resolve=I,I.passByCopy=function(e){return e},D.prototype.passByCopy=function(){return this},I.join=function(e,t){return I(e).join(t)},D.prototype.join=function(e){return I([this,e]).spread(function(e,t){if(e===t)return e;throw new Error("Q can't join: not the same: "+e+" "+t)})},I.race=k,D.prototype.race=function(){return this.then(I.race)},I.makePromise=D,D.prototype.toString=function(){return"[object Promise]"},D.prototype.then=function(e,t,n){var i=this,r=x(),s=!1;return I.nextTick(function(){i.promiseDispatch(function(t){s||(s=!0,r.resolve(function(t){try{return"function"==typeof e?e(t):t}catch(e){return H(e)}}(t)))},"when",[function(e){s||(s=!0,r.resolve(function(e){if("function"==typeof t){b(e,i);try{return t(e)}catch(e){return H(e)}}return H(e)}(e)))}])}),i.promiseDispatch(void 0,"when",[void 0,function(e){var t,i,s=!1;try{i=e,t="function"==typeof n?n(i):i}catch(e){if(s=!0,!I.onerror)throw e;I.onerror(e)}s||r.notify(t)}]),r.promise},I.tap=function(e,t){return I(e).tap(t)},D.prototype.tap=function(e){return e=I(e),this.then(function(t){return e.fcall(t).thenResolve(t)})},I.when=O,D.prototype.thenResolve=function(e){return this.then(function(){return e})},I.thenResolve=function(e,t){return I(e).thenResolve(t)},D.prototype.thenReject=function(e){return this.then(function(){throw e})},I.thenReject=function(e,t){return I(e).thenReject(t)},I.nearer=B,I.isPromise=T,I.isPromiseAlike=A,I.isPending=function(e){return T(e)&&"pending"===e.inspect().state},D.prototype.isPending=function(){return"pending"===this.inspect().state},I.isFulfilled=function(e){return!T(e)||"fulfilled"===e.inspect().state},D.prototype.isFulfilled=function(){return"fulfilled"===this.inspect().state},I.isRejected=function(e){return T(e)&&"rejected"===e.inspect().state},D.prototype.isRejected=function(){return"rejected"===this.inspect().state};var M,P,N,R=[],j=[],U=[],L=!0;function K(){R.length=0,j.length=0,L||(L=!0)}function H(t){var n,i,r=D({when:function(n){return n&&function(t){if(L){var n=l(j,t);-1!==n&&("object"==typeof e&&"function"==typeof e.emit&&I.nextTick.runAfter(function(){var i=l(U,t);-1!==i&&(e.emit("rejectionHandled",R[n],t),U.splice(i,1))}),j.splice(n,1),R.splice(n,1))}}(this),n?n(t):this}},function(){return this},function(){return{state:"rejected",reason:t}});return n=r,i=t,L&&("object"==typeof e&&"function"==typeof e.emit&&I.nextTick.runAfter(function(){-1!==l(j,n)&&(e.emit("unhandledRejection",i,n),U.push(n))}),j.push(n),i&&void 0!==i.stack?R.push(i.stack):R.push("(no stack) "+i)),r}function z(e){return D({when:function(){return e},get:function(t){return e[t]},set:function(t,n){e[t]=n},delete:function(t){delete e[t]},post:function(t,n){return null===t||void 0===t?e.apply(void 0,n):e[t].apply(e,n)},apply:function(t,n){return e.apply(t,n)},keys:function(){return y(e)}},void 0,function(){return{state:"fulfilled",value:e}})}function F(e,t,n){return I(e).spread(t,n)}function G(e,t,n){return I(e).dispatch(t,n)}function V(e){return O(e,function(e){var t=0,n=x();return h(e,function(i,r,s){var o;T(r)&&"fulfilled"===(o=r.inspect()).state?e[s]=o.value:(++t,O(r,function(i){e[s]=i,0==--t&&n.resolve(e)},n.reject,function(e){n.notify({index:s,value:e})}))},void 0),0===t&&n.resolve(e),n.promise})}function J(e){if(0===e.length)return I.resolve();var t=I.defer(),n=0;return h(e,function(i,r,s){var o=e[s];n++,O(o,function(e){t.resolve(e)},function(e){if(0==--n){var i=e||new Error(""+e);i.message="Q can't get fulfillment value from any promise, all promises were rejected. Last error message: "+i.message,t.reject(i)}},function(e){t.notify({index:s,value:e})})},void 0),t.promise}function W(e){return O(e,function(e){return e=f(e,I),O(V(f(e,function(e){return O(e,r,r)})),function(){return e})})}I.resetUnhandledRejections=K,I.getUnhandledReasons=function(){return R.slice()},I.stopUnhandledRejectionTracking=function(){K(),L=!1},K(),I.reject=H,I.fulfill=z,I.master=function(e){return D({isDef:function(){}},function(t,n){return G(e,t,n)},function(){return I(e).inspect()})},I.spread=F,D.prototype.spread=function(e,t){return this.all().then(function(t){return e.apply(void 0,t)},t)},I.async=function(e){return function(){function t(e,t){var s,o;if("undefined"==typeof StopIteration){try{s=n[e](t)}catch(e){return H(e)}return s.done?I(s.value):O(s.value,i,r)}try{s=n[e](t)}catch(e){return"[object StopIteration]"===m(o=e)||o instanceof c?I(e.value):H(e)}return O(s,i,r)}var n=e.apply(this,arguments),i=t.bind(t,"next"),r=t.bind(t,"throw");return i()}},I.spawn=function(e){I.done(I.async(e)())},I.return=function(e){throw new c(e)},I.promised=function(e){return function(){return F([this,V(arguments)],function(t,n){return e.apply(t,n)})}},I.dispatch=G,D.prototype.dispatch=function(e,t){var n=this,i=x();return I.nextTick(function(){n.promiseDispatch(i.resolve,e,t)}),i.promise},I.get=function(e,t){return I(e).dispatch("get",[t])},D.prototype.get=function(e){return this.dispatch("get",[e])},I.set=function(e,t,n){return I(e).dispatch("set",[t,n])},D.prototype.set=function(e,t){return this.dispatch("set",[e,t])},I.del=I.delete=function(e,t){return I(e).dispatch("delete",[t])},D.prototype.del=D.prototype.delete=function(e){return this.dispatch("delete",[e])},I.mapply=I.post=function(e,t,n){return I(e).dispatch("post",[t,n])},D.prototype.mapply=D.prototype.post=function(e,t){return this.dispatch("post",[e,t])},I.send=I.mcall=I.invoke=function(e,t){return I(e).dispatch("post",[t,u(arguments,2)])},D.prototype.send=D.prototype.mcall=D.prototype.invoke=function(e){return this.dispatch("post",[e,u(arguments,1)])},I.fapply=function(e,t){return I(e).dispatch("apply",[void 0,t])},D.prototype.fapply=function(e){return this.dispatch("apply",[void 0,e])},I.try=I.fcall=function(e){return I(e).dispatch("apply",[void 0,u(arguments,1)])},D.prototype.fcall=function(){return this.dispatch("apply",[void 0,u(arguments)])},I.fbind=function(e){var t=I(e),n=u(arguments,1);return function(){return t.dispatch("apply",[this,n.concat(u(arguments))])}},D.prototype.fbind=function(){var e=this,t=u(arguments);return function(){return e.dispatch("apply",[this,t.concat(u(arguments))])}},I.keys=function(e){return I(e).dispatch("keys",[])},D.prototype.keys=function(){return this.dispatch("keys",[])},I.all=V,D.prototype.all=function(){return V(this)},I.any=J,D.prototype.any=function(){return J(this)},I.allResolved=(M=W,P="allResolved",N="allSettled",function(){return"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(P+" is deprecated, use "+N+" instead.",new Error("").stack),M.apply(M,arguments)}),D.prototype.allResolved=function(){return W(this)},I.allSettled=function(e){return I(e).allSettled()},D.prototype.allSettled=function(){return this.then(function(e){return V(f(e,function(e){function t(){return e.inspect()}return(e=I(e)).then(t,t)}))})},I.fail=I.catch=function(e,t){return I(e).then(void 0,t)},D.prototype.fail=D.prototype.catch=function(e){return this.then(void 0,e)},I.progress=function(e,t){return I(e).then(void 0,void 0,t)},D.prototype.progress=function(e){return this.then(void 0,void 0,e)},I.fin=I.finally=function(e,t){return I(e).finally(t)},D.prototype.fin=D.prototype.finally=function(e){if(!e||"function"!=typeof e.apply)throw new Error("Q can't apply finally callback");return e=I(e),this.then(function(t){return e.fcall().then(function(){return t})},function(t){return e.fcall().then(function(){throw t})})},I.done=function(e,t,n,i){return I(e).done(t,n,i)},D.prototype.done=function(t,n,i){var r=function(e){I.nextTick(function(){if(b(e,s),!I.onerror)throw e;I.onerror(e)})},s=t||n||i?this.then(t,n,i):this;"object"==typeof e&&e&&e.domain&&(r=e.domain.bind(r)),s.then(void 0,r)},I.timeout=function(e,t,n){return I(e).timeout(t,n)},D.prototype.timeout=function(e,t){var n=x(),i=setTimeout(function(){t&&"string"!=typeof t||((t=new Error(t||"Timed out after "+e+" ms")).code="ETIMEDOUT"),n.reject(t)},e);return this.then(function(e){clearTimeout(i),n.resolve(e)},function(e){clearTimeout(i),n.reject(e)},n.notify),n.promise},I.delay=function(e,t){return void 0===t&&(t=e,e=void 0),I(e).delay(t)},D.prototype.delay=function(e){return this.then(function(t){var n=x();return setTimeout(function(){n.resolve(t)},e),n.promise})},I.nfapply=function(e,t){return I(e).nfapply(t)},D.prototype.nfapply=function(e){var t=x(),n=u(e);return n.push(t.makeNodeResolver()),this.fapply(n).fail(t.reject),t.promise},I.nfcall=function(e){var t=u(arguments,1);return I(e).nfapply(t)},D.prototype.nfcall=function(){var e=u(arguments),t=x();return e.push(t.makeNodeResolver()),this.fapply(e).fail(t.reject),t.promise},I.nfbind=I.denodeify=function(e){if(void 0===e)throw new Error("Q can't wrap an undefined function");var t=u(arguments,1);return function(){var n=t.concat(u(arguments)),i=x();return n.push(i.makeNodeResolver()),I(e).fapply(n).fail(i.reject),i.promise}},D.prototype.nfbind=D.prototype.denodeify=function(){var e=u(arguments);return e.unshift(this),I.denodeify.apply(void 0,e)},I.nbind=function(e,t){var n=u(arguments,2);return function(){var i=n.concat(u(arguments)),r=x();return i.push(r.makeNodeResolver()),I(function(){return e.apply(t,arguments)}).fapply(i).fail(r.reject),r.promise}},D.prototype.nbind=function(){var e=u(arguments,0);return e.unshift(this),I.nbind.apply(void 0,e)},I.nmapply=I.npost=function(e,t,n){return I(e).npost(t,n)},D.prototype.nmapply=D.prototype.npost=function(e,t){var n=u(t||[]),i=x();return n.push(i.makeNodeResolver()),this.dispatch("post",[e,n]).fail(i.reject),i.promise},I.nsend=I.nmcall=I.ninvoke=function(e,t){var n=u(arguments,2),i=x();return n.push(i.makeNodeResolver()),I(e).dispatch("post",[t,n]).fail(i.reject),i.promise},D.prototype.nsend=D.prototype.nmcall=D.prototype.ninvoke=function(e){var t=u(arguments,1),n=x();return t.push(n.makeNodeResolver()),this.dispatch("post",[e,t]).fail(n.reject),n.promise},I.nodeify=function(e,t){return I(e).nodeify(t)},D.prototype.nodeify=function(e){if(!e)return this;this.then(function(t){I.nextTick(function(){e(null,t)})},function(t){I.nextTick(function(){e(t)})})},I.noConflict=function(){throw new Error("Q.noConflict only works when Q is used as a global")};var X=C();return I})}).call(this,e("_process"))},{_process:12}],14:[function(e,t,n){var i=e("btoa"),r=(e("atob"),e("crypto-js/hmac-sha256")),s=e("crypto-js/enc-base64");e("crypto-js/enc-utf8");t.exports=function(e,t,n,o){var a={applicationKey:e,identity:{type:"username",endpoint:n.username},created:o||(new Date).toISOString(),expiresIn:86400},c=JSON.stringify(a).replace(" ","");return{userTicket:i(c)+":"+r(c,s.parse(t)).toString(s)}}},{atob:15,btoa:3,"crypto-js/enc-base64":6,"crypto-js/enc-utf8":7,"crypto-js/hmac-sha256":8}],15:[function(e,t,n){(function(e){!function(){"use strict";t.exports=function(t){return new e(t,"base64").toString("binary")}}()}).call(this,e("buffer").Buffer)},{buffer:4}],16:[function(e,t,n){var i,r=e("q"),s=e("../VERSION"),o=e("sinch-ticketgen"),a={ErrorDomainNone:-1,ErrorDomainNetwork:0,ErrorDomainCapability:1,ErrorDomainSession:2,ErrorDomainApi:3,ErrorDomainOther:4,ErrorDomainSDK:5,ErrorDomainVerification:7},c={NoneNone:0,NetworkConnectionRefused:1e3,NetworkConnectionTimedOut:1001,NetworkServerError:1002,CapabilityUserNotFound:2e3,CapabilityCapabilityMissing:2001,CapabilityAuthenticationFailed:2002,SessionFailedToInitiateSession:3e3,SessionNoPendingSessionExists:3001,SessionTransferCantBeInitiated:3002,SessionActiveUserLimitReached:3003,ApiApiCallFailed:4e3,OtherInvalidOfflinePayloadTooBig:5e3,OtherInvalidOfflineInvitePayloadFailedToDecode:5001,OtherInvalidOfflineInviteUnknownType:5002,OtherOther:5003,SDKUnexpectedCall:6e3,SDKInternalError:6001,SDKInternalOther:6002,SDKMissingParameter:6003,SDKMissingCallback:6004,VerificationInvalidInput:7001,VerificationServiceError:7002,VerificationIncorrectCode:7003,VerificationFailedToInterceptCode:7004,VerificationUnexpectedInitiateError:7005},u=function(e,t){var n={method:e.method,headers:{"Content-Type":"application/json; charset=UTF-8",Accept:"application/json, text/plain, */*"}};"GET"!=e.method&&(n.data=t),n.url="";for(var i in e.urlParts){if(":"===e.urlParts[i][0]){var s=e.urlParts[i].slice(1);n.url+=encodeURIComponent((t||{})[s]).replace(/%2B/g,"+").replace(/%40/g,"@")}else n.url+=e.urlParts[i];i<e.urlParts.length-1&&(n.url+="/")}switch(e.auth){case"sign":n.headers=this.signSession(n);break;case"nosign":n.headers=this.signApp(n);break;case"ticket":n.headers=this.signTicket(n),delete n.data.authorization;break;case"signorticket":this._sessionId?n.headers=this.signSession(n):(n.headers=this.signTicket(n),delete n.data.authorization);break;default:throw new Error("Unsupported authentication type: "+e.auth)}if("GET"===e.method&&t&&Object.keys(t).length>0&&!e.hideQueryParams){n.url+="?";for(var o in t)n.url+=encodeURIComponent(o)+"="+encodeURIComponent(t[o])+"&"}return function(e){var t=r.defer(),n=new XMLHttpRequest;n.onload=function(){if(n.status>=200&&n.status<300){try{n.response=n.response||n.responseText,n.data=JSON.parse(n.response||"{}")}catch(e){console.log("Cant parse JSON"+n.response)}t.resolve(n.data)}else{try{n.response=n.response||n.responseText,n.data=JSON.parse(n.response||"{}")}catch(e){console.log("Cant parse JSON"+n.response)}t.reject(n)}},n.onerror=function(){t.reject(new Error("Unsupported operation "+n.status,n))},n.open(e.method,e.url,!0);for(var i in e.headers)n.setRequestHeader(i,e.headers[i]);return n.send(JSON.stringify(e.data)),t.promise}(n)},h=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})};function Notification(e,t,n,i){this.progress=e/t,this.message=n,this.object=i}function l(){var e,t=navigator.userAgent,n=t.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||t.match(/(applewebkit(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(n[1])?"IE "+((e=/\brv[ :]+(\d+)/g.exec(t)||[])[1]||""):"Chrome"===n[1]&&null!=(e=t.match(/\bOPR\/(\d+)/))?"Opera "+e[1]:(n=n[2]?[n[1],n[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(e=t.match(/version\/(\d+)/i))&&n.splice(1,1,e[1]),n.join("/").substring(0,50))}function f(){return navigator.platform}function p(e){if(!e)throw new TypeError("Could not create SinchClient, configuration not provided.");if(e.capabilities=e.capabilities||{},"string"!=typeof e.applicationKey)throw new TypeError("Could not create SinchClient, applicationKey is not a string");this.capabilities=e.capabilities,this._appKey=e.applicationKey||"",this._appSecret=e.applicationSecret||void 0,this._sessionId="",this._sessionSecret="",this._logHandler=e.onLogMessage||function(){},this._logMxpHandler=e.onLogMxpMessage||function(){},this._onlineCapability=e.startActiveConnection||e.supportActiveConnection||!1,this._autoStartMxp=e.startActiveConnection||!1,this._expiresIn=e.expiresIn||86400,this._subInstanceId=Math.round(Math.random()*Math.pow(2,32)),this._customStream=e.customStream||void 0,this._supportVideo=e.capabilities.video||!1,this._multiCall=e.capabilities.multiCall||!1,this.applicationKey=this._appKey,this._supportManagedPush=e.supportManagedPush,this._progressTimeout=e.progressTimeout||10500,this.firefox=!1,"undefined"!=typeof navigator&&(this.firefox=(navigator||{userAgent:""}).userAgent.indexOf("Firefox")>0||(navigator||{vendor:""}).vendor.indexOf("Apple Computer")>0),this._url={base:"https://api.sinch.com/v1/",user:"https://userapi.sinch.com/v1/",portal:"https://portalapi.sinch.com/v1/",reporting:"https://reportingapi.sinch.com/v1/",reporting_v2:"https://reportingapi.sinch.com/v2/",calling:"https://callingapi.sinch.com/v1/",messaging:"https://messagingapi.sinch.com/v1/",verification:"https://verificationapi-v1.sinch.com/verification/v1/"},this.setUrl(e.urlObj||{}),this.loadPAPIUrl(),this.loadTimeDelta(),this.user=new R(this),"messaging"in this.capabilities&&this.capabilities.messaging&&(this.messageClient=new T(this)),"calling"in this.capabilities&&this.capabilities.calling&&(this.callClient=new m(this,e.customStream)),"stealth"in this.capabilities&&this.capabilities.stealth&&(this.callClient=new m(this,e.customStream))}(i=i||{}).base={getServerTime:{url:"timestamp/",method:"GET",auth:"nosign"},getInstance:{url:"instance",method:"POST",auth:"ticket"},renewInstance:{url:"instance",method:"POST",auth:"sign"},renewSecret:{url:"instances/id/:instanceId/authorization",method:"PUT",auth:"ticket"},getInstances:{url:"instances/id/",method:"GET",auth:"sign"}},(i=i||{}).calling={getConfiguration:{url:"configuration/user",method:"GET",auth:"sign"},placeCall:{url:"calls/:domain",method:"POST",auth:"sign"},callReporting:{url:"calls/:domain/id/:callId",method:"PUT",auth:"sign"},postMedia:{url:"media",method:"POST",auth:"sign"},pushCall:{url:"push",method:"POST",auth:"sign"}},(i=i||{}).messaging={getTransportById:{url:"transport",method:"GET",auth:"sign"},getTransportByParticipants:{url:"transport",method:"POST",auth:"sign"},messageReporting:{url:"report/im",method:"POST",auth:"sign"},pushMessage:{url:"push/messages",method:"POST",auth:"sign"}},(i=i||{}).user={authenticate:{url:"users/email/:email/authentication",method:"POST",auth:"nosign"},authenticateUsername:{url:"users/username/:username/authentication",method:"POST",auth:"nosign"},authenticateNumber:{url:"users/number/:number/authentication",method:"POST",auth:"nosign"},createUser:{url:"users",method:"POST",auth:"nosign"},changePassword:{url:"user/password",method:"PUT",auth:"sign"},updateUser:{url:"user/profile",method:"PATCH",auth:"sign"},getUserProfile:{url:"user/profile",method:"GET",auth:"sign"}},(i=i||{}).verification={verify:{url:"verifications",method:"POST",auth:"nosign"},confirmVerification:{url:"verifications/number/:number",method:"PUT",auth:"nosign"},confirmUserCallout:{url:"verifications",method:"POST",auth:"nosign"},confirmFlashCall:{url:"verifications/number/:number",method:"PUT",auth:"nosign"},queryVerificationById:{url:"verifications/callout/number/:number",method:"GET",hideQueryParams:!0,auth:"nosign"}},p.prototype.loadPAPIUrl=function(){this.PAPI=JSON.parse(JSON.stringify(i));for(var e in i)for(var t in i[e])this.PAPI[e][t].urlParts=(this._url[e]+this.PAPI[e][t].url).split("/"),this[t]=u.bind(this,this.PAPI[e][t])},p.prototype.loadTimeDelta=function(){var e=r.defer();return this.timeDelta?e.resolve():this.getServerTime().then(function(t){var n=new Date(t.timestamp),i=new Date;this.timeDelta=n-i,e.resolve()}.bind(this)).catch(function(t){console.error(t),e.fail(t)}),e.promise},p.prototype.config=function(e){this._appKey=e.appKey||this._appKey,this._sessionId=e.sessionId||this._sessionId,this._sessionSecret=e.sessionSecret||this._sessionSecret,localStorage["SinchSDK-"+this._appKey+"-"+this.user.userId]=this._sessionId},p.prototype.loadSessionId=function(){this._sessionId=localStorage["SinchSDK-"+this._appKey+"-"+this.user.userId]||""},p.prototype.log=function(e,t){t&&t.notify(e),this._logHandler(e)},p.prototype.logMxp=function(e){this._logMxpHandler(e)},p.prototype.setUrl=function(e){this._url.user=e.user||this._url.user,this._url.base=e.base||this._url.base,this._url.portal=e.portal||this._url.portal,this._url.reporting=e.reporting||this._url.reporting,this._url.reporting_v2=e.reporting_v2||this._url.reporting_v2,this._url.calling=e.calling||this._url.calling,this._url.messaging=e.messaging||this._url.messaging,this._url.verification=e.verification||this._url.verification,this.loadPAPIUrl()},p.prototype.terminate=function(){try{this.mxp&&this.mxp.close(),this.mxp.destroy(),this.mxp&&delete this.mxp,this._sessionId="",this._sessionSecret="",this.messageClient&&this.messageClient.destroy()}catch(e){}},p.prototype.stop=function(){console.error("Stop is deprecated, use terminate() instead!"),this.terminate()},p.prototype.adjustedTime=function(){var e=(new Date).getTime();return new Date(e+(this.timeDelta||0)).toISOString()},p.prototype.signSession=function(e){try{var t="";if(void 0!==e.data){var n="string"!=typeof e.data?JSON.stringify(e.data):e.data;t=W.MD5(n).toString(W.enc.Base64)}e.headers["Content-Type"]=(e.headers["Content-Type"]||"").replace("utf-8","UTF-8").replace("/json;chars","/json; chars"),e.headers["X-Timestamp"]=e.headers["X-Timestamp"]||this.adjustedTime();var i=e.method+"\n"+t+"\n"+(e.headers["Content-Type"]||"")+"\nx-timestamp:"+e.headers["X-Timestamp"]+"\n"+e.url.match(/^https?:\/\/[^\/]+([^#]*)/)[1];if(this._sessionId.length>0&&this._sessionSecret.length>0){var r=W.HmacSHA256(W.enc.Utf8.parse(i),W.enc.Base64.parse(this._sessionSecret)).toString(W.enc.Base64);e.headers.Authorization="instance "+this._sessionId+":"+r}else e.headers.Authorization="application "+this._appKey;return e.headers}catch(e){throw e}return null},p.prototype.signTicket=function(e,t){return t=t||e.data.authorization,e.headers=e.headers||{},e.headers.Authorization="user "+t,e.headers["X-Timestamp"]=this.adjustedTime(),e.headers},p.prototype.signApp=function(e){try{return e.headers["X-Timestamp"]=e.headers["X-Timestamp"]||this.adjustedTime(),e.headers.Authorization="application "+this._appKey,e.headers}catch(e){throw e}return null},p.prototype.getSession=function(){return{userId:this.user.userId,sessionId:this._sessionId,sessionSecret:this._sessionSecret,pushNotificationDisplayName:this.user.pushNotificationDisplayName}},p.prototype.newUser=function(e,t,n){var i=r.defer();return t=t||function(e){return console.info("User successfully created"),e},n=n||function(e){console.error(e)},this.user.create(e).then(t).then(i.resolve).fail(function(e){this.log(e),n(e),i.reject(e)}.bind(this)),i.promise},p.prototype.start=function(e,t,n){var i=r.defer();if(t=t||function(){this.log(new Notification(0,1,"SinchClient started"))}.bind(this),n=n||function(e){console.error(e)},this.started){var s=new Error("Sinch client already started");n(s),i.reject(s)}else e&&(this.user.pushNotificationDisplayName=e.pushNotificationDisplayName),this.started=!0,this.loadTimeDelta().then(function(e){return this.log(new Notification(0,5,"Get authentication token"),i),this.user.authenticate(e)}.bind(this,e),e).then(function(e){return this.loadSessionId(),e}.bind(this)).then(function(e){return this.log(new Notification(1,5,"Get instance using auth token"),i),e&&e.sessionId&&e.sessionSecret?this.user.resumeSession(e):this.user.initSessKeySecret()}.bind(this)).fail(function(e){if(40400===((e||{response:{}}).response||{}).errorCode)return this.log(new Notification(1,5,"Invalid instance. Will try again without any pre-set instance ID."),i),this._sessionId="",this.user.initSessKeySecret();throw e}.bind(this)).then(function(){return this.log(new Notification(2,5,"Get MXP configuration"),i),this.user.getMXPConf()}.bind(this)).then(function(){this.log(new Notification(3,5,"Create MXP object"),i),this.mxp=new z(this)}.bind(this)).then(function(){if(this._autoStartMxp&&(void 0!==this.messageClient||void 0!==this.callClient))return this.log(new Notification(4,5,"Will start active connection"),i),this.startActiveConnection();this.log(new Notification(4,5,"Will NOT start active connection. This will prevent IM and incoming data calls."),i)}.bind(this)).then(t).then(function(){this.log(new Notification(5,5,"Successfully started SinchClient"),i),i.resolve()}.bind(this)).fail(function(e){this.started=!1,this._sessionId="",this._sessionSecret="",this.log(e),n(e),i.reject(e)}.bind(this));return i.promise},p.prototype.getMessageClient=function(){if("messaging"in this.capabilities&&this.capabilities.messaging)return this.messageClient;throw new SinchError(a.ErrorDomainSDK,c.SDKInternalOther,"No messaging capability, not possible to retrieve messageClient")},p.prototype.getCallClient=function(){if("calling"in this.capabilities&&this.capabilities.calling)return this.callClient;throw new SinchError(a.ErrorDomainSDK,c.SDKInternalOther,"No calling capability, not possible to retrieve callClient")},p.prototype.createSmsVerification=function(e,t){return new j(this,e,t,"sms")},p.prototype.createCalloutVerification=function(e,t){return new E(this,e,t)},p.prototype.createFlashCallVerification=function(e,t){return new j(this,e,t,"flashcall")},p.prototype.createVerification=function(e,t,n){return new j(this,e,t,n.toLowerCase())},p.prototype.startActiveConnection=function(){if(this._onlineCapability&&this.started)return this.log(new Notification(4,5,"Manually starting active connection")),this.mxp.init();if(!this._onlineCapability)throw new SinchError(a.ErrorDomainSDK,c.SDKInternalOther,'No online capability, can not start active connection. Set configuration option "supportActiveConnection" to "true" when instantiating the SinchClient');this._autoStartMxp=!0},p.prototype.stopActiveConnection=function(){if(this._onlineCapability)return this.log(new Notification(4,5,"Manually closing active connection")),this.mxp.close();throw new SinchError(a.ErrorDomainSDK,c.SDKInternalOther,'No online capability, can not start active connection. Set configuration option "supportActiveConnection" to "true" when instantiating the SinchClient')},p.prototype.getVersion=function(){try{return s.version[1]}catch(e){return"dev"}},p.prototype.onnotification=function(e,t){};var d=d||{};function g(e,t,n){this.sinch=e,this.eventListeners=[],this.peerConnections={},this.callId=n||h(),this.callDomain="None",this.callOutbound=void 0,this.fromId="",this.toId="",this.webRtcConfig={iceServers:[{urls:["stun:23.21.150.121","stun:stun.l.google.com:19302"]}]};var i=navigator.userAgent.match(/Chrom[e|ium]\/([0-9]+)\./),r=!!i&&parseInt(i[1],10),s=navigator.userAgent.match(/Firefox\/([0-9]+)\./),o=!!s&&parseInt(s[1],10);(r>=48||o>=42)&&(this.sinch.log(new Notification(0,1,"Chrome >= 48 or FF >= 42 detected, will generate certificate manually for better compatibility")),v.generateCertificate({name:"ECDSA",namedCurve:"P-256"}).then(function(e){this.sinch.log(new Notification(0,1,"New certificate generated and configured!")),this.webRtcConfig.certificates=[e]}.bind(this))),this.outgoingStream=void 0,this.incomingStream=void 0,this.earlymedia=void 0,this.callState=S.INITIATING,this.callEndCause=C.NONE,this.timeProgressing=null,this.timeEstablished=null,this.timeEnded=null,this.error=null,this.autoAnswer=!1,this.autoHangup=!1,this.videoSupport=t||!1,this.clientMap={},this.activeInstance=void 0,this.dataChannels={},this.proxyUrl=void 0,this.customHeaders=void 0,this.joinBuffer={};var a={onCallEnded:function(e){this.sinch.mxp.unsubscribe("signalPubNub")}.bind(this)};this.addEventListener(a);var c="web",u="0";try{c=l().split("/")[0],u=l().split("/")[1]}catch(e){}var p={onCallEnded:function(t){var n=t.getDetails();if(n.startedTime){var i={callId:t.callId,domain:t.callDomain,outbound:t.callOutbound,fromId:t.fromId,toId:t.toId,callTime:new Date(n.startedTime).toISOString(),duration:n.duration,setupDuration:(t.timeEstablished-t.timeProgressing)/1e3||0,result:t.callEndCause,deviceInformation:{ModelId:f()||"unknown",OSName:c,OSVersion:u,SDKPlatform:"js",SDKPlatformVersion:e.getVersion()}};t.sinch.callReporting(i).fail(function(){console.error("Could not report call!")})}t.ffIceTimer&&clearInterval(t.ffIceTimer)}};this.addEventListener(p)}function y(e){this.endCause=e.endCause,this.endedTime=e.endedTime,this.error=e.error,this.establishedTime=e.establishedTime,this.startedTime=e.startedTime,this.duration=e.duration}function m(e,t){if(!(e instanceof p))throw new Error("CallClient can't be instantiated, use getCallClient in an SinchClient instance");var n=navigator.userAgent.toLowerCase();if(n.indexOf("msie")>-1||/Edge/.test(n))throw new Error("SinchClient can't be started with calling capability. Browser not supported.");this.sinch=e,this.eventListeners=[],this.callBuffert={},this.localMediaStream=void 0,this.incomingCallCustomStream=t,this.groupChannel=void 0}v=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection||d.RTCPeerConnection,b=window.RTCSessionDescription||window.mozRTCSessionDescription||window.webkitRTCSessionDescription||d.RTCSessionDescription,w=window.RTCIceCandidate||window.mozRTCIceCandidate||d.RTCIceCandidate,g.prototype.addEventListener=function(e){this.eventListeners.push(e)},g.prototype.removeEventListener=function(e){this.eventListeners.splice(this.eventListeners.indexOf(e),1)},g.prototype.setStream=function(e){this.outgoingStream=e,this.execListener("onLocalStream",e)},g.prototype.execListener=function(e,t){this.eventListeners.forEach(function(n){try{return n[e]&&n[e](this,t)}catch(t){var i=new SinchError(a.ErrorDomainSDK,c.SDKInternalOther,"Error executing listener: "+e,t);throw console.error(i),i}}.bind(this))},g.prototype.setEndCause=function(e){this.callEndCause===C.NONE&&(this.callEndCause=e)},g.prototype.setParticipants=function(e,t){this.callOutbound=e==this.sinch.user.userId,this.toId=t,this.fromId=e},g.prototype.progress=function(e){if(this.callState!=S.INITIATING)throw new SinchError(a.ErrorDomainOther,c.OtherOther,"Progress: Invalid call state for progressing",g);this.sinch.log(new Notification(0,1,"Call changing state to PROGRESSING")),this.timeProgressing=new Date,this.callState=S.PROGRESSING,e&&this.execListener("onCallProgressing"),this.autoAnswer&&this.answer(),this.autoHangup&&this.hangup()},g.prototype.establish=function(){this.callState==S.PROGRESSING?(this.sinch.log(new Notification(0,1,"Call changing state to ESTABLISHED")),this.cleanPeerConnections(!1),"connection"!=this.callDomain&&this.unmute(),this.timeEstablished=new Date,this.callState=S.ESTABLISHED,this.execListener("onCallEstablished")):console.log("Call state not in PROGRESSING, cant process second JOIN")},g.prototype.mxpAck=function(e){if(this.sinch.log(new Notification(0,1,"Call ACK Received",e)),this.callState!=S.INITIATING&&this.callState!=S.PROGRESSING)throw new SinchError(a.ErrorDomainOther,c.OtherOther,"Invalid call state for processing Ack",g);this.clientMap[e.getSenderId()]=this.clientMap[e.getSenderId()]||e.getFrom(),this.processRTCAnswer(e).then(function(){"yes"===(e.decrypted.nvps||{}).earlymedia?(this.activeInstance=e.getSenderId(),this.progress(!1),this.establish(),this.earlymedia=!0):this.progress(!0),this.joinBuffer[e.getSenderId()]&&(this.sinch.log(new Notification(0,1,"Buffered JOIN was detected for this Ack, will immediatley process & remove.")),this.mxpJoin(this.joinBuffer[e.getSenderId()]),delete this.joinBuffer[e.getSenderId()])}.bind(this))},g.prototype.processRTCAnswer=function(e){var t=r.defer(),n=this.getPeerConnectionInstance(e.getSenderId());return n.setRelayUrl(this.relayUrl),null==n.offer?(this.sinch.log(new Notification(0,1,"Send deny to instance: "+n.offer)),this.sinch.mxp.callDeny(this,n.instanceId).fail(function(e){}),t.resolve()):this.callState!=S.ENDED&&"media"!=e.decrypted.bt&&null!=e.decrypted.bd?n.setRemoteDescription(new b(JSON.parse(e.decrypted.bd))).then(function(){t.resolve()}.bind(this)):t.resolve(),t.promise},g.prototype.sendCancel=function(e,t){setTimeout(function(){this.setEndCause(e),this.error=new SinchError(a.ErrorDomainSDK,c.SDKInternalOther,t),this.sinch.mxp.callCancel(this).fail(function(e){throw new SinchError(a.ErrorDomainSDK,c.SDKInternalOther,"Error sending call Cancel")}),this.callFailure()}.bind(this),2e3)},g.prototype.mxpPeerEventSdp=function(e){if(this.callState==S.INITIATING||this.callState==S.PROGRESSING)this.disableIce=!0,this.processRTCAnswer(e);else if(this.callState==S.ESTABLISHED){var t=JSON.parse(e.decrypted.bd),n=new b(t),i=this.getPeerConnectionInstance(e.getSenderId());"offer"==t.type?(this.sinch.log(new Notification(0,3,"Got renegotiation SDP Offer",t)),i.setRemoteDescription(n).then(function(){this.sinch.log(new Notification(1,3,"Successfully configured SDP Offer.",t)),i.createAnswer().then(function(t){this.sinch.log(new Notification(2,3,"Successfully created SDP Answer.",t)),this.sinch.mxp.callTxPeerEventSDP(this,t,e.getSenderId()).fail(function(e){throw new SinchError(a.ErrorDomainSDK,c.SDKInternalOther,"Error sending SDP Answer")})}.bind(this)).fail(function(e){console.error("Major error in creating answer",e)})}.bind(this),function(e){throw this.sendCancel(C.FAILURE,e),new SinchError(a.ErrorDomainSDK,c.SDKInternalOther,"Error setting remote SDP")}.bind(this))):"answer"==t.type&&(this.sinch.log(new Notification(0,2,"Got renegotiation SDP Answer",t)),i.setRemoteDescription(RTCdescription,function(){this.sinch.log(new Notification(1,2,"Configured incoming SDP Answer",t))}.bind(this),function(e){throw this.sendCancel(C.FAILURE,e),new SinchError(a.ErrorDomainSDK,c.SDKInternalOther,"Error setting remote SDP")}))}},g.prototype.mxpInjectIce=function(e){if(this.callState!=S.ENDED){this.sinch.log(new Notification(0,2,"Recieved ICE Candidate from B",e));var t=JSON.parse(e.decrypted.bd);t.candidate=t.cand||t.candidate,t.sdpMLineIndex=t.sdpMLI||t.sdpMLineIndex,this.getPeerConnectionInstance(e.getSenderId()).addRemoteIceCandidate(t)}},g.prototype.mxpJoin=function(e){if(this.sinch.log(new Notification(0,1,"Call JOIN Received",e)),this.activeInstance&&this.activeInstance!=e.getSenderId())throw console.error("Can not process JOIN, call in session after previous JOIN"),new SinchError(a.ErrorDomainSession,c.SessionActiveUserLimitReached,"Can not process JOIN, call in session after previous JOIN");var t=e.getSenderId();this.callState==S.INITIATING?(this.sinch.log(new Notification(0,1,"JOIN received before ACK. Will cache JOIN to process after ACK.")),this.joinBuffer[t]=e):r.fcall(function(){var t=r.defer(),n=this.getPeerConnectionInstance(e.getSenderId());return"sdp"===e.decrypted.bt&&e.decrypted.bd&&!n.hasRemoteDescription()?n.setRemoteDescription(new b(JSON.parse(e.decrypted.bd))).then(function(){this.sinch.log(new Notification(1,2,"Configured incoming SDP Join",e.decrypted.bd)),t.resolve()}.bind(this)).fail(function(e){throw this.sendCancel(C.FAILURE,e),new SinchError(a.ErrorDomainSDK,c.SDKInternalOther,"Error setting remote SDP")}):t.resolve(),t.promise}.bind(this)).then(function(){if(this.callState!=S.PROGRESSING&&!this.earlymedia)throw console.error("Can not process JOIN, call in unexpected state. Call state: "+this.getState()),new SinchError(a.ErrorDomainSDK,c.SDKInternalOther,"Can not process JOIN, call in unexpected state.");this.activeInstance=e.getSenderId(),this.sinch.mxp.callJoined(this).then(function(){this.sinch.log(new Notification(0,1,"Successfully sent JOINED",this)),this.earlymedia||this.establish()}.bind(this)).fail(function(e){console.error("Unhandled error in call.mxpJoin.",e)})}.bind(this)).fail(function(e){console.error("Error processing JOIN",e)})},g.prototype.mxpJoined=function(e){(this.sinch.log(new Notification(0,1,"Call JOINED Received",e)),this.callState==S.INITIATING||this.callState==S.PROGRESSING)?JSON.parse(e.decrypted.bd).fi!=this.sinch._sessionId+":"+this.sinch._subInstanceId?(this.setEndCause(C.OTHER_DEVICE_ANSWERED),this.mxpHangup()):this.callState==S.PROGRESSING&&this.establish():console.log("Call state already ESTABLISHED (or ENDED), cant process second JOIN")},g.prototype.mxpHangup=function(e){this.callState!=S.ENDED&&(this.sinch.log(new Notification(0,1,"Call HANGUP Received",e)),this.callState==S.ESTABLISHED?this.setEndCause(C.HUNG_UP):this.setEndCause(C.CANCELED),this.timeEnded=new Date,this.callState=S.ENDED,this.execListener("onCallEnded"),this.cleanPeerConnections(!0))},g.prototype.cleanPeerConnections=function(e){for(var t in this.peerConnections)this.peerConnections[t]&&(e||t!=this.activeInstance)&&(this.peerConnections[t].close(),delete this.peerConnections[t])},g.prototype.mxpDeny=function(e){if(this.callState!=S.ENDED){if(this.sinch.log(new Notification(0,1,"Call DENIED Received",e)),this.setEndCause(C.DENIED),"error/json"==e.decrypted.bt){this.error=new SinchError(a.ErrorDomainApi,c.ApiApiCallFailed,"");var t=JSON.parse(e.decrypted.bd);for(var n in t)this.error[n]=t[n];this.error.message=t.code+" "+t.reason,this.error.mxp=e.decrypted}this.callState==S.INITIATING?(this.autoHangup=!0,this.progress(!0)):"no"==(e.decrypted.nvps||{}).denyall?this.mxpHangup():this.hangup()}},g.prototype.mxpCancel=function(e){if(this.callState!=S.ENDED){this.sinch.log(new Notification(0,1,"Call CANCEL Received",e)),this.timeEnded=new Date,this.callState=S.ENDED;Date.now();this.setEndCause(C.CANCELED),this.execListener("onCallEnded"),this.cleanPeerConnections(!0)}},g.prototype.mxpFail=function(e){if(this.sinch.log(new Notification(0,1,"Call FAILURE Received",e)),"message"==e.decrypted.bt)this.error=new SinchError(a.ErrorDomainApi,c.ApiApiCallFailed,""),this.error.message=e.decrypted.bd,this.error.mxp=e.decrypted;else if("error/json"==e.decrypted.bt){this.error=new SinchError(a.ErrorDomainApi,c.ApiApiCallFailed,"");var t=JSON.parse(e.decrypted.bd);for(var n in t)this.error[n]=t[n];this.error.message=t.code+" "+t.reason,this.error.mxp=e.decrypted}this.callFailure()},g.prototype.callFailure=function(){this.timeEnded=new Date,this.callState=S.ENDED,this.setEndCause(C.FAILURE),this.execListener("onCallEnded"),this.cleanPeerConnections(!0)},g.prototype.addEventListenerPrototype=function(e){e.onOpen&&(this.onopen=e.onOpen),e.onClose&&(this.onclose=e.onClose),e.onMessage&&(this.onmessage=e.onMessage)},g.prototype.setCallTimeouts=function(e,t){setTimeout(function(){this.pushService&&this.pushService.push(!0,this.callState)?this.progress(!0):this.callState==S.INITIATING&&(this.sinch.log(new Notification(0,1,"Call PROGRESSING timeout. Will hangup call.",this)),this.setEndCause(C.TIMEOUT),this.hangup())}.bind(this),e),setTimeout(function(){this.callState==S.PROGRESSING&&(this.sinch.log(new Notification(0,1,"Call ESTABLISHED timeout. Will hangup call.",this)),this.setEndCause(C.NO_ANSWER),this.hangup())}.bind(this),t)},g.prototype.getCallObject=function(e,t){var n={cli:"",destination:{type:{pstn:"number",data:"username",conference:"username",connection:"username",sip:"username"}[t],endpoint:e},callId:this.callId,mediaChannels:["audio"],subinstanceId:this.sinch._subInstanceId,headers:{p2p:"yes"},domain:{pstn:"pstn",data:"data",conference:"conference",connection:"data",sip:"sip"}[t]};return this.sinch._supportVideo&&n.mediaChannels.push("video"),this.customHeaders&&(n.headers.ph=JSON.stringify(this.customHeaders)),"connection"==t&&(n.headers.nomedia=!0),n},g.prototype.getPeerConnectionInstance=function(e){if(e&&this.peerConnections[""])return this.peerConnections[e]=this.peerConnections[""],delete this.peerConnections[""],this.peerConnections[e].updateInstanceId(e),this.peerConnections[e];var t=e||"";return this.peerConnections[t]||(this.peerConnections[t]=new A(e,this.webRtcConfig,this.outgoingStream,this)),this.peerConnections[t]},g.prototype.createInstances=function(e){if(!e)return null;for(var t={},n=0;n<e.length;++n)t[e[n].instanceId]={},t[e[n].instanceId].capabilities=e[n].capabilities;return t},g.prototype.getPlaceCallResponse=function(e){return{body:e.body||e.Body,signalChannel:e.signalChannel||e.SignalChannel,instances:e.instances||e.Instances,encryptionKey:e.encryptionKey||e.EncryptionKey}},g.prototype.placeCall=function(e,t){var n=r.defer();this.callDomain=t,this.setParticipants(this.sinch.user.userId,e),this.setCallTimeouts(this.sinch._progressTimeout||I,_);var i=this.getCallObject(e,t);return this.peerConnection=this.getPeerConnectionInstance(null),this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:this.videoSupport}).then(function(t){this.originalOffer=t,i.sdp=t,this.sinch.placeCall(i).then(function(t){var i=this.getPlaceCallResponse(t);this.sinch.log(new Notification(0,1,"Successfully initiated call, waiting for MXP signalling.",i)),this.instances=this.createInstances(i.instances),void 0!==i.signalChannel&&null!==i.signalChannel&&(this.clientMap.virtual={fs:i.signalChannel,fu:e}),this.sinch._supportManagedPush?(this.pushService=new P(this.sinch,this.instances,this.callId),this.pushService.push(!1,this.callState)):this.pushService=null,this.relayUrl=i.body.replace(/(\r\n|\n|\r)/gm,""),this.sinch.mxp.configureMxpSession(this.callId,i.encryptionKey,i.body),n.resolve()}.bind(this)).fail(function(e){this.error=new SinchError(a.ErrorDomainSDK,c.SDKInternalOther,JSON.parse(e.response).message),this.callFailure(),n.reject(error)}.bind(this))}.bind(this),function(e){console.error("Failed to generate SDP Offer"),console.error(e)}),n.promise},g.prototype.updateSdp=function(e){for(var t=e.split("\n"),n="",i=!1,r=!1,s=0;s<t.length;++s)t[s].length>0&&!t[s].startsWith("a=crypto:1")&&(n=n+t[s]+"\n"),t[s].length>0&&t[s].startsWith("a=mid:")&&(r=!0),t[s].length>0&&t[s].startsWith("a=group:BUNDLE")&&(i=!0);return i||(n+="a=group:BUNDLE audio\n"),r||(n+="a=mid:audio\n"),n},g.prototype.ackIncomingCall=function(e){var t=r.defer();this.sinch.log(new Notification(0,1,"Incoming call",this)),this.setCallTimeouts(I,_);var n=JSON.parse(e.decrypted.nvps.sdp);n.sdp=this.updateSdp(n.sdp),this.sinch.log(new Notification(0,1,"Received SDP offer from B",n));var i=new b(n);return this.peerConnection=this.getPeerConnectionInstance(e.getSenderId()),this.peerConnection.setRelayUrl(e.decrypted.bd),this.peerConnection.setRemoteDescription(i).then(function(){this.sinch.log(new Notification(1,3,"Successfully configured sdp offer.",n)),this.peerConnection.createAnswer().then(function(t){this.progress(!1),this.sinch.log(new Notification(2,3,"Header detected, p2p, will proceed with direct peer connection!.",e)),this.sinch.mxp.sendSdpAnswer(this,t).fail(function(e){throw new SinchError(a.ErrorDomainSDK,c.SDKInternalOther,"Error sending SDP Answer")})}.bind(this),function(e){console.error("Major error in creating answer",e)})}.bind(this),function(e){throw this.sendCancel(C.FAILURE,e),new SinchError(a.ErrorDomainSDK,c.SDKInternalOther,"Error setting remote SDP")}.bind(this)),t.promise},g.prototype.answer=function(){if(this.sinch.log(new Notification(0,1,"Answer call initiated, to answer()",this)),this.callState==S.PROGRESSING)this.mediaObj?this.sinch.postMedia(this.mediaObj).then(function(e){var t="audio:ISAC/0.0.0.0/"+e.proxyid+"/"+e.ip+":"+e.port;this.sinch.mxp.joinIncomingCall(this,t).then(function(){this.sinch.log(new Notification(3,3,"Successfully sent updated proxy information in Ack to caller",t))}.bind(this)).fail(function(e){throw console.error(e),new SinchError(a.ErrorDomainSDK,c.SDKInternalOther,"Could not send Ack to Old with MEDIA answer")})}.bind(this)).fail(function(e){throw console.error(e),new SinchError(a.ErrorDomainSDK,c.SDKInternalOther,"Could not send Answer to v1/media")}):this.sinch.mxp.joinIncomingCall(this).fail(function(e){throw new SinchError(a.ErrorDomainSDK,c.SDKInternalOther,"Error sending JOIN (pickup phone).")});else if("undefined"==typeof outgoingStream)this.sinch.log(new Notification(0,1,"Outgoing stream undefined, perhaps early answer. Will set auto answer for future automatic answer.")),this.autoAnswer=!0;else{if(this.callState==S.ENDED||this.callState==S.ESTABLISHED)throw new SinchError(a.ErrorDomainSDK,c.SDKInternalOther,"Call in invalid state to answer.");this.sinch.log(new Notification(0,1,"Stream defined and state in initializing or progressing. Setting auto answer for later retry.")),this.autoAnswer=!0}},g.prototype.openDataChannel=function(e){return void 0===this.dataChannels[e]&&(this.dataChannels[e]=this.getPeerConnectionInstance(this.activeInstance).createDataChannel(e,{reliable:!1}),this.dataChannels[e].addEventListener=this.addEventListenerPrototype.bind(this.dataChannels[e]),this.execListener("onDataChannelAdded",this.dataChannels[e])),this.dataChannels[e]},g.prototype.hangup=function(){if(this.hangupRetries=(this.hangupRetries||0)+1,this.callState==S.ESTABLISHED)this.sinch.mxp.callHangup(this).fail(function(e){throw new SinchError(a.ErrorDomainSDK,c.SDKInternalOther,"Error sending call Hangup")}),this.mxpHangup();else if(!this.callOutbound||this.callState!=S.PROGRESSING&&this.callState!=S.INITIATING)if(this.callOutbound||this.callState!=S.PROGRESSING&&this.callState!=S.INITIATING){if(this.callState==S.ENDED)throw new SinchError(a.ErrorDomainSDK,c.SDKInternalOther,"Call already ended");this.mxpHangup()}else this.callState==S.PROGRESSING?(this.sinch.mxp.callDeny(this).fail(function(e){throw new SinchError(a.ErrorDomainSDK,c.SDKInternalOther,"Error sending call Deny")}),this.setEndCause(C.DENIED),this.mxpHangup()):this.autoHangup=!0;else Object.keys(this.clientMap).length>0||this.hangupRetries>5?(this.sinch.mxp.callCancel(this).fail(function(e){throw new SinchError(a.ErrorDomainSDK,c.SDKInternalOther,"Error sending call Cancel")}),this.mxpHangup()):(this.sinch.log(new Notification(0,1,"Can not hang up call at this time. Will try again in 0.5 seconds (max five retries).")),setTimeout(this.hangup.bind(this),500))},g.prototype.getCallId=function(){return this.callId},g.prototype.getDetails=function(){return new y({endCause:this.callEndCause,endedTime:this.timeEnded,error:this.error,establishedTime:this.timeEstablished,startedTime:this.timeProgressing,duration:this.timeEstablished?(this.timeEnded-this.timeEstablished)/1e3:0})},g.prototype.getDirection=function(){return this.callOutbound?1:0},g.prototype.getRemoteUserId=function(){return this.getDirection()?this.toId:this.fromId},g.prototype.getState=function(){return Object.keys(S).filter(function(e){return S[e]===this.callState}.bind(this))[0]},g.prototype.getEndCause=function(){return Object.keys(C).filter(function(e){return C[e]===this.callEndCause}.bind(this))[0]},g.prototype.getHeaders=function(){return this.customHeaders},g.prototype.sendDTMF=function(e){if(this.activeInstance&&!this.DTMFsender){var t=this.getPeerConnectionInstance(this.activeInstance);t.getSenders?this.DTMFsender=t.getSenders()[0].dtmf:(console.warn("Your browser doesn't support DTMF tone building"),this.DTMFsender=t.createDTMFSender(this.outgoingStream.getAudioTracks()[0]))}return this.DTMFsender&&this.DTMFsender.insertDTMF(e)},g.prototype.mute=function(){if(this.callState!=S.ESTABLISHED&&this.callState!=S.PROGRESSING&&this.callState!=S.INITIATING)throw new SinchError(a.ErrorDomainSDK,c.SDKInternalOther,"Call not in ESTABLISHED state.");this.sinch.log(new Notification(0,1,"Call was muted using mute()."));for(var e=this.outgoingStream.getAudioTracks(),t=0;t<e.length;t++)e[t].enabled=!1},g.prototype.unmute=function(){if(this.callState!=S.ESTABLISHED&&this.callState!=S.PROGRESSING&&this.callState!=S.INITIATING)throw new SinchError(a.ErrorDomainSDK,c.SDKInternalOther,"Call not in ESTABLISHED state.");this.sinch.log(new Notification(0,1,"Call was un-muted using unmute()."));for(var e=this.outgoingStream.getAudioTracks(),t=0;t<e.length;t++)e[t].enabled=!0},navigator.mediaDevices&&(navigator.mediaDevices.getUserMedia=navigator.mediaDevices.getUserMedia||navigator.getUserMedia||navigator.mozGetUserMedia||navigator.webkitGetUserMedia),m.prototype.addEventListener=function(e){this.eventListeners.push(e)},m.prototype.removeEventListener=function(e){this.eventListeners.splice(this.eventListeners.indexOf(e),1)},m.prototype.execListener=function(e,t){var n=0;return this.eventListeners.forEach(function(i){return n++,i[e]&&i[e](t)}.bind(this)),n},m.prototype.initStream=function(e,t){var n=r.defer(),i=!(!this.sinch._supportVideo||t)&&{mandatory:{maxWidth:320,maxHeight:240}};return void 0!==e?(this.sinch.log(new Notification(0,1,"Will wire customStream into call",e)),n.resolve(e)):void 0===this.localMediaStream?(this.sinch.log(new Notification(0,1,"Will retrieve new Mic for stream")),navigator.mediaDevices&&navigator.mediaDevices.getUserMedia({video:i,audio:!0}).then(function(e){this.localMediaStream=e,n.resolve(this.localMediaStream)}).catch(function(e){console.error("Error retrieving media stream",e)})):(this.sinch.log(new Notification(0,1,"Will retrieve cached Mic for stream",this.localMediaStream)),n.resolve(this.localMediaStream)),n.promise},m.prototype.alreadyInCall=function(){if(this.sinch._multiCall)return!1;for(var e in this.callBuffert)if(this.callBuffert[e].callState==S.PROGRESSING||this.callBuffert[e].callState==S.ESTABLISHED)return!0},m.prototype.handleIncomingCall=function(e){this.sinch.log(new Notification(0,1,"Will handle incoming call",e));var t,n=new g(this.sinch,this.sinch._supportVideo,e.mxpSessionId);(e.decrypted.nvps||{}).nomedia?n.callDomain="connection":n.callDomain="data",n.setParticipants(e.decrypted.fu,this.sinch.user.userId),n.customHeaders=JSON.parse((e.decrypted.nvps||{}).ph||"{}"),this.sinch.mxp.configureMxpSession(n.callId,e.decrypted.nvps.key,e.decrypted.bd),n.clientMap[e.getSenderId()]=e.getFrom(),this.callBuffert[n.callId]=n,this.alreadyInCall()?(this.sinch.log(new Notification(0,1,"Already in a call, will hangup incoming call.",e)),this.sinch.mxp.subscribe("signalPubNub").then(function(){this.sinch.mxp.callDeny(n)}.bind(this))):this.execListener("onIncomingCall",n)?("connection"==n.callDomain?(t=r.defer(),t.resolve(null),t.promise):this.initStream(this.incomingCallCustomStream)).then(function(t){return this.execListener("onMediaStream",t),this.sinch.mxp.subscribe("signalPubNub").then(function(){(e.decrypted.nvps||{}).nomedia||n.setStream(t),n.activeInstance=e.getSenderId(),n.proxyUrl=e.decrypted.bd.replace(/(\r\n|\n|\r)/gm,""),n.ackIncomingCall(e).catch(function(e){console.error("Error handling incoming call",e)})}.bind(this))}.bind(this)):this.sinch.log(new SinchError(a.ErrorDomainSDK,c.SDKMissingCallback,"Missing handler, onIncomingCall."))},m.prototype.callUser=function(e,t,n){this.sinch.log(new Notification(0,1,"CallUser method called",e));var i=new g(this.sinch,this.sinch._supportVideo);return i.customHeaders=t,this.initStream(n).then(function(t){return this.sinch.mxp.subscribe("signalPubNub").then(function(){if(i.callState!=S.INITIATING)throw new SinchError(a.ErrorDomainSDK,c.SDKInternalOther,"Error executing user call. Incorrect call state.");i.setStream(t),i.placeCall(e,"data"),this.callBuffert[i.callId]=i}.bind(this))}.bind(this)),i},m.prototype.callSip=function(e,t,n){this.sinch.log(new Notification(0,1,"CallSip method called",e));var i=new g(this.sinch);return i.customHeaders=t,this.initStream(n).then(function(t){return this.sinch.mxp.subscribe("signalPubNub").then(function(){if(i.callState!=S.INITIATING)throw new SinchError(a.ErrorDomainSDK,c.SDKInternalOther,"Error executing user call. Incorrect call state.");i.setStream(t),i.placeCall(e,"sip"),this.callBuffert[i.callId]=i}.bind(this))}.bind(this)),i},m.prototype.connect=function(e,t){this.sinch.log(new Notification(0,1,"connect method called",e));var n=new g(this.sinch);return n.customHeaders=t,this.sinch.mxp.subscribe("signalPubNub").then(function(){if(n.callState!=S.INITIATING)throw new SinchError(a.ErrorDomainSDK,c.SDKInternalOther,"Error executing connect. Incorrect call state.");n.placeCall(e,"connection"),this.callBuffert[n.callId]=n}.bind(this)),n},m.prototype.callPhoneNumber=function(e,t,n){this.sinch.log(new Notification(0,1,"CallPhoneNumber method called",e));var i=new g(this.sinch);return i.customHeaders=t,this.initStream(n,!0).then(function(t){return this.sinch.mxp.subscribe("signalPubNub").then(function(){if(i.callState!=S.INITIATING)throw new SinchError(a.ErrorDomainSDK,c.SDKInternalOther,"Error executing user call. Incorrect call state.");i.setStream(t),i.placeCall(e,"pstn"),this.callBuffert[i.callId]=i}.bind(this))}.bind(this)),i},m.prototype.callConference=function(e,t,n){if(this.sinch.log(new Notification(0,1,"CallConference method called",e)),!(e=""+e)||e.length>64)throw new SinchError(a.ErrorDomainSDK,c.SDKMissingParameter,"Invalid conferenceId. Must be alphanumeric string less than 64 characters in length.");var i=new g(this.sinch);return i.customHeaders=t,this.initStream(n,!0).then(function(t){return this.sinch.mxp.subscribe("signalPubNub").then(function(){if(i.callState!=S.INITIATING)throw new SinchError(a.ErrorDomainSDK,c.SDKInternalOther,"Error executing user call. Incorrect call state.");i.setStream(t),i.placeCall(e,"conference"),this.callBuffert[i.callId]=i}.bind(this))}.bind(this)),i},m.prototype.callGroup=function(e){if(this.sinch.log(new Notification(0,1,"callRoom method called, for group",e)),void 0!==this.groupChannel)throw new SinchError(a.ErrorDomainSDK,c.SDKInternalOther,"Can not call room, already in a room");if(!this.sinch._multiCall)throw new SinchError(a.ErrorDomainSDK,c.SDKInternalOther,"Can not call room, multiCall capability not specified");return this.groupChannel=e,new D(this.sinch,e)};var v,b,w,S={INITIATING:0,PROGRESSING:1,ESTABLISHED:2,ENDED:3,TRANSFERRING:4},C={NONE:0,TIMEOUT:1,CANCELED:6,DENIED:2,FAILURE:4,HUNG_UP:5,NO_ANSWER:3,OTHER_DEVICE_ANSWERED:7,TIMEOUT:1,TRANSFERRED:8},I=10500,_=45e3,x=function(){};function E(e,t,n){if(!(e instanceof p))throw new SinchError(a.ErrorDomainVerification,c.VerificationInvalidInput,"Invalid input to constructor. VerificationClient can not be instantiated, use createSmsVerification in an SinchClient instance",error);if(void 0===t||0==t.toString().length)throw new SinchError(a.ErrorDomainVerification,c.VerificationInvalidInput,"Invalid input to constructor. Valid phone number required (E.164 format ideally)",t);this.sinch=e,this.number=t||null,this.custom=n||null,this.flagVerified=!1}function k(e,t,n){if(!(e instanceof p))throw new SinchError(a.ErrorDomainVerification,c.VerificationInvalidInput,"Invalid input to constructor. VerificationClient can not be instantiated, use createSmsVerification in an SinchClient instance",error);if(void 0===t||0==t.toString().length)throw new SinchError(a.ErrorDomainVerification,c.VerificationInvalidInput,"Invalid input to constructor. Valid phone number required (E.164 format ideally)",t);this.sinch=e,this.number=t||null,this.custom=n||null,this.flagVerified=!1}function D(e,t){this.sinch=e,this.callClient=e.callClient,this.groupChannel=t,this.eventListeners=[],this.callBuffert=[],this.callListeners={onCallProgressing:function(e){this.sinch.log(new Notification(0,1,"Call progressing",e))}.bind(this),onCallEstablished:function(e){this.sinch.log(new Notification(0,1,"Call established",e)),this.execListener("onGroupRemoteCallAdded",e)}.bind(this),onCallEnded:function(e){this.sinch.log(new Notification(0,1,"Call ended",e)),this.execListener("onGroupRemoteCallRemoved",e)}.bind(this)},this.groupListener={onIncomingCall:function(e){e.addEventListener(this.callListeners),setTimeout(function(){e.answer()},450*Object.keys(this.callBuffert).length+Math.random())}.bind(this)},this.callClient.addEventListener(this.groupListener),this.sinch.callClient.initStream().then(function(e){this.sinch.log(new Notification(0,1,"Media stream successfully created",e)),this.execListener("onGroupLocalMediaAdded",e),this.sinch.mxp.broadcastPubNub.publish({channel:t,message:this.sinch.user.userId}),this.sinch.mxp.subscribeNotificationChannel(t)}.bind(this)),this.sinch.onnotification=function(e,n){t==e&&n!=this.sinch.user.userId&&(this.sinch.log(new Notification(0,1,"Will call user in group, after random timeout",n)),setTimeout(function(){var e=this.callClient.callUser(n);this.callBuffert.push(e),e.addEventListener(this.callListeners)}.bind(this),300+Math.round(500*Math.random())))}.bind(this)}function O(e,t){if(this.delivered=[],this.direction=!t,e instanceof H){this.messageId=e.mxpSessionId;var n=JSON.parse(e.decrypted.bd);this.textBody=n.t,this.recipientIds=e.recipientIds,this.senderId=e.decrypted.fu;try{this.headers=e.decrypted.nvps.ph}catch(e){}this.timestamp=new Date}else{if(!(e instanceof Object))throw new SinchError(a.ErrorDomainSDK,c.SDKMissingParameter,"Unsupported message parameters",e);this.messageId=h(),this.recipientIds=e.recipientIds,this.textBody=e.textBody,this.senderId=e.senderId,this.headers=e.publicHeaders,this.timestamp=new Date}}function B(e,t){this.messageId=t,this.recipientId=e,this.timestamp=new Date}function T(e){if(!(e instanceof p))throw new Error("MessageClient can't be instantiated, use getMessageClient in an SinchClient instance");this.sinch=e,this.eventListeners=[],this.messageBuffert={},this.ackBuffert={},this.onMessageDelivered=[],this.emptyLog(),this.messageLogInterval=setInterval(this.commitLog.bind(this),3e4)}x.generateIceCandidate=function(e,t){return"candidate:"+(""+Math.random()).substring(2,7)+" 1 UDP 2130706431 "+e+" "+t+" typ relay raddr 0.0.0.0 rport 0 generation 0\r\n"},x.generateRelayCandidate=function(e,t,n){var i=e.candidate.split(" ");return-1!=i.indexOf("srflx")&&"udp"==i[2].toLowerCase()?new w({candidate:["candidate:"+(""+Math.random()).substring(2,7),i[1],i[2].toUpperCase(),Math.round(i[3]/10),t,n,"typ","relay","raddr",i[4],"rport",i[5],"generation",0].join(" "),sdpMLineIndex:"number"==typeof e.sdpMLI?e.sdpMLI:e.sdpMLineIndex||0,sdpMid:e.sdpMid}):null},E.prototype.initiate=function(e,t){var n=r.defer();if(this.flagVerified){var i=new SinchError(a.ErrorDomainVerification,c.VerificationUnexpectedInitiateError,"Verification already verified, can't perform another callout.");n.reject(i)}else{var s={identity:{type:"number",endpoint:this.number},custom:this.custom,method:"callout",metadata:{os:l(),platform:f(),sdk:"js/"+this.sinch.getVersion()}};this.sinch.log(new Notification(0,1,"Will initiate callout verification using object",s)),this.sinch.confirmUserCallout(s).then(function(i){var r=this;r.sinch.log(new Notification(0,1,"Successfully initiated callout verification with response",i));var s=0,o=function(){r.sinch.queryVerificationById({number:r.number}).then(function(u){switch(r.sinch.log(new Notification(0,1,"Poll result after "+s+"s",u)),u.status){case"SUCCESSFUL":r.sinch.log(new Notification(0,1,"Successfully verified number after "+s+"s")),e&&e(),n.resolve();break;case"PENDING":if(s+=i.callout.pollingInterval,i.callout.pollingInterval>0&&s<i.callout.stopPollingAfter)window.setTimeout(o,1e3*i.callout.pollingInterval);else{var h=new SinchError(a.ErrorDomainVerification,c.VerificationIncorrectCode,"Verification Failed, Timeout");t&&t(h),n.reject(h)}break;case"FAIL":case"ERROR":r.sinch.log(new Notification(0,1,"Verification failed after "+s+"s"));h=new SinchError(a.ErrorDomainVerification,c.VerificationIncorrectCode,"Verification Failed, "+u.reason);t&&t(h),n.reject(h);break;default:r.sinch.log(new Notification(0,1,"Server response not handled at "+s+"s",u))}}).fail(function(e){var i;i=e.status?new SinchError(a.ErrorDomainVerification,c.VerificationServiceError,"Could not poll verification status: "+e.statusText,e.responseText):e,this.sinch.log(i),t&&t(i),n.reject(i)})};window.setTimeout(o,1e3*i.callout.startPollingAfter)}.bind(this)).fail(function(e){var i;i=e.status?new SinchError(a.ErrorDomainVerification,c.VerificationServiceError,"Could not request verification: "+e.statusText,e.responseText):e,this.sinch.log(i),t&&t(i),n.reject(i)}.bind(this))}return n.promise},k.prototype.initiate=function(e,t){var n=r.defer();if(this.flagVerified){var i=new SinchError(a.ErrorDomainVerification,c.VerificationUnexpectedInitiateError,"Verification already verified, can't perform another callout.");n.reject(i)}else{var s={identity:{type:"number",endpoint:this.number},custom:this.custom,method:"flashcall",metadata:{os:l(),platform:f(),sdk:"js/"+this.sinch.getVersion()}};this.sinch.log(new Notification(0,1,"Will initiate flashcall verification using object: ",s)),this.sinch.confirmUserCallout(s).then(function(t){this.sinch.log(new Notification(0,1,"Successfully initiated callout verification with response",t)),e&&e(),n.resolve()}.bind(this)).fail(function(e){var i;i=e.status?new SinchError(a.ErrorDomainVerification,c.VerificationServiceError,"Could not request verification: "+e.statusText,e.responseText):e,this.sinch.log(i),t&&t(i),n.reject(i)}.bind(this))}return n.promise},k.prototype.verify=function(e,t,n){var i=r.defer();if(this.flagVerified)t&&t(this.cachedResponse),i.resolve(this.cachedResponse);else{var s={number:this.number,source:"manual",flashcall:{cli:e},method:"flashcall"};this.sinch.confirmUserSMS(s).then(function(e){this.flagVerified=!0,this.cachedResponse=e,t&&t(e),i.resolve(e)}.bind(this)).fail(function(e){var t;t=e.status?new SinchError(a.ErrorDomainVerification,c.VerificationIncorrectCode,"Could not verify code: "+e.statusText,e.responseText):e,n&&n(t),i.reject(t)}.bind(this))}return i.promise},D.prototype.addEventListener=function(e){this.eventListeners.push(e)},D.prototype.removeEventListener=function(e){this.eventListeners.splice(this.eventListeners.indexOf(e),1)},D.prototype.execListener=function(e,t){var n=0;return this.eventListeners.forEach(function(i){return n++,i[e]&&i[e](t)}.bind(this)),n},D.prototype.hangupGroup=function(){if(void 0===this.callClient.groupChannel)throw new SinchError(a.ErrorDomainSDK,c.SDKInternalOther,"Can not leave room, not in a room");for(var e in this.callBuffert)this.callBuffert[e].hangup();this.callClient.removeEventListener(this.groupListener),this.callClient.groupChannel=void 0},O.prototype.getMXPMessageObj=function(){var e=new H;return e.mxpSessionId=this.messageId,e.decrypted={bd:JSON.stringify({t:this.textBody})},this.headers&&(e.decrypted.nvps={ph:this.headers}),e.recipientIds=this.recipientIds,e},T.prototype.emptyLog=function(){this.logCounters={version:"2.0",sent:0,received:0,failed:0}},T.prototype.commitLog=function(){(this.logCounters.sent||this.logCounters.received||this.logCounters.failed)&&(this.sinch.log(new Notification(0,1,"Will post IM log to backend for statistics",this.logCounters)),this.sinch.messageReporting(this.logCounters).then(this.emptyLog.bind(this)))},T.prototype.destroy=function(){this.commitLog(),clearInterval(this.messageLogInterval)},T.prototype.handleMessage=function(e){var t;e.recipientIds=e.transportObj.participants.reduce(function(e,t){return e.push(t.destination.identity),e}.bind(this),[]);var n=!1;return this.messageBuffert[e.mxpSessionId]?t=this.messageBuffert[e.mxpSessionId]:(t=new O(e,e.decrypted.fu!=this.sinch.user.userId),this.messageBuffert[t.messageId]=t,n=!0),!t.passedToHandler&&(this.eventListeners.forEach(function(e){return t.passedToHandler=!0,e.onIncomingMessage&&e.onIncomingMessage(t)}),n&&this.ackBuffert[t.messageId]&&(this.ackBuffert[t.messageId].forEach(function(e){this.ackMsg(e,t.messageId)}.bind(this)),delete this.ackBuffert[t.messageId]),t.direction||this.logCounters.received++,!0)},T.prototype.addEventListener=function(e){this.eventListeners.push(e)},T.prototype.removeEventListener=function(e){this.eventListeners.splice(this.eventListeners.indexOf(e),1)},T.prototype.send=function(e,t,n){var i=r.defer();if(this.sinch.log(new Notification(0,1,"Send message method called"),i),!(e instanceof O))throw new SinchError(a.ErrorDomainSDK,c.SDKMissingParameter,"Unsupported message parameters",e);return t=t||function(e){return e},n=n||function(e){console.error(e)},r.fcall(function(e){if(void 0===this.sinch.mxp){var t=new SinchError(a.ErrorDomainSDK,c.SDKUnexpectedCall,"Sinch is not ready yet");throw i.reject(t),t}if(e.sent)throw new SinchError(a.ErrorDomainSDK,c.SDKUnexpectedCall,"Message already sent");return e.sent=!0,e}.bind(this),e).then(this.sinch.mxp.sendMessage.bind(this.sinch.mxp)).then(t).then(function(){this.logCounters.sent++}.bind(this)).then(i.resolve).fail(function(e){this.sinch.log(e),n(e),this.logCounters.failed++,i.reject(e)}.bind(this)).progress(function(e){this.sinch.log(e),i.notify(e)}.bind(this)),i.promise},T.prototype.ackMsg=function(e,t){this.messageBuffert[t]&&-1===this.messageBuffert[t].delivered.indexOf(e)?(this.sinch.log(new MXPLog("Recieved ack from "+e+" for message",t)),this.messageBuffert[t].delivered.push(e),this.eventListeners.forEach(function(n){return n.onMessageDelivered&&n.onMessageDelivered(new B(e,t))}.bind(this))):(this.ackBuffert[t]||(this.ackBuffert[t]=[]),this.ackBuffert[t].push(e),this.sinch.log(new MXPLog("Got ack for message with non-existing messageId, storing in ackBuffert",t)))},T.prototype.newMessage=function(e,t,n){if("string"==typeof e&&(e=[e]),"string"!=typeof t)throw new SinchError(a.ErrorDomainSDK,c.SDKUnexpectedCall,"Message text must be a string (for cross device compatability). Please stringify any objects.");if(n&&"string"!=typeof n)throw new SinchError(a.ErrorDomainSDK,c.SDKUnexpectedCall,"Headers must be a string (for cross device compatability). Please stringify any objects.");return new O({recipientIds:e,textBody:t,senderId:this.sinch.user.userId,publicHeaders:n})};d=d||{};function A(e,t,n,i){this.instanceId=e,this.webrtcConfig=t,this.outgoingStream=n,this.call=i,this.peerConnection=this.createPeerConnection(),this.remoteCandidates=[]}function M(e,t,n){this.instanceId=e,this.iceCandidates=[],this.call=t,this.relayIceCandidates=[],this.instance=n}function P(e,t,n){this.sinch=e,this.callId=n,this.instances=t}function N(e,t,n,i,r){this._version=e,this._type=t,this._sessionId=n,this._created=i,this._externalId=r,this._bytes=[]}function SinchError(e,t,n,i){this.name="SinchError",this.domain=e||-1,this.code=t||0,this.response=i||{},this.message=n||"General sinch error",this.stack=new Error(n).stack}function R(e){this.userObj={},this.sinch=e}function j(e,t,n,i){if(!(e instanceof p))throw new SinchError(a.ErrorDomainVerification,c.VerificationInvalidInput,"Invalid input to constructor. VerificationClient can not be instantiated, use createSmsVerification in an SinchClient instance",error);if(void 0===t||0==t.toString().length)throw new SinchError(a.ErrorDomainVerification,c.VerificationInvalidInput,"Invalid input to constructor. Valid phone number required (E.164 format ideally)",t);this.method=i||"sms",this.sinch=e,this.number=t||null,this.custom=n||null,this.flagVerified=!1}v=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection||d.RTCPeerConnection,b=window.RTCSessionDescription||window.mozRTCSessionDescription||window.webkitRTCSessionDescription||d.RTCSessionDescription,w=window.RTCIceCandidate||window.mozRTCIceCandidate||d.RTCIceCandidate,A.prototype.updateInstanceId=function(e){this.instanceId=e,this.peerConnectionObserver.updateInstanceId(e)},A.prototype.createPeerConnection=function(){return this.peerConnection=new v(this.webrtcConfig,{optional:[{DtlsSrtpKeyAgreement:!0}]}),this.peerConnectionObserver=new M(this.instanceId,this.call,this),this.peerConnection.addStream(this.outgoingStream),this.peerConnection.ontrack=function(e){e.streams.length>0&&(this.call.incomingStream=e.streams[0],this.call.execListener("onRemoteTrack",this.incomingStream))}.bind(this),this.peerConnection.oniceconnectionstatechange=function(e){this.peerConnectionObserver.onIceConnectionChanged(e)}.bind(this),this.peerConnection.onicecandidate=function(e){this.peerConnectionObserver.onIceCandidate(e)}.bind(this),this.peerConnection.onnegotiationneeded=function(e){this.peerConnectionObserver.onIceCandidate(e)}.bind(this),this.peerConnection.onremovestream=function(e){this.call.sinch.log(new Notification(0,1,"WebRTC: Stream removed",e))}.bind(this),this.peerConnection.onsignalingstatechange=function(e){this.call.sinch.log(new Notification(0,1,"WebRTC: Signaling state change: "+e.currentTarget.signalingState+", instance: "+this.instanceId,e))}.bind(this),this.peerConnection.onidentityresult=function(e){this.call.sinch.log(new Notification(0,1,"WebRTC: onidentityresult event detected",e))}.bind(this),this.peerConnection.onidpassertionerror=function(e){this.call.sinch.log(new Notification(0,1,"WebRTC: onidpassertionerror event detected",e))}.bind(this),this.peerConnection.onidpvalidationerror=function(e){this.call.sinch.log(new Notification(0,1,"WebRTC: onidpvalidationerror event detected",e))}.bind(this),this.peerConnection.onpeeridentity=function(e){this.call.sinch.log(new Notification(0,1,"WebRTC: onpeeridentity event detected",e))}.bind(this),this.peerConnection.onicegatheringstatechange=function(e){this.peerConnectionObserver.onIceGatheringStateChange(e)}.bind(this),this.peerConnection},A.prototype.getLocalDescription=function(e){return null!=this.instanceId&&this.call.originalOffer?this.call.originalOffer:e},A.prototype.createOffer=function(e){var t=r.defer();return this.peerConnection.createOffer(function(e){this.offer=e,t.resolve(e)}.bind(this),function(e){t.fail(e)},e),t.promise},A.prototype.createAnswer=function(){var e=r.defer();return this.peerConnection.createAnswer(function(t){this.peerConnection.setLocalDescription(t,function(){this.call.sinch.log(new Notification(2,3,"Successfully created SDP Answer.",t)),e.resolve(t)}.bind(this),function(t){e.fail(t)})}.bind(this),function(t){e.fail(t)}),e.promise},A.prototype.addRemoteIceCandidates=function(e){if(this.remoteCandidates){for(;this.remoteCandidates.length;){e=this.remoteCandidates.pop();this.call.sinch.log(new Notification(2,2,"Add stored remote candidate, instance: "+this.instanceId,e)),this.peerConnection.addIceCandidate(e)}this.remoteCandidates=null}},A.prototype.addRemoteIceCandidate=function(e){e&&(this.remoteCandidates?(this.call.sinch.log(new Notification(2,2,"Store remote candidate",e)),this.remoteCandidates.push(e)):(this.call.sinch.log(new Notification(2,2,"WebRTC: Add remote candidate, instance: "+this.instanceId,e)),this.peerConnection.addIceCandidate(e)))},A.prototype.setRelayUrl=function(e){if(e){var t=e.split("/")[3].split(":");this.relay={host:t[0],port:t[1]},this.peerConnectionObserver.addRelayCandidates()}},A.prototype.internalSetRemoteDescription=function(e){var t=r.defer();return this.remoteDescription=e,r.fcall(function(){var e=r.defer();if(this.call.callOutbound){var t=this.getLocalDescription(this.offer);this.call.sinch.log(new Notification(2,2,"Set local description",{offer:this.offer,original:t})),this.peerConnection.setLocalDescription(t,function(){e.resolve()},function(t){e.fail(t)})}else e.resolve();return e.promise}.bind(this)).then(function(){this.peerConnection.setRemoteDescription(e,function(){this.call.sinch.log(new Notification(2,2,"Remote description set",e)),this.addRemoteIceCandidates(),t.resolve()}.bind(this),function(e){throw this.remoteDescription=null,new SinchError(a.ErrorDomainSDK,c.SDKInternalOther,"Error setting remote SDP",e)}.bind(this))}.bind(this)).fail(function(e){throw new SinchError(a.ErrorDomainSDK,c.SDKInternalOther,"Error setting local SDP",e)}.bind(this)),t.promise},A.prototype.setRemoteDescription=function(e){if(!this.offer&&this.call.callOutbound){var t=r.defer();return this.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:this.call.videoSupport}).then(function(){this.internalSetRemoteDescription(e).then(function(){t.resolve()}).fail(function(e){t.reject(e)})}.bind(this)).fail(function(e){}.bind(this)),t.promise}return this.internalSetRemoteDescription(e)},A.prototype.hasRemoteDescription=function(){return null!=this.remoteDescription},A.prototype.close=function(){"closed"!=this.peerConnection.signalingState&&this.peerConnection.close()},M.prototype.updateInstanceId=function(e){this.call.sinch.log("First ack received from: "+e),this.instanceId=e,this.sendIceCandidates()},M.prototype.sendIceCandidates=function(){if(this.iceCandidates){for(;this.iceCandidates.length;)this.sendIceCandidate(this.iceCandidates.pop());this.remoteCandidates=null}},M.prototype.sendIceCandidate=function(e){null!=this.call.instances&&(null==this.instanceId?(this.call.sinch.log(new Notification(0,2,"Send candidate after answer is received",e)),this.iceCandidates.push(e)):(this.call.sinch.log(new Notification(0,2,"Sending ice candidate to: "+this.instanceId,e)),this.call.sinch.mxp.callTxICECandidate(this.call,e,this.instanceId).fail(function(e){throw new SinchError(a.ErrorDomainSDK,c.SDKInternalOther,"Error sending ICE candidate")})))},M.prototype.addRelayCandidates=function(){if(this.relayIceCandidates){for(;this.relayIceCandidates.length>0;){var e=x.generateRelayCandidate(this.relayIceCandidates.pop(),this.instance.relay.host,this.instance.relay.port);e&&(this.call.sinch.log(new Notification(0,1,"Add relay candidate, instance: "+this.instanceId,e)),this.instance.addRemoteIceCandidate(e))}this.relayIceCandidates=null}},M.prototype.addRelayCandidate=function(e){if(this.relayIceCandidates)this.relayIceCandidates.push(e);else{var t=x.generateRelayCandidate(e,this.instance.relay.host,this.instance.relay.port);t&&(this.call.sinch.log(new Notification(0,1,"Add relay candidate, instance: "+this.instanceId,t)),this.instance.addRemoteIceCandidate(t))}},M.prototype.onIceCandidate=function(e){e.candidate&&(this.addRelayCandidate(e.candidate),this.call.sinch.log(new Notification(0,1,"WebRtc: onIceCandidate, instance: "+this.instanceId,e.candidate)),!this.renegotiate&&e.candidate&&this.sendIceCandidate({cand:e.candidate.candidate,candidate:e.candidate.candidate,sdpMLI:e.candidate.sdpMLineIndex,sdpMLineIndex:e.candidate.sdpMLineIndex,sdpMid:e.candidate.sdpMid||""}))},M.prototype.onIceConnectionChanged=function(e){this.call.sinch.log(new Notification(0,1,"WebRTC: Connection state changed: "+e.currentTarget.iceConnectionState+", instance: "+this.instanceId,e)),this.call.renegotiate||!e.currentTarget||"failed"!=e.currentTarget.iceConnectionState&&"disconnected"!=e.currentTarget.iceConnectionState||this.call.sinch.log(new SinchError(a.ErrorDomainNetwork,c.NetworkConnectionTimedOut,"Ice connection failed.",e)),this.call.execListener("onConnectionChange",e.currentTarget.iceConnectionState)},M.prototype.onIceGatheringStateChange=function(e){this.call.sinch.log(new Notification(0,1,"WebRTC: Gathering state change: "+e.currentTarget.iceGatheringState+", instance: "+this.instanceId,e))},M.prototype.onNegotiationNeeded=function(e){},P.prototype.push=function(e,t){if(t!=S.INITIATING&&t!=S.PROGRESSING)return!1;var n=[];for(V in this.instances)this.instances[V].capabilities&&this.instances[V].capabilities.indexOf("push")>-1&&(!e&&this.instances[V].capabilities.indexOf("online")<0||e&&this.instances[V].capabilities.indexOf("online")>-1)&&n.push(V);if(n.length>0){var i=new N(2,1,this.callId,Date.now(),this.sinch.user.userId),r={};r.sinch=i.Encoded(),this.sinch.user.pushNotificationDisplayName&&(r.displayName=this.sinch.user.pushNotificationDisplayName);for(var s={sessionId:this.callId,template:"incoming_call",to:[],params:r},o=0;o<n.length;++o)s.to.push({instance:n[o]});return this.sinch.pushCall({messages:[s]}),!0}return!1},N.prototype.Encoded=function(){return this.encodeChar(this._version),this.encodeChar(this._type),this.encodeSessionId(this._sessionId),this.encodeTimestamp(this._created/1e3),this.encodeChar(this.getUserIdTypeAndLength(0,this._externalId.length)),this.encodeString(this._externalId),this.base64Encode()},N.prototype.encodeChar=function(e){this._bytes.push(e)},N.prototype.encodeSessionId=function(e){var t=0;for(this._bytes.push(e==e.toLowerCase()?1:2);t<e.length;)"-"!=e.substring(t,t+1)?(this._bytes.push(parseInt(e.substr(t,2),16)),t+=2):++t},N.prototype.encodeTimestamp=function(e){this.encodeChar(255&e),this.encodeChar((65280&e)>>8),this.encodeChar((16711680&e)>>16),this.encodeChar((4278190080&e)>>24)},N.prototype.encodeString=function(e){for(var t=0;t<e.length;++t)this._bytes.push(e.charCodeAt(t))},N.prototype.getUserIdTypeAndLength=function(e,t){return 127&t|e<<7},N.prototype.base64Encode=function(){for(var e,t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),n=this._bytes,i="",r=0;r<n.length;r+=3)i+=t[n[r]>>2],i+=t[(3&n[r])<<4|n[r+1]>>4],void 0!==n[r+1]?i+=t[(15&n[r+1])<<2|n[r+2]>>6]:i+="=",void 0!==n[r+2]?i+=t[63&n[r+2]]:i+="=";for(e=i.slice(0,64),r=1;r<Math.ceil(i.length/64);r++)e+=i.slice(64*r,64*r+64)+(Math.ceil(i.length/64)==r+1?"":"\n");return e},SinchError.prototype=Error.prototype,R.prototype.updateUser=function(e){var t=r.defer();return this.sinch.updateUser(e).then(function(e){this.userObj=e,t.resolve(e)}.bind(this)).fail(function(e){t.reject(e)}.bind(this)),t.promise},R.prototype.create=function(e){var t=r.defer(),n={password:e.password,identities:[]};return e.email&&(n.profile={contact:{email:e.email}},n.identities.push({type:"email",endpoint:e.email})),e.username&&n.identities.push({type:"username",endpoint:e.username}),e.number&&n.identities.push({type:"number",endpoint:e.number}),this.sinch.createUser(n).then(function(e){this.userObj=e,this.userId=e.user.identities.reduce(function(e,t){return"username"===t.type?t.endpoint:e+""},""),t.resolve(e)}.bind(this)).fail(function(e){t.reject(new SinchError(a.ErrorDomainApi,c.ApiApiCallFailed,e.data.errorCode+" "+e.data.message,e.data))}),t.promise},R.prototype.authenticate=function(e){if("object"!=typeof e)throw new SinchError(a.ErrorDomainSDK,c.SDKMissingParameter,'No valid identity or authentication ticket. If you are passing your own authentication tickets, ensure it is an object on the format {"userTicket":SOME_TICKET}',e);if(e.expiresIn=e.expiresIn||86400,e.sessionId&&e.sessionSecret)return e;var t=r.defer(),n="";if(this.sinch._appSecret)e=o(this.sinch._appKey,this.sinch._appSecret,e);else if("email"in e){if(n=this.sinch.authenticate,""==e.email)return t.reject(new SinchError(a.ErrorDomainSDK,c.SDKMissingParameter,"Email is empty",e)),t.promise}else if("username"in e){if(n=this.sinch.authenticateUsername,""==e.username)return t.reject(new SinchError(a.ErrorDomainSDK,c.SDKMissingParameter,"Username is empty",e)),t.promise}else if("number"in e&&(n=this.sinch.authenticateNumber,""==e.number))return t.reject(new SinchError(a.ErrorDomainSDK,c.SDKMissingParameter,"Number is empty",e)),t.promise;if(e.authorization||e.userTicket){if(e.userTicket&&!e.user){var i=e.userTicket.split(":"),s=JSON.parse(atob(i[0]));"username"===!s.identity.type&&t.reject(new SinchError(a.ErrorDomainSDK,c.SDKMissingParameter,"Username missing in userTicket JSON object.",e)),e.user={identities:[s.identity]}}this.userObj=e,this.userObj.authorization=e.authorization||e.userTicket,this.userId=e.user.identities.reduce(function(e,t){return"username"===t.type?t.endpoint:e+""},""),t.resolve()}else n?n(e).then(function(e){this.userObj=e,this.userId=e.user.identities.reduce(function(e,t){return"username"===t.type?t.endpoint:e+""},""),t.resolve()}.bind(this)).fail(function(e){t.reject(new SinchError(a.ErrorDomainApi,c.ApiApiCallFailed,e.data.errorCode+" "+e.data.message,e.data))}):t.reject(new SinchError(a.ErrorDomainSDK,c.SDKMissingParameter,"No valid identity or authentication ticket",e));return t.promise},R.prototype.initSessKeySecret=function(){var e=r.defer(),t={};t.version={os:l()||"unknown",platform:f()||"unknown",sdk:"js/"+this.sinch.getVersion()},t.services={calling:[]},this.sinch._onlineCapability&&t.services.calling.push("online"),this.sinch.capabilities.messaging&&t.services.calling.push("im"),this.sinch.capabilities.calling&&(t.services.calling.push("voip"),t.services.calling.push("p2p"),t.services.calling.push("srtp")),t.authorization=this.userObj.authorization;var n=""!==this.sinch._sessionId;return n&&(t.instanceId=this.sinch._sessionId),t.expiresIn=31536e3,this.sinch[n?"renewSecret":"getInstance"](t).then(function(t){this.sinch.config({sessionId:t.id,sessionSecret:t.secret}),e.resolve()}.bind(this)).fail(function(t){this.sinch._sessionId="",this.sinch._sessionSecret="",e.reject(new SinchError(a.ErrorDomainApi,c.ApiApiCallFailed,t.data.errorCode+" "+t.data.message,t.data))}.bind(this)),e.promise},R.prototype.resumeSession=function(e){var t=r.defer();return this.userId=e.userId,this.sinch.config(e),this.sinch.getUserProfile().then(function(e){this.userObj=e,t.resolve()}.bind(this)).fail(function(e){e instanceof SinchError?t.reject(e):t.reject(new SinchError(a.ErrorDomainApi,c.ApiApiCallFailed,e.data.errorCode+" "+e.data.message,e.data))}),t.promise},R.prototype.getMXPConf=function(){var e=r.defer();return this.sinch.getConfiguration().then(function(t){this.mxpConfig=t,e.resolve()}.bind(this)).fail(function(t){e.reject(new SinchError(a.ErrorDomainApi,c.ApiApiCallFailed,t.data.errorCode+" "+t.data.message,t.data))}),e.promise},j.prototype.request=function(e,t){var n=r.defer();if(this.flagVerified){var i=new SinchError(a.ErrorDomainVerification,c.VerificationUnexpectedInitiateError,"Verification already verified, can't request new code.");n.reject(i)}else{var s={identity:{type:"number",endpoint:this.number},custom:this.custom,method:this.method,metadata:{os:l(),platform:f(),sdk:"js/"+this.sinch.getVersion()}};this.sinch.verify(s).then(function(t){e&&e(),n.resolve()}.bind(this)).fail(function(e){var i;i=e.status?new SinchError(a.ErrorDomainVerification,c.VerificationServiceError,"Could not request verification: "+e.statusText,e.responseText):e,t&&t(i),n.reject(i)}.bind(this))}return n.promise},j.prototype.verify=function(e,t,n){var i=r.defer();if(this.flagVerified)t&&t(this.cachedResponse),i.resolve(this.cachedResponse);else{var s={number:this.number,source:"manual",sms:"sms"==this.method?{code:e}:null,flashcall:"flashcall"==this.method?{cli:e}:null,method:this.method||"sms"};this.sinch.confirmVerification(s).then(function(e){this.flagVerified=!0,this.cachedResponse=e,t&&t(e),i.resolve(e)}.bind(this)).fail(function(e){var t;t=e.status?new SinchError(a.ErrorDomainVerification,c.VerificationIncorrectCode,"Could not verify code: "+e.statusText,e.responseText):e,n&&n(t),i.reject(t)}.bind(this))}return i.promise},j.prototype.initiate=function(e,t){return this.request(e,t)},j.prototype.retry=function(e,t){return this.request(e,t)};var U=function(e){var t=e.key,n=e.decrypted;e.mxpSessionId;try{var i=W.enc.Utf8.parse(JSON.stringify(n));t=W.enc.Base64.parse(t);var r=W.lib.WordArray.random(16),s=W.AES.encrypt(i,t,{iv:r}),o=W.enc.Hex.parse(r.toString(W.enc.Hex)+s.ciphertext.toString(W.enc.Hex))}catch(t){throw t.message=e.message,new K(a.ErrorDomainOther,c.OtherOther,"MXPEncrypt error: "+t.message,t)}return e.encrypted=o.toString(W.enc.Base64),e},L=function(e){try{var t=e.key,n=e.message.split(" ")[5],i=W.enc.Base64.parse(n).toString(W.enc.Hex),r=W.enc.Hex.parse(i.substr(0,32)),s=W.enc.Hex.parse(i.substr(32)),o=W.lib.CipherParams.create({ciphertext:s,salt:null}),u=W.AES.decrypt(o,W.enc.Base64.parse(t),{iv:r}).toString(W.enc.Utf8),h=u.indexOf("{"),l=u.lastIndexOf("}")+1;u=u.substring(h,l),e.decrypted=JSON.parse(u)}catch(t){throw t.message=e.message,new K(a.ErrorDomainOther,c.OtherOther,"MXPDecrypt error: "+t.message,t)}return e};function K(e,t,n,i){this.name="MXPError",this.domain=e||-1,this.code=t||0,this.response=i||{},this.message=n||"General MXP error",this.stack=new Error(n).stack}function H(e,t,n){this.decrypted={};for(var i in e)if("object"==typeof e[i]){e[i]instanceof Array?this[i]=[]:this[i]={};for(var r in e[i])this[i][r]=e[i][r]}else this[i]=e[i];if(t instanceof g){t.activeInstance&&n&&(this.decrypted.nvps=this.decrypted.nvps||{},this.decrypted.nvps.to=t.activeInstance),this.txChannels=[];for(var s in t.clientMap)"virtual"!=s&&-1===this.txChannels.indexOf(t.clientMap[s].fs)&&this.txChannels.push(t.clientMap[s].fs);0==this.txChannels.length&&"virtual"in t.clientMap&&this.txChannels.push(t.clientMap.virtual.fs),this.sub="signalPubNub"}}function z(e){this.sinch=e,this.user=e.user,this.rtcConfiguration=e.user.mxpConfig.rtcConfiguration,this.rtcProfile=e.user.mxpConfig.rtcProfile,this.broadcastPubNub=PUBNUB({publish_key:this.rtcConfiguration.broadcastNetwork.publishKey,subscribe_key:this.rtcConfiguration.broadcastNetwork.subscribeKey,ssl:!0,origin:this.rtcConfiguration.broadcastNetwork.host}),this.signalPubNub=PUBNUB({publish_key:this.rtcConfiguration.signalNetwork.publishKey,subscribe_key:this.rtcConfiguration.signalNetwork.subscribeKey,ssl:!0,origin:this.rtcConfiguration.signalNetwork.host}),this.messageBuffert={},this.transportBuffert={},this.sessionBuffert={},this.unencryptedFrames={},this.broadcastPubNub.sinchStack={},this.broadcastPubNub.sinchStack[this.rtcProfile.broadcastChannel]=[],this.broadcastPubNub.sinchStack[this.rtcProfile.transportChannel]=[],this.signalPubNub.sinchStack={},this.signalPubNub.sinchStack[this.rtcProfile.signalChannel]=[]}function MXPError(e,t,n,i){this.name="MXPError",this.domain=e||-1,this.code=t||0,this.response=i||{},this.message=n||"General MXP error",this.stack=new Error(n).stack}function MXPLog(e,t){this.message=e,this.object=t}H.prototype.getSenderId=function(){if(void 0===this.decrypted.fi)throw new SinchError(a.ErrorDomainSDK,c.SDKInternalError,"getSenderId failed, no from instance defined",{});return this.decrypted.fsi?this.decrypted.fi+this.decrypted.fsi||"virtual":(this.decrypted.nvps||{}).fsi?this.decrypted.fi+this.decrypted.nvps.fsi||"virtual":this.decrypted.fi||"virtual"},H.prototype.getFrom=function(){return{fc:this.decrypted.fc,fd:this.decrypted.fd,fi:this.decrypted.fi,fsi:this.decrypted.fsi,fs:this.decrypted.fs,fu:this.decrypted.fu}},H.prototype.getInstanceId=function(){return this.decrypted.fi?this.decrypted.fi.split(":")[0]:null},z.prototype.init=function(){return this.subscribe("broadcastPubNub")},z.prototype.close=function(){var e=this.broadcastPubNub,t=this.signalPubNub;return setTimeout(function(){e&&e.offline(),t&&t.offline()}.bind(this),1e4),r.all([this.unsubscribe("broadcastPubNub"),this.unsubscribe("signalPubNub")])},z.prototype.destroy=function(){delete this.broadcastPubNub,delete this.signalPubNub},z.prototype.subscribe=function(e){var t=r.defer(),n={restore:!1,connect:function(e){t.resolve()}.bind(this),channel:Object.keys(this[e].sinchStack),callback:this._onmessagePubNub.bind(this),disconnect:this._ondisconnectPubNub.bind(this),error:this._onerrorPubNub.bind(this)},i=!0;for(var s in this[e].sinchStack)i&=0==this[e].sinchStack[s].length,this[e].sinchStack[s].push(!0);return i?this[e].subscribe(n):t.resolve(),t.promise},z.prototype.subscribeNotificationChannel=function(e){var t=r.defer();this.broadcastPubNub.sinchStack[e]=[];var n={restore:!1,connect:function(e){t.resolve()}.bind(this),channel:e,callback:function(t){this.sinch.onnotification(e,t)}.bind(this),disconnect:this._ondisconnectPubNub.bind(this),error:this._onerrorPubNub.bind(this)};return this.broadcastPubNub.subscribe(n),t.promise},z.prototype.unsubscribe=function(e){var t=!0;for(var n in this[e].sinchStack)this[e].sinchStack[n].pop(),t&=0==this[e].sinchStack[n].length;t&&this[e].unsubscribe({channel:Object.keys(this[e].sinchStack)})},z.prototype.signalStatus=function(){return this.signalPubNub.sinchStack[this.rtcProfile.signalChannel].length>0},z.prototype._onmessagePubNub=function(e){this.sinch.log(new MXPLog("Recieved message",e)),r.fcall(this.collectFrames.bind(this),e).then(this.identifyKey.bind(this)).then(L).then(this.handleMessage.bind(this)).fail(function(t){if(t instanceof K){var n=e.split(" ")[1];this.unencryptedFrames[n]=this.unencryptedFrames[n]||[],this.unencryptedFrames[n].push(t.response.message)}else this.handleError(t)}.bind(this))},z.prototype.configureMxpSession=function(e,t,n){this.sessionBuffert[e]={key:t,body:n},this.processUnencryptedForKey(e)},z.prototype.processUnencryptedForKey=function(e){for(var t in this.unencryptedFrames[e])this._onmessagePubNub(this.unencryptedFrames[e][t]),delete this.unencryptedFrames[e][t]},z.prototype._ondisconnectPubNub=function(e){this.sinch.log(new MXPLog("Was disconnected!",e))},z.prototype._onerrorPubNub=function(e){var t=new MXPError(a.ErrorDomainNetwork,c.NetworkConnectionRefused,"PubNub error",e);this.sinch.log(t)},z.prototype.collectFrames=function(e){var t=r.defer(),n=e.split(" "),i=n[1]+n[2];try{n[3]=parseInt(n[3]),n[4]=parseInt(n[4])}catch(e){console.error("Could not parse MXP indices. Malformatted MXP message.")}if(1===n[4])t.resolve(e);else if((this.messageBuffert[i]||(this.messageBuffert[i]={}))[n[3]]=n[5],Object.keys(this.messageBuffert[i]).length==n[4]){var s=n[0]+" "+n[1]+" "+n[2]+" 0 1 ";for(var o in this.messageBuffert[i])s+=this.messageBuffert[i][o];void 0!==n[6]&&(s+=" "+n[6]),this.sinch.log(new MXPLog("All frames collected and merged, full array",this.messageBuffert[i])),delete this.messageBuffert[i],t.resolve(s)}else t.reject(new MXPLog("All frames not yet gathered",this.messageBuffert[i]));return t.promise},z.prototype.identifyKey=function(e){this.sinch.log(new MXPLog("Will identify key",e));var t,n=r.defer(),i=e.trim().split(" ");return void 0!==(t=i[6])?(this.sinch.log(new MXPLog("Transport key identified",e)),this.getTransport(t).then(function(r){n.resolve(new H({mxpSessionId:i[1],message:e,transportId:t,transportObj:r,key:this.transportBuffert[t].key,keyType:"T"}))}.bind(this)).fail(function(e){n.reject(e)}.bind(this))):void 0!==(this.sessionBuffert[i[1]]||{}).key?(this.sinch.log(new MXPLog("Session key in buffert identified",e)),n.resolve(new H({mxpSessionId:i[1],message:e,key:this.sessionBuffert[i[1]].key,keyType:"S"}))):(this.sinch.log(new MXPLog("No key, fall back on instance key",e)),n.resolve(new H({mxpSessionId:i[1],message:e,key:this.rtcProfile.key,keyType:"I"}))),n.promise},z.prototype.handleMessage=function(e){this.sinch.log(new MXPLog("Will handle message",e));var t=r.defer(),n=e.decrypted.md+"_"+(e.decrypted.bt||"null");return this.sinch.logMxp(new function(e,t){this.handler=e,this.object=t}(n,e)),G[n]?G[n].call(this,e):t.reject(new MXPError(a.ErrorDomainOther,c.OtherOther,"Handler not implemented: "+n,{})),t.promise},z.prototype.handleError=function(e){this.sinch.log(e),e.stack&&console.error(e.stack)},z.prototype.getTransport=function(e){var t=r.defer();if(e.constructor==String){var n=e;void 0!==this.transportBuffert[n]?(this.sinch.log(new MXPLog("Got transport from Buffert",this.transportBuffert[n])),t.resolve(this.transportBuffert[n])):this.sinch.getTransportById({transportId:n}).then(function(e){this.sinch.log(new MXPLog("Got new transport",e)),this.transportBuffert[n]=e,t.resolve(this.transportBuffert[n])}.bind(this))}else{if(e instanceof H||e instanceof Array){var i=e instanceof H?e.recipientIds:e,s=(i=i.filter(function(e,t,n){return n.indexOf(e)===t})).indexOf(this.user.userId);s>-1&&i.splice(s,1);var o=[];i.forEach(function(e){if("string"==typeof e)o.push({identity:e});else if(e instanceof Object)for(var t in e)o.push({identity:e[t],type:t})}),i.push(this.user.userId),i=i.sort();var u=btoa(JSON.stringify(i));if(this.transportBuffert[u]){var h=this.transportBuffert[u];this.sinch.log(new MXPLog("Got cached transport for recipient(s)",h)),e instanceof H?(e.transportObj=h,e.transportId=e.transportObj.transportId,t.resolve(e)):t.resolve(h)}else this.sinch.getTransportByParticipants(o).then(function(n){n.participants.forEach(function(e){e.capabilityUnion=[],(e.instances||[]).forEach(function(t){e.capabilityUnion=e.capabilityUnion.concat(t.capabilities)}),e.capabilityUnion=e.capabilityUnion.filter(function(t,n){return e.capabilityUnion.indexOf(t)==n})});var r=[];if(n.participants.forEach(function(e){-1===e.capabilityUnion.indexOf("im")&&-1===e.capabilityUnion.indexOf("im.1")&&r.push(e.destination.identity)}),r.length>0)throw new SinchError(a.ErrorDomainCapability,c.CapabilityCapabilityMissing,"User missing capability",r);n.participants.unshift({channel:this.rtcProfile.transportChannel,destination:{identity:this.user.userId}});var s=n.participants.reduce(function(e,t){return e.push(t.destination.identity),e}.bind(this),[]),o=i.filter(function(e){return s.indexOf(e)<0});if(i.length!=n.participants.length)throw new MXPError(a.ErrorDomainCapability,c.CapabilityUserNotFound,"User does not exist",o);this.sinch.log(new MXPLog("Got new transport for recipient(s)",n)),this.transportBuffert[u]=n,e instanceof H?(e.transportObj=n,e.transportId=e.transportObj.transportId,t.resolve(e)):t.resolve(n)}.bind(this)).fail(function(e){t.reject(e)});return t.promise}t.reject(new MXPError(a.ErrorDomainOther,c.OtherOther,"Unknown transport ID",n))}return t.promise},z.prototype.sendMXP=function(e){var t=r.defer();return e.sub=e.sub||"broadcastPubNub",r.fcall(this.constructMXP.bind(this),e).then(this.identifyEnKey.bind(this)).then(U).then(this.splitFrames.bind(this)).then(this.getTxChannels.bind(this)).then(this.transmitFrames.bind(this)).then(function(e){t.resolve(e)}).fail(function(e){console.error(e.stack),console.error(e),t.reject(e)}).progress(function(e){t.notify(e)}),t.promise},z.prototype.constructMXP=function(e){return e.decrypted.fu=this.user.userId,e.decrypted.fi=this.sinch._sessionId+":"+this.sinch._subInstanceId,e.decrypted.fd=this.sinch._sessionId,e.decrypted.fc="",this.sinch.log(new MXPLog("Added meta data to MXP message",e)),e},z.prototype.identifyEnKey=function(e){return e.transportObj?(e.transportId=e.transportObj.transportId,e.key=e.transportObj.key,e.keyType="T",e.decrypted.fs=this.rtcProfile.transportChannel):(e.key=this.sessionBuffert[e.mxpSessionId].key,e.keyType="S",e.decrypted.fs=this.rtcProfile.signalChannel),this.sinch.log(new MXPLog("Identified Encoding Key",e)),e},z.prototype.splitFrames=function(e){e.encodedFrames=[];var t=1500;t-=e.mxpSessionId.length,t-=(e.transportId||"").length,t-=9,t-=6;do{e.encodedFrames.push(e.encrypted.slice(0,t)),e.encrypted=e.encrypted.substring(t)}while(e.encrypted.length>0);var n=Math.floor(2e9*Math.random());for(var i in e.encodedFrames)e.encodedFrames[i]="10 "+e.mxpSessionId+" "+(e.encodedFrames.length>1?n:"-")+" "+i+" "+e.encodedFrames.length+" "+e.encodedFrames[i],e.transportId&&(e.encodedFrames[i]+=" "+e.transportId);return this.sinch.log(new MXPLog("Split message into frames as needed",e)),e},z.prototype.getTxChannels=function(e){return e.txChannels=e.txChannels||[],e.transportObj&&e.transportObj.participants.forEach(function(t){e.txChannels.push(t.channel)}),this.sinch.log(new MXPLog("Identified Tx Channels",e)),e},z.prototype.transmitFrames=function(e){var t=r.defer();this.sinch.logMxp(new function(e,t){this.handler=e,this.object=t}(e.decrypted.md+"_"+(e.decrypted.bt||"null"),e));var n,i=[];return n=e.transportObj?e.transportObj.participants.length*e.encodedFrames.length:e.encodedFrames.length,i.length==n&&t.resolve(e),e.txChannels.forEach(function(r){e.encodedFrames.forEach(function(s){this.sinch.log(new MXPLog("Transmitting [channel, frame]",[r,s])),this[e.sub].publish({channel:r,message:s,callback:function(r){i.push(r),t.notify(new Notification(i.length,n,"MXP Message send progress (frame Tx)")),i.length==n&&setTimeout(function(){t.resolve(e)},1e3)},error:function(e){console.error("PubNub: Error sending frame",e),t.reject(new MXPError(a.ErrorDomainOther,c.OtherOther,"PubNub: Error sending frame",e))}})}.bind(this))}.bind(this)),t.promise},MXPError.prototype=Error.prototype;z.prototype.joinIncomingCall=function(e,t){var n=r.defer(),i=new H({mxpSessionId:e.callId},e,!0);return i.decrypted.bd=t||null,i.decrypted.md=3,i.decrypted.bt=t?"media":"sdp",i.decrypted.bv=10,this.sendMXP(i).then(function(){n.resolve()}).fail(function(e){n.reject(e)}).progress(function(e){n.notify(e)}.bind(this)),n.promise},z.prototype.callJoined=function(e){var t=r.defer(),n=new H({mxpSessionId:e.callId},e);return n.decrypted.bd=JSON.stringify(e.clientMap[e.activeInstance]),n.decrypted.md=4,n.decrypted.bt="client",n.decrypted.bv=10,n.decrypted.nvps&&delete n.decrypted.nvps.to,this.sendMXP(n).then(function(){t.resolve()}).fail(function(e){t.reject(e)}).progress(function(e){t.notify(e)}.bind(this)),t.promise},z.prototype.sendSdpAnswer=function(e,t){var n=r.defer(),i=new H({mxpSessionId:e.callId},e);return i.decrypted.bd=t?JSON.stringify(t):null,i.decrypted.md=2,i.decrypted.bt=t?"sdp":null,i.decrypted.bv=10,this.sendMXP(i).then(function(){n.resolve()}).fail(function(e){n.reject(e)}).progress(function(e){n.notify(e)}.bind(this)),n.promise},z.prototype.callHangup=function(e){var t=r.defer(),n=new H({mxpSessionId:e.callId},e);return n.decrypted.md=5,n.decrypted.bv=10,this.sendMXP(n).then(function(){t.resolve()}).fail(function(e){t.reject(e)}).progress(function(e){t.notify(e)}.bind(this)),t.promise},z.prototype.callDeny=function(e,t){var n=r.defer(),i=new H({mxpSessionId:e.callId},e);return i.decrypted.md=6,i.decrypted.bv=10,t&&(i.decrypted.nvps=i.decrypted.nvps||{},i.decrypted.nvps.to=t||"undefined",i.decrypted.nvps.denyall="no"),this.sendMXP(i).then(function(){n.resolve()}).fail(function(e){n.reject(e)}).progress(function(e){n.notify(e)}.bind(this)),n.promise},z.prototype.callCancel=function(e){var t=r.defer(),n=new H({mxpSessionId:e.callId},e);return n.decrypted.md=7,n.decrypted.bv=10,this.sendMXP(n).then(function(){t.resolve()}).fail(function(e){t.reject(e)}).progress(function(e){t.notify(e)}.bind(this)),t.promise},z.prototype.callTxICECandidate=function(e,t,n){var i=r.defer(),s=new H({mxpSessionId:e.callId},e);return s.decrypted.bd=JSON.stringify(t),s.decrypted.md=10,s.decrypted.bt="sdp",s.decrypted.bv=10,n&&(s.decrypted.nvps=s.decrypted.nvps||{},s.decrypted.nvps.to=n||"undefined"),this.sendMXP(s).then(function(){i.resolve()}).fail(function(e){i.reject(e)}).progress(function(e){i.notify(e)}.bind(this)),i.promise},z.prototype.callTxPeerEventSDP=function(e,t,n){var i=r.defer(),s=new H({mxpSessionId:e.callId},e);return s.decrypted.bd=JSON.stringify(t),s.decrypted.md=10,s.decrypted.bt="sdp",s.decrypted.bv=10,s.decrypted.nvps=s.decrypted.nvps||{},s.decrypted.nvps.to=n||"undefined",this.sendMXP(s).then(function(){i.resolve()}).fail(function(e){i.reject(e)}).progress(function(e){i.notify(e)}.bind(this)),i.promise},z.prototype.msgToMe=function(e){return!e.decrypted.nvps||!e.decrypted.nvps.to||e.decrypted.nvps.to==this.sinch._sessionId+":"+this.sinch._subInstanceId},z.prototype.msgToMe2=function(e){return!e.decrypted.nvps||!e.decrypted.nvps.to||e.decrypted.nvps.to==this.sinch._sessionId};var F={"1_media":function(e){this.msgToMe2(e)?(function(){if(void 0===this.sinch.callClient){var e=new MXPError(a.ErrorDomainCapability,c.CapabilityCapabilityMissing,"Can not process call signal messages. Call capability not set.");this.sinch.log(e)}}.call(this),this.sinch.callClient&&this.sinch.callClient.handleIncomingCall(e)):this.sinch.log(new Notification(0,1,"Received INVITE message not meant for this instance, nvps.to header set to foreign instance id",e))},"2_null":function(e){this.sinch.callClient&&this.sinch.callClient.callBuffert[e.mxpSessionId]&&this.sinch.callClient.callBuffert[e.mxpSessionId].mxpAck(e)},"2_media":function(e){this.sinch.callClient&&this.sinch.callClient.callBuffert[e.mxpSessionId]&&this.sinch.callClient.callBuffert[e.mxpSessionId].mxpAck(e)},"2_sdp":function(e){this.sinch.callClient&&this.sinch.callClient.callBuffert[e.mxpSessionId]&&this.sinch.callClient.callBuffert[e.mxpSessionId].mxpAck(e)},"3_media":function(e){this.sinch.callClient&&this.sinch.callClient.callBuffert[e.mxpSessionId]&&this.sinch.callClient.callBuffert[e.mxpSessionId].mxpJoin(e)},"3_sdp":function(e){this.sinch.callClient&&this.sinch.callClient.callBuffert[e.mxpSessionId]&&this.sinch.callClient.callBuffert[e.mxpSessionId].mxpJoin(e)},"4_client":function(e){this.sinch.callClient&&this.sinch.callClient.callBuffert[e.mxpSessionId]&&this.sinch.callClient.callBuffert[e.mxpSessionId].mxpJoined(e)},"5_null":function(e){this.msgToMe(e)?this.sinch.callClient&&this.sinch.callClient.callBuffert[e.mxpSessionId]&&this.sinch.callClient.callBuffert[e.mxpSessionId].mxpHangup(e):this.sinch.log(new Notification(0,1,"Received HUNG_UP message not meant for this instance, nvps.to header set to foreign instance id",e))},"6_null":function(e){this.msgToMe(e)?this.sinch.callClient&&this.sinch.callClient.callBuffert[e.mxpSessionId]&&this.sinch.callClient.callBuffert[e.mxpSessionId].mxpDeny(e):this.sinch.callClient&&this.sinch.log(new Notification(0,1,"Received DENIED message not meant for this instance, nvps.to header set to foreign instance id",e))},"6_error/json":function(e){this.msgToMe(e)?this.sinch.callClient&&this.sinch.callClient.callBuffert[e.mxpSessionId]&&this.sinch.callClient.callBuffert[e.mxpSessionId].mxpDeny(e):this.sinch.callClient&&this.sinch.log(new Notification(0,1,"Received DENIED message not meant for this instance, nvps.to header set to foreign instance id",e))},"7_null":function(e){this.msgToMe(e)?this.sinch.callClient&&this.sinch.callClient.callBuffert[e.mxpSessionId]&&this.sinch.callClient.callBuffert[e.mxpSessionId].mxpCancel(e):this.sinch.log(new Notification(0,1,"Received CANCEL message not meant for this instance, nvps.to header set to foreign instance id",e))},"7_client":function(e){this.msgToMe(e)?this.sinch.callClient&&this.sinch.callClient.callBuffert[e.mxpSessionId]&&this.sinch.callClient.callBuffert[e.mxpSessionId].mxpCancel(e):this.sinch.log(new Notification(0,1,"Received CANCEL message not meant for this instance, nvps.to header set to foreign instance id",e))},"9_message":function(e){this.sinch.callClient&&this.sinch.callClient.callBuffert[e.mxpSessionId]&&this.sinch.callClient.callBuffert[e.mxpSessionId].mxpFail(e)},"9_error/json":function(e){this.sinch.callClient&&this.sinch.callClient.callBuffert[e.mxpSessionId]&&this.sinch.callClient.callBuffert[e.mxpSessionId].mxpFail(e)},"10_sdp":function(e){if(this.msgToMe(e)){var t=JSON.parse(e.decrypted.bd);"type"in t&&"offer"==t.type||"answer"==t.type?this.sinch.callClient&&this.sinch.callClient.callBuffert[e.mxpSessionId]&&this.sinch.callClient.callBuffert[e.mxpSessionId].mxpPeerEventSdp(e):this.sinch.callClient&&this.sinch.callClient.callBuffert[e.mxpSessionId]&&this.sinch.callClient.callBuffert[e.mxpSessionId].mxpInjectIce(e)}else this.sinch.log(new Notification(0,1,"Received SDP/CAND message not meant for this instance, nvps.to header set to foreign instance id",e))}},G=G||{};for(var V in F)G[V]=F[V];z.prototype.sendMessage=function(e){var t=e.getMXPMessageObj(),n=r.defer();return t.decrypted.md=1,t.decrypted.bt="msg",t.decrypted.bv=10,this.getTransport(t).then(this.sendMXP.bind(this)).then(function(e){G["1_msg"].call(this,e),this.sinch.log(new MXPLog("Message sent to all participants",e)),n.resolve(this.sinch.messageClient.messageBuffert[e.mxpSessionId])}.bind(this)).fail(function(e){n.reject(e)}).progress(function(e){n.notify(e)}.bind(this)),n.promise},z.prototype.sendMsgAck=function(e){var t=new H({mxpSessionId:e.mxpSessionId});t.decrypted.md=2,t.decrypted.bt=e.decrypted.bt,t.decrypted.bv=10,t.transportObj=e.transportObj;var n=[];t.transportObj.participants.forEach(function(t){t.channel==e.decrypted.fs&&n.push(t)}.bind(this)),t.transportObj.participants=n,Object.keys(t.transportObj.participants).length>0&&(this.sinch.log(new MXPLog("Will send Ack",t)),this.sendMXP(t).then(function(t){this.sinch.log(new MXPLog("Sent ack",[e.decrypted.fu,t.channel]))}.bind(this)).fail(function(e){console.error(e)}))};var J={none:function(e){console.log("Null handler for message object: ",e)},"1_msg":function(e){(function(){if(void 0===this.sinch.messageClient){var e=new MXPError(a.ErrorDomainCapability,c.CapabilityCapabilityMissing,"Can not process IM messages. Messaging capability not set.");this.sinch.log(e)}}).call(this),this.sinch.messageClient&&this.sinch.messageClient.handleMessage(e)&&e.decrypted.fu!=this.user.userId&&this.sendMsgAck(e)},"2_msg":function(e){this.sinch.messageClient&&this.sinch.messageClient.ackMsg(e.decrypted.fu,e.mxpSessionId)}};G=G||{};for(var V in J)G[V]=J[V];var W=W||function(e,t){var n={},i=n.lib={},r=function(){},s=i.Base={extend:function(e){r.prototype=this;var t=new r;return e&&t.mixIn(e),t.hasOwnProperty("init")||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},o=i.WordArray=s.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=void 0!=t?t:4*e.length},toString:function(e){return(e||c).stringify(this)},concat:function(e){var t=this.words,n=e.words,i=this.sigBytes;if(e=e.sigBytes,this.clamp(),i%4)for(var r=0;r<e;r++)t[i+r>>>2]|=(n[r>>>2]>>>24-r%4*8&255)<<24-(i+r)%4*8;else if(65535<n.length)for(r=0;r<e;r+=4)t[i+r>>>2]=n[r>>>2];else t.push.apply(t,n);return this.sigBytes+=e,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-n%4*8,t.length=e.ceil(n/4)},clone:function(){var e=s.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var n=[],i=0;i<t;i+=4)n.push(4294967296*e.random()|0);return new o.init(n,t)}}),a=n.enc={},c=a.Hex={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],i=0;i<e;i++){var r=t[i>>>2]>>>24-i%4*8&255;n.push((r>>>4).toString(16)),n.push((15&r).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,n=[],i=0;i<t;i+=2)n[i>>>3]|=parseInt(e.substr(i,2),16)<<24-i%8*4;return new o.init(n,t/2)}},u=a.Latin1={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],i=0;i<e;i++)n.push(String.fromCharCode(t[i>>>2]>>>24-i%4*8&255));return n.join("")},parse:function(e){for(var t=e.length,n=[],i=0;i<t;i++)n[i>>>2]|=(255&e.charCodeAt(i))<<24-i%4*8;return new o.init(n,t)}},h=a.Utf8={stringify:function(e){try{return decodeURIComponent(escape(u.stringify(e)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(e){return u.parse(unescape(encodeURIComponent(e)))}},l=i.BufferedBlockAlgorithm=s.extend({reset:function(){this._data=new o.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=h.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n=this._data,i=n.words,r=n.sigBytes,s=this.blockSize,a=r/(4*s);if(t=(a=t?e.ceil(a):e.max((0|a)-this._minBufferSize,0))*s,r=e.min(4*t,r),t){for(var c=0;c<t;c+=s)this._doProcessBlock(i,c);c=i.splice(0,t),n.sigBytes-=r}return new o.init(c,r)},clone:function(){var e=s.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});i.Hasher=l.extend({cfg:s.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){l.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new f.HMAC.init(e,n).finalize(t)}}});var f=n.algo={};return n}(Math);!function(e){function t(e,t,n,i,r,s,o){return((e=e+(t&n|~t&i)+r+o)<<s|e>>>32-s)+t}function n(e,t,n,i,r,s,o){return((e=e+(t&i|n&~i)+r+o)<<s|e>>>32-s)+t}function i(e,t,n,i,r,s,o){return((e=e+(t^n^i)+r+o)<<s|e>>>32-s)+t}function r(e,t,n,i,r,s,o){return((e=e+(n^(t|~i))+r+o)<<s|e>>>32-s)+t}for(var s=W,o=(c=s.lib).WordArray,a=c.Hasher,c=s.algo,u=[],h=0;64>h;h++)u[h]=4294967296*e.abs(e.sin(h+1))|0;c=c.MD5=a.extend({_doReset:function(){this._hash=new o.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,s){for(var o=0;16>o;o++){var a=e[l=s+o];e[l]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8)}o=this._hash.words;var c,h,l=e[s+0],f=(a=e[s+1],e[s+2]),p=e[s+3],d=e[s+4],g=e[s+5],y=e[s+6],m=e[s+7],v=e[s+8],b=e[s+9],w=e[s+10],S=e[s+11],C=e[s+12],I=e[s+13],_=e[s+14],x=e[s+15],E=o[0],k=r(k=r(k=r(k=r(k=i(k=i(k=i(k=i(k=n(k=n(k=n(k=n(k=t(k=t(k=t(k=t(k=o[1],h=t(h=o[2],c=t(c=o[3],E=t(E,k,h,c,l,7,u[0]),k,h,a,12,u[1]),E,k,f,17,u[2]),c,E,p,22,u[3]),h=t(h,c=t(c,E=t(E,k,h,c,d,7,u[4]),k,h,g,12,u[5]),E,k,y,17,u[6]),c,E,m,22,u[7]),h=t(h,c=t(c,E=t(E,k,h,c,v,7,u[8]),k,h,b,12,u[9]),E,k,w,17,u[10]),c,E,S,22,u[11]),h=t(h,c=t(c,E=t(E,k,h,c,C,7,u[12]),k,h,I,12,u[13]),E,k,_,17,u[14]),c,E,x,22,u[15]),h=n(h,c=n(c,E=n(E,k,h,c,a,5,u[16]),k,h,y,9,u[17]),E,k,S,14,u[18]),c,E,l,20,u[19]),h=n(h,c=n(c,E=n(E,k,h,c,g,5,u[20]),k,h,w,9,u[21]),E,k,x,14,u[22]),c,E,d,20,u[23]),h=n(h,c=n(c,E=n(E,k,h,c,b,5,u[24]),k,h,_,9,u[25]),E,k,p,14,u[26]),c,E,v,20,u[27]),h=n(h,c=n(c,E=n(E,k,h,c,I,5,u[28]),k,h,f,9,u[29]),E,k,m,14,u[30]),c,E,C,20,u[31]),h=i(h,c=i(c,E=i(E,k,h,c,g,4,u[32]),k,h,v,11,u[33]),E,k,S,16,u[34]),c,E,_,23,u[35]),h=i(h,c=i(c,E=i(E,k,h,c,a,4,u[36]),k,h,d,11,u[37]),E,k,m,16,u[38]),c,E,w,23,u[39]),h=i(h,c=i(c,E=i(E,k,h,c,I,4,u[40]),k,h,l,11,u[41]),E,k,p,16,u[42]),c,E,y,23,u[43]),h=i(h,c=i(c,E=i(E,k,h,c,b,4,u[44]),k,h,C,11,u[45]),E,k,x,16,u[46]),c,E,f,23,u[47]),h=r(h,c=r(c,E=r(E,k,h,c,l,6,u[48]),k,h,m,10,u[49]),E,k,_,15,u[50]),c,E,g,21,u[51]),h=r(h,c=r(c,E=r(E,k,h,c,C,6,u[52]),k,h,p,10,u[53]),E,k,w,15,u[54]),c,E,a,21,u[55]),h=r(h,c=r(c,E=r(E,k,h,c,v,6,u[56]),k,h,x,10,u[57]),E,k,y,15,u[58]),c,E,I,21,u[59]),h=r(h,c=r(c,E=r(E,k,h,c,d,6,u[60]),k,h,S,10,u[61]),E,k,f,15,u[62]),c,E,b,21,u[63]);o[0]=o[0]+E|0,o[1]=o[1]+k|0,o[2]=o[2]+h|0,o[3]=o[3]+c|0},_doFinalize:function(){var t=this._data,n=t.words,i=8*this._nDataBytes,r=8*t.sigBytes;n[r>>>5]|=128<<24-r%32;var s=e.floor(i/4294967296);for(n[15+(r+64>>>9<<4)]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),n[14+(r+64>>>9<<4)]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8),t.sigBytes=4*(n.length+1),this._process(),n=(t=this._hash).words,i=0;4>i;i++)r=n[i],n[i]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8);return t},clone:function(){var e=a.clone.call(this);return e._hash=this._hash.clone(),e}}),s.MD5=a._createHelper(c),s.HmacMD5=a._createHmacHelper(c)}(Math);var X,q,Q,Y;W=W||function(e,t){var n={},i=n.lib={},r=function(){},s=i.Base={extend:function(e){r.prototype=this;var t=new r;return e&&t.mixIn(e),t.hasOwnProperty("init")||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},o=i.WordArray=s.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=void 0!=t?t:4*e.length},toString:function(e){return(e||c).stringify(this)},concat:function(e){var t=this.words,n=e.words,i=this.sigBytes;if(e=e.sigBytes,this.clamp(),i%4)for(var r=0;r<e;r++)t[i+r>>>2]|=(n[r>>>2]>>>24-r%4*8&255)<<24-(i+r)%4*8;else if(65535<n.length)for(r=0;r<e;r+=4)t[i+r>>>2]=n[r>>>2];else t.push.apply(t,n);return this.sigBytes+=e,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-n%4*8,t.length=e.ceil(n/4)},clone:function(){var e=s.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var n=[],i=0;i<t;i+=4)n.push(4294967296*e.random()|0);return new o.init(n,t)}}),a=n.enc={},c=a.Hex={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],i=0;i<e;i++){var r=t[i>>>2]>>>24-i%4*8&255;n.push((r>>>4).toString(16)),n.push((15&r).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,n=[],i=0;i<t;i+=2)n[i>>>3]|=parseInt(e.substr(i,2),16)<<24-i%8*4;return new o.init(n,t/2)}},u=a.Latin1={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],i=0;i<e;i++)n.push(String.fromCharCode(t[i>>>2]>>>24-i%4*8&255));return n.join("")},parse:function(e){for(var t=e.length,n=[],i=0;i<t;i++)n[i>>>2]|=(255&e.charCodeAt(i))<<24-i%4*8;return new o.init(n,t)}},h=a.Utf8={stringify:function(e){try{return decodeURIComponent(escape(u.stringify(e)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(e){return u.parse(unescape(encodeURIComponent(e)))}},l=i.BufferedBlockAlgorithm=s.extend({reset:function(){this._data=new o.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=h.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n=this._data,i=n.words,r=n.sigBytes,s=this.blockSize,a=r/(4*s);if(t=(a=t?e.ceil(a):e.max((0|a)-this._minBufferSize,0))*s,r=e.min(4*t,r),t){for(var c=0;c<t;c+=s)this._doProcessBlock(i,c);c=i.splice(0,t),n.sigBytes-=r}return new o.init(c,r)},clone:function(){var e=s.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});i.Hasher=l.extend({cfg:s.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){l.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new f.HMAC.init(e,n).finalize(t)}}});var f=n.algo={};return n}(Math);!function(e){for(var t=W,n=(r=t.lib).WordArray,i=r.Hasher,r=t.algo,s=[],o=[],a=function(e){return 4294967296*(e-(0|e))|0},c=2,u=0;64>u;){var h;e:{h=c;for(var l=e.sqrt(h),f=2;f<=l;f++)if(!(h%f)){h=!1;break e}h=!0}h&&(8>u&&(s[u]=a(e.pow(c,.5))),o[u]=a(e.pow(c,1/3)),u++),c++}var p=[];r=r.SHA256=i.extend({_doReset:function(){this._hash=new n.init(s.slice(0))},_doProcessBlock:function(e,t){for(var n=this._hash.words,i=n[0],r=n[1],s=n[2],a=n[3],c=n[4],u=n[5],h=n[6],l=n[7],f=0;64>f;f++){if(16>f)p[f]=0|e[t+f];else{var d=p[f-15],g=p[f-2];p[f]=((d<<25|d>>>7)^(d<<14|d>>>18)^d>>>3)+p[f-7]+((g<<15|g>>>17)^(g<<13|g>>>19)^g>>>10)+p[f-16]}d=l+((c<<26|c>>>6)^(c<<21|c>>>11)^(c<<7|c>>>25))+(c&u^~c&h)+o[f]+p[f],g=((i<<30|i>>>2)^(i<<19|i>>>13)^(i<<10|i>>>22))+(i&r^i&s^r&s),l=h,h=u,u=c,c=a+d|0,a=s,s=r,r=i,i=d+g|0}n[0]=n[0]+i|0,n[1]=n[1]+r|0,n[2]=n[2]+s|0,n[3]=n[3]+a|0,n[4]=n[4]+c|0,n[5]=n[5]+u|0,n[6]=n[6]+h|0,n[7]=n[7]+l|0},_doFinalize:function(){var t=this._data,n=t.words,i=8*this._nDataBytes,r=8*t.sigBytes;return n[r>>>5]|=128<<24-r%32,n[14+(r+64>>>9<<4)]=e.floor(i/4294967296),n[15+(r+64>>>9<<4)]=i,t.sigBytes=4*n.length,this._process(),this._hash},clone:function(){var e=i.clone.call(this);return e._hash=this._hash.clone(),e}});t.SHA256=i._createHelper(r),t.HmacSHA256=i._createHmacHelper(r)}(Math),q=(X=W).enc.Utf8,X.algo.HMAC=X.lib.Base.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=q.parse(t));var n=e.blockSize,i=4*n;t.sigBytes>i&&(t=e.finalize(t)),t.clamp();for(var r=this._oKey=t.clone(),s=this._iKey=t.clone(),o=r.words,a=s.words,c=0;c<n;c++)o[c]^=1549556828,a[c]^=909522486;r.sigBytes=s.sigBytes=i,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher;return e=t.finalize(e),t.reset(),t.finalize(this._oKey.clone().concat(e))}}),Y=(Q=W).lib.WordArray,Q.enc.Base64={stringify:function(e){var t=e.words,n=e.sigBytes,i=this._map;e.clamp(),e=[];for(var r=0;r<n;r+=3)for(var s=(t[r>>>2]>>>24-r%4*8&255)<<16|(t[r+1>>>2]>>>24-(r+1)%4*8&255)<<8|t[r+2>>>2]>>>24-(r+2)%4*8&255,o=0;4>o&&r+.75*o<n;o++)e.push(i.charAt(s>>>6*(3-o)&63));if(t=i.charAt(64))for(;e.length%4;)e.push(t);return e.join("")},parse:function(e){var t=e.length,n=this._map;(i=n.charAt(64))&&-1!=(i=e.indexOf(i))&&(t=i);for(var i=[],r=0,s=0;s<t;s++)if(s%4){var o=n.indexOf(e.charAt(s-1))<<s%4*2,a=n.indexOf(e.charAt(s))>>>6-s%4*2;i[r>>>2]|=(o|a)<<24-r%4*8,r++}return Y.create(i,r)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="};var $,Z,ee,te,ne,ie,re;W=W||function(e,t){var n={},i=n.lib={},r=function(){},s=i.Base={extend:function(e){r.prototype=this;var t=new r;return e&&t.mixIn(e),t.hasOwnProperty("init")||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},o=i.WordArray=s.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=void 0!=t?t:4*e.length},toString:function(e){return(e||c).stringify(this)},concat:function(e){var t=this.words,n=e.words,i=this.sigBytes;if(e=e.sigBytes,this.clamp(),i%4)for(var r=0;r<e;r++)t[i+r>>>2]|=(n[r>>>2]>>>24-r%4*8&255)<<24-(i+r)%4*8;else if(65535<n.length)for(r=0;r<e;r+=4)t[i+r>>>2]=n[r>>>2];else t.push.apply(t,n);return this.sigBytes+=e,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-n%4*8,t.length=e.ceil(n/4)},clone:function(){var e=s.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var n=[],i=0;i<t;i+=4)n.push(4294967296*e.random()|0);return new o.init(n,t)}}),a=n.enc={},c=a.Hex={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],i=0;i<e;i++){var r=t[i>>>2]>>>24-i%4*8&255;n.push((r>>>4).toString(16)),n.push((15&r).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,n=[],i=0;i<t;i+=2)n[i>>>3]|=parseInt(e.substr(i,2),16)<<24-i%8*4;return new o.init(n,t/2)}},u=a.Latin1={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],i=0;i<e;i++)n.push(String.fromCharCode(t[i>>>2]>>>24-i%4*8&255));return n.join("")},parse:function(e){for(var t=e.length,n=[],i=0;i<t;i++)n[i>>>2]|=(255&e.charCodeAt(i))<<24-i%4*8;return new o.init(n,t)}},h=a.Utf8={stringify:function(e){try{return decodeURIComponent(escape(u.stringify(e)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(e){return u.parse(unescape(encodeURIComponent(e)))}},l=i.BufferedBlockAlgorithm=s.extend({reset:function(){this._data=new o.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=h.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n=this._data,i=n.words,r=n.sigBytes,s=this.blockSize,a=r/(4*s);if(t=(a=t?e.ceil(a):e.max((0|a)-this._minBufferSize,0))*s,r=e.min(4*t,r),t){for(var c=0;c<t;c+=s)this._doProcessBlock(i,c);c=i.splice(0,t),n.sigBytes-=r}return new o.init(c,r)},clone:function(){var e=s.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});i.Hasher=l.extend({cfg:s.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){l.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new f.HMAC.init(e,n).finalize(t)}}});var f=n.algo={};return n}(Math);Z=($=W).lib.WordArray,$.enc.Base64={stringify:function(e){var t=e.words,n=e.sigBytes,i=this._map;e.clamp(),e=[];for(var r=0;r<n;r+=3)for(var s=(t[r>>>2]>>>24-r%4*8&255)<<16|(t[r+1>>>2]>>>24-(r+1)%4*8&255)<<8|t[r+2>>>2]>>>24-(r+2)%4*8&255,o=0;4>o&&r+.75*o<n;o++)e.push(i.charAt(s>>>6*(3-o)&63));if(t=i.charAt(64))for(;e.length%4;)e.push(t);return e.join("")},parse:function(e){var t=e.length,n=this._map;(i=n.charAt(64))&&-1!=(i=e.indexOf(i))&&(t=i);for(var i=[],r=0,s=0;s<t;s++)if(s%4){var o=n.indexOf(e.charAt(s-1))<<s%4*2,a=n.indexOf(e.charAt(s))>>>6-s%4*2;i[r>>>2]|=(o|a)<<24-r%4*8,r++}return Z.create(i,r)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},function(e){function t(e,t,n,i,r,s,o){return((e=e+(t&n|~t&i)+r+o)<<s|e>>>32-s)+t}function n(e,t,n,i,r,s,o){return((e=e+(t&i|n&~i)+r+o)<<s|e>>>32-s)+t}function i(e,t,n,i,r,s,o){return((e=e+(t^n^i)+r+o)<<s|e>>>32-s)+t}function r(e,t,n,i,r,s,o){return((e=e+(n^(t|~i))+r+o)<<s|e>>>32-s)+t}for(var s=W,o=(c=s.lib).WordArray,a=c.Hasher,c=s.algo,u=[],h=0;64>h;h++)u[h]=4294967296*e.abs(e.sin(h+1))|0;c=c.MD5=a.extend({_doReset:function(){this._hash=new o.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,s){for(var o=0;16>o;o++){var a=e[l=s+o];e[l]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8)}o=this._hash.words;var c,h,l=e[s+0],f=(a=e[s+1],e[s+2]),p=e[s+3],d=e[s+4],g=e[s+5],y=e[s+6],m=e[s+7],v=e[s+8],b=e[s+9],w=e[s+10],S=e[s+11],C=e[s+12],I=e[s+13],_=e[s+14],x=e[s+15],E=o[0],k=r(k=r(k=r(k=r(k=i(k=i(k=i(k=i(k=n(k=n(k=n(k=n(k=t(k=t(k=t(k=t(k=o[1],h=t(h=o[2],c=t(c=o[3],E=t(E,k,h,c,l,7,u[0]),k,h,a,12,u[1]),E,k,f,17,u[2]),c,E,p,22,u[3]),h=t(h,c=t(c,E=t(E,k,h,c,d,7,u[4]),k,h,g,12,u[5]),E,k,y,17,u[6]),c,E,m,22,u[7]),h=t(h,c=t(c,E=t(E,k,h,c,v,7,u[8]),k,h,b,12,u[9]),E,k,w,17,u[10]),c,E,S,22,u[11]),h=t(h,c=t(c,E=t(E,k,h,c,C,7,u[12]),k,h,I,12,u[13]),E,k,_,17,u[14]),c,E,x,22,u[15]),h=n(h,c=n(c,E=n(E,k,h,c,a,5,u[16]),k,h,y,9,u[17]),E,k,S,14,u[18]),c,E,l,20,u[19]),h=n(h,c=n(c,E=n(E,k,h,c,g,5,u[20]),k,h,w,9,u[21]),E,k,x,14,u[22]),c,E,d,20,u[23]),h=n(h,c=n(c,E=n(E,k,h,c,b,5,u[24]),k,h,_,9,u[25]),E,k,p,14,u[26]),c,E,v,20,u[27]),h=n(h,c=n(c,E=n(E,k,h,c,I,5,u[28]),k,h,f,9,u[29]),E,k,m,14,u[30]),c,E,C,20,u[31]),h=i(h,c=i(c,E=i(E,k,h,c,g,4,u[32]),k,h,v,11,u[33]),E,k,S,16,u[34]),c,E,_,23,u[35]),h=i(h,c=i(c,E=i(E,k,h,c,a,4,u[36]),k,h,d,11,u[37]),E,k,m,16,u[38]),c,E,w,23,u[39]),h=i(h,c=i(c,E=i(E,k,h,c,I,4,u[40]),k,h,l,11,u[41]),E,k,p,16,u[42]),c,E,y,23,u[43]),h=i(h,c=i(c,E=i(E,k,h,c,b,4,u[44]),k,h,C,11,u[45]),E,k,x,16,u[46]),c,E,f,23,u[47]),h=r(h,c=r(c,E=r(E,k,h,c,l,6,u[48]),k,h,m,10,u[49]),E,k,_,15,u[50]),c,E,g,21,u[51]),h=r(h,c=r(c,E=r(E,k,h,c,C,6,u[52]),k,h,p,10,u[53]),E,k,w,15,u[54]),c,E,a,21,u[55]),h=r(h,c=r(c,E=r(E,k,h,c,v,6,u[56]),k,h,x,10,u[57]),E,k,y,15,u[58]),c,E,I,21,u[59]),h=r(h,c=r(c,E=r(E,k,h,c,d,6,u[60]),k,h,S,10,u[61]),E,k,f,15,u[62]),c,E,b,21,u[63]);o[0]=o[0]+E|0,o[1]=o[1]+k|0,o[2]=o[2]+h|0,o[3]=o[3]+c|0},_doFinalize:function(){var t=this._data,n=t.words,i=8*this._nDataBytes,r=8*t.sigBytes;n[r>>>5]|=128<<24-r%32;var s=e.floor(i/4294967296);for(n[15+(r+64>>>9<<4)]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),n[14+(r+64>>>9<<4)]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8),t.sigBytes=4*(n.length+1),this._process(),n=(t=this._hash).words,i=0;4>i;i++)r=n[i],n[i]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8);return t},clone:function(){var e=a.clone.call(this);return e._hash=this._hash.clone(),e}}),s.MD5=a._createHelper(c),s.HmacMD5=a._createHmacHelper(c)}(Math),ne=(ee=(te=W).lib).Base,ie=ee.WordArray,re=(ee=te.algo).EvpKDF=ne.extend({cfg:ne.extend({keySize:4,hasher:ee.MD5,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var n=(o=this.cfg).hasher.create(),i=ie.create(),r=i.words,s=o.keySize,o=o.iterations;r.length<s;){a&&n.update(a);var a=n.update(e).finalize(t);n.reset();for(var c=1;c<o;c++)a=n.finalize(a),n.reset();i.concat(a)}return i.sigBytes=4*s,i}}),te.EvpKDF=function(e,t,n){return re.create(n).compute(e,t)},W.lib.Cipher||function(e){var t=(p=W).lib,n=t.Base,i=t.WordArray,r=t.BufferedBlockAlgorithm,s=p.enc.Base64,o=p.algo.EvpKDF,a=t.Cipher=r.extend({cfg:n.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,n){this.cfg=this.cfg.extend(n),this._xformMode=e,this._key=t,this.reset()},reset:function(){r.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){return e&&this._append(e),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(e){return{encrypt:function(t,n,i){return("string"==typeof n?d:f).encrypt(e,t,n,i)},decrypt:function(t,n,i){return("string"==typeof n?d:f).decrypt(e,t,n,i)}}}});t.StreamCipher=a.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var c=p.mode={},u=function(e,t,n){var i=this._iv;i?this._iv=void 0:i=this._prevBlock;for(var r=0;r<n;r++)e[t+r]^=i[r]},h=(t.BlockCipherMode=n.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}})).extend();h.Encryptor=h.extend({processBlock:function(e,t){var n=this._cipher,i=n.blockSize;u.call(this,e,t,i),n.encryptBlock(e,t),this._prevBlock=e.slice(t,t+i)}}),h.Decryptor=h.extend({processBlock:function(e,t){var n=this._cipher,i=n.blockSize,r=e.slice(t,t+i);n.decryptBlock(e,t),u.call(this,e,t,i),this._prevBlock=r}}),c=c.CBC=h,h=(p.pad={}).Pkcs7={pad:function(e,t){for(var n,r=(n=(n=4*t)-e.sigBytes%n)<<24|n<<16|n<<8|n,s=[],o=0;o<n;o+=4)s.push(r);n=i.create(s,n),e.concat(n)},unpad:function(e){e.sigBytes-=255&e.words[e.sigBytes-1>>>2]}},t.BlockCipher=a.extend({cfg:a.cfg.extend({mode:c,padding:h}),reset:function(){a.reset.call(this);var e=(t=this.cfg).iv,t=t.mode;if(this._xformMode==this._ENC_XFORM_MODE)var n=t.createEncryptor;else n=t.createDecryptor,this._minBufferSize=1;this._mode=n.call(t,this,e&&e.words)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){e.pad(this._data,this.blockSize);var t=this._process(!0)}else t=this._process(!0),e.unpad(t);return t},blockSize:4});var l=t.CipherParams=n.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}}),f=(c=(p.format={}).OpenSSL={stringify:function(e){var t=e.ciphertext;return((e=e.salt)?i.create([1398893684,1701076831]).concat(e).concat(t):t).toString(s)},parse:function(e){var t=(e=s.parse(e)).words;if(1398893684==t[0]&&1701076831==t[1]){var n=i.create(t.slice(2,4));t.splice(0,4),e.sigBytes-=16}return l.create({ciphertext:e,salt:n})}},t.SerializableCipher=n.extend({cfg:n.extend({format:c}),encrypt:function(e,t,n,i){i=this.cfg.extend(i);var r=e.createEncryptor(n,i);return t=r.finalize(t),r=r.cfg,l.create({ciphertext:t,key:n,iv:r.iv,algorithm:e,mode:r.mode,padding:r.padding,blockSize:e.blockSize,formatter:i.format})},decrypt:function(e,t,n,i){return i=this.cfg.extend(i),t=this._parse(t,i.format),e.createDecryptor(n,i).finalize(t.ciphertext)},_parse:function(e,t){return"string"==typeof e?t.parse(e,this):e}})),p=(p.kdf={}).OpenSSL={execute:function(e,t,n,r){return r||(r=i.random(8)),e=o.create({keySize:t+n}).compute(e,r),n=i.create(e.words.slice(t),4*n),e.sigBytes=4*t,l.create({key:e,iv:n,salt:r})}},d=t.PasswordBasedCipher=f.extend({cfg:f.cfg.extend({kdf:p}),encrypt:function(e,t,n,i){return n=(i=this.cfg.extend(i)).kdf.execute(n,e.keySize,e.ivSize),i.iv=n.iv,(e=f.encrypt.call(this,e,t,n.key,i)).mixIn(n),e},decrypt:function(e,t,n,i){return i=this.cfg.extend(i),t=this._parse(t,i.format),n=i.kdf.execute(n,e.keySize,e.ivSize,t.salt),i.iv=n.iv,f.decrypt.call(this,e,t,n.key,i)}})}(),function(){for(var e=W,t=e.lib.BlockCipher,n=e.algo,i=[],r=[],s=[],o=[],a=[],c=[],u=[],h=[],l=[],f=[],p=[],d=0;256>d;d++)p[d]=128>d?d<<1:d<<1^283;var g=0,y=0;for(d=0;256>d;d++){var m=(m=y^y<<1^y<<2^y<<3^y<<4)>>>8^255&m^99;i[g]=m,r[m]=g;var v=p[g],b=p[v],w=p[b],S=257*p[m]^16843008*m;s[g]=S<<24|S>>>8,o[g]=S<<16|S>>>16,a[g]=S<<8|S>>>24,c[g]=S,S=16843009*w^65537*b^257*v^16843008*g,u[m]=S<<24|S>>>8,h[m]=S<<16|S>>>16,l[m]=S<<8|S>>>24,f[m]=S,g?(g=v^p[p[p[w^v]]],y^=p[p[y]]):g=y=1}var C=[0,1,2,4,8,16,32,64,128,27,54];n=n.AES=t.extend({_doReset:function(){for(var e=(n=this._key).words,t=n.sigBytes/4,n=4*((this._nRounds=t+6)+1),r=this._keySchedule=[],s=0;s<n;s++)if(s<t)r[s]=e[s];else{var o=r[s-1];s%t?6<t&&4==s%t&&(o=i[o>>>24]<<24|i[o>>>16&255]<<16|i[o>>>8&255]<<8|i[255&o]):(o=i[(o=o<<8|o>>>24)>>>24]<<24|i[o>>>16&255]<<16|i[o>>>8&255]<<8|i[255&o],o^=C[s/t|0]<<24),r[s]=r[s-t]^o}for(e=this._invKeySchedule=[],t=0;t<n;t++)s=n-t,o=t%4?r[s]:r[s-4],e[t]=4>t||4>=s?o:u[i[o>>>24]]^h[i[o>>>16&255]]^l[i[o>>>8&255]]^f[i[255&o]]},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._keySchedule,s,o,a,c,i)},decryptBlock:function(e,t){var n=e[t+1];e[t+1]=e[t+3],e[t+3]=n,this._doCryptBlock(e,t,this._invKeySchedule,u,h,l,f,r),n=e[t+1],e[t+1]=e[t+3],e[t+3]=n},_doCryptBlock:function(e,t,n,i,r,s,o,a){for(var c=this._nRounds,u=e[t]^n[0],h=e[t+1]^n[1],l=e[t+2]^n[2],f=e[t+3]^n[3],p=4,d=1;d<c;d++){var g=i[u>>>24]^r[h>>>16&255]^s[l>>>8&255]^o[255&f]^n[p++],y=i[h>>>24]^r[l>>>16&255]^s[f>>>8&255]^o[255&u]^n[p++],m=i[l>>>24]^r[f>>>16&255]^s[u>>>8&255]^o[255&h]^n[p++];f=i[f>>>24]^r[u>>>16&255]^s[h>>>8&255]^o[255&l]^n[p++],u=g,h=y,l=m}g=(a[u>>>24]<<24|a[h>>>16&255]<<16|a[l>>>8&255]<<8|a[255&f])^n[p++],y=(a[h>>>24]<<24|a[l>>>16&255]<<16|a[f>>>8&255]<<8|a[255&u])^n[p++],m=(a[l>>>24]<<24|a[f>>>16&255]<<16|a[u>>>8&255]<<8|a[255&h])^n[p++],f=(a[f>>>24]<<24|a[u>>>16&255]<<16|a[h>>>8&255]<<8|a[255&l])^n[p++],e[t]=g,e[t+1]=y,e[t+2]=m,e[t+3]=f},keySize:8});e.AES=t._createHelper(n)}(),t.exports=p,t.exports.MessageClient=T,t.exports.Message=O,t.exports.Call=g,t.exports.CallClient=m,t.exports.Verification=j,t.exports.CallDetails=y,t.exports.MessageDeliveryInfo=B,t.exports.PAPIDefs=i},{"../VERSION":1,q:13,"sinch-ticketgen":14}]},{},[16])(16)});